/*! ArcGIS API for JavaScript 4.3 | Copyright (c) 2017 Esri. All rights reserved. | http://www.esri.com/legal/privacy | https://developers.arcgis.com/terms/faq */
define(["dojo/_base/declare","dojo/_base/lang","dojo/cookie","dojo/topic","dojo/query","dojo/dom-construct","Notifications","esri/config","esri/request","esri/core/urlUtils"],function(r,e,i,o,t,n,s,a,u,c){var l=/^(https?:\/\/(arcgis.com|esri.com|.+.arcgis.com|.+.esri.com)|\/)/;a.request.proxyUrl="/proxy",a.request.corsEnabledServers.push(SiteConfig.billing),a.request.corsEnabledServers.push(SiteConfig.download_server),a.request.corsEnabledServers.push("https://geotriggerstg.arcgis.com"),a.request.corsEnabledServers.push("https://geotriggerdev.arcgis.com"),a.request.corsEnabledServers.push("https://geotrigger.arcgis.com"),a.request.corsEnabledServers.push("https://portalette.geotrigger.arcgis.com"),a.request.corsEnabledServers.push("https://portalettestg.geotrigger.arcgis.com");var h=r([],{constructor:function(r){e.mixin(this,r)},_callbacks:[],ready:!1,get_gravatar:function(r,e){var i=function(r){function e(r,e){return r<<e|r>>>32-e}function i(r,e){var i,o,t,n,s;return t=2147483648&r,n=2147483648&e,i=1073741824&r,o=1073741824&e,s=(1073741823&r)+(1073741823&e),i&o?2147483648^s^t^n:i|o?1073741824&s?3221225472^s^t^n:1073741824^s^t^n:s^t^n}function o(r,e,i){return r&e|~r&i}function t(r,e,i){return r&i|e&~i}function n(r,e,i){return r^e^i}function s(r,e,i){return e^(r|~i)}function a(r,t,n,s,a,u,c){return r=i(r,i(i(o(t,n,s),a),c)),i(e(r,u),t)}function u(r,o,n,s,a,u,c){return r=i(r,i(i(t(o,n,s),a),c)),i(e(r,u),o)}function c(r,o,t,s,a,u,c){return r=i(r,i(i(n(o,t,s),a),c)),i(e(r,u),o)}function l(r,o,t,n,a,u,c){return r=i(r,i(i(s(o,t,n),a),c)),i(e(r,u),o)}function h(r){for(var e,i=r.length,o=i+8,t=(o-o%64)/64,n=16*(t+1),s=Array(n-1),a=0,u=0;u<i;)e=(u-u%4)/4,a=u%4*8,s[e]=s[e]|r.charCodeAt(u)<<a,u++;return e=(u-u%4)/4,a=u%4*8,s[e]=s[e]|128<<a,s[n-2]=i<<3,s[n-1]=i>>>29,s}function f(r){var e,i,o="",t="";for(i=0;i<=3;i++)e=r>>>8*i&255,t="0"+e.toString(16),o+=t.substr(t.length-2,2);return o}function p(r){r=r.replace(/rn/g,"n");for(var e="",i=0;i<r.length;i++){var o=r.charCodeAt(i);o<128?e+=String.fromCharCode(o):o>127&&o<2048?(e+=String.fromCharCode(o>>6|192),e+=String.fromCharCode(63&o|128)):(e+=String.fromCharCode(o>>12|224),e+=String.fromCharCode(o>>6&63|128),e+=String.fromCharCode(63&o|128))}return e}var g,d,S,m,v,b,I,w,A,_=Array(),y=7,G=12,C=17,z=22,k=5,q=9,j=14,N=20,x=4,E=11,O=16,U=23,J=6,Y=10,K=15,T=21;for(r=p(r),_=h(r),b=1732584193,I=4023233417,w=2562383102,A=271733878,g=0;g<_.length;g+=16)d=b,S=I,m=w,v=A,b=a(b,I,w,A,_[g+0],y,3614090360),A=a(A,b,I,w,_[g+1],G,3905402710),w=a(w,A,b,I,_[g+2],C,606105819),I=a(I,w,A,b,_[g+3],z,3250441966),b=a(b,I,w,A,_[g+4],y,4118548399),A=a(A,b,I,w,_[g+5],G,1200080426),w=a(w,A,b,I,_[g+6],C,2821735955),I=a(I,w,A,b,_[g+7],z,4249261313),b=a(b,I,w,A,_[g+8],y,1770035416),A=a(A,b,I,w,_[g+9],G,2336552879),w=a(w,A,b,I,_[g+10],C,4294925233),I=a(I,w,A,b,_[g+11],z,2304563134),b=a(b,I,w,A,_[g+12],y,1804603682),A=a(A,b,I,w,_[g+13],G,4254626195),w=a(w,A,b,I,_[g+14],C,2792965006),I=a(I,w,A,b,_[g+15],z,1236535329),b=u(b,I,w,A,_[g+1],k,4129170786),A=u(A,b,I,w,_[g+6],q,3225465664),w=u(w,A,b,I,_[g+11],j,643717713),I=u(I,w,A,b,_[g+0],N,3921069994),b=u(b,I,w,A,_[g+5],k,3593408605),A=u(A,b,I,w,_[g+10],q,38016083),w=u(w,A,b,I,_[g+15],j,3634488961),I=u(I,w,A,b,_[g+4],N,3889429448),b=u(b,I,w,A,_[g+9],k,568446438),A=u(A,b,I,w,_[g+14],q,3275163606),w=u(w,A,b,I,_[g+3],j,4107603335),I=u(I,w,A,b,_[g+8],N,1163531501),b=u(b,I,w,A,_[g+13],k,2850285829),A=u(A,b,I,w,_[g+2],q,4243563512),w=u(w,A,b,I,_[g+7],j,1735328473),I=u(I,w,A,b,_[g+12],N,2368359562),b=c(b,I,w,A,_[g+5],x,4294588738),A=c(A,b,I,w,_[g+8],E,2272392833),w=c(w,A,b,I,_[g+11],O,1839030562),I=c(I,w,A,b,_[g+14],U,4259657740),b=c(b,I,w,A,_[g+1],x,2763975236),A=c(A,b,I,w,_[g+4],E,1272893353),w=c(w,A,b,I,_[g+7],O,4139469664),I=c(I,w,A,b,_[g+10],U,3200236656),b=c(b,I,w,A,_[g+13],x,681279174),A=c(A,b,I,w,_[g+0],E,3936430074),w=c(w,A,b,I,_[g+3],O,3572445317),I=c(I,w,A,b,_[g+6],U,76029189),b=c(b,I,w,A,_[g+9],x,3654602809),A=c(A,b,I,w,_[g+12],E,3873151461),w=c(w,A,b,I,_[g+15],O,530742520),I=c(I,w,A,b,_[g+2],U,3299628645),b=l(b,I,w,A,_[g+0],J,4096336452),A=l(A,b,I,w,_[g+7],Y,1126891415),w=l(w,A,b,I,_[g+14],K,2878612391),I=l(I,w,A,b,_[g+5],T,4237533241),b=l(b,I,w,A,_[g+12],J,1700485571),A=l(A,b,I,w,_[g+3],Y,2399980690),w=l(w,A,b,I,_[g+10],K,4293915773),I=l(I,w,A,b,_[g+1],T,2240044497),b=l(b,I,w,A,_[g+8],J,1873313359),A=l(A,b,I,w,_[g+15],Y,4264355552),w=l(w,A,b,I,_[g+6],K,2734768916),I=l(I,w,A,b,_[g+13],T,1309151649),b=l(b,I,w,A,_[g+4],J,4149444226),A=l(A,b,I,w,_[g+11],Y,3174756917),w=l(w,A,b,I,_[g+2],K,718787259),I=l(I,w,A,b,_[g+9],T,3951481745),b=i(b,d),I=i(I,S),w=i(w,m),A=i(A,v);var L=f(b)+f(I)+f(w)+f(A);return L.toLowerCase()},e=e||80;return"//www.gravatar.com/avatar/"+i(r)+".jpg?s="+e},redirect:function(r,e){l.test(r)||(r="http://developers.arcgis.com"),e&&(e=dojo.objectToQuery(e)),window.location=r+(e?"?"+e:"")},queue:function(r){this.ready?r():this._callbacks.push(r)},avatar:function(r){return this.profile.thumbnail?"https://"+SiteConfig.ago+"/sharing/rest/community/users/"+this.username()+"/info/"+this.profile.thumbnail+"?token="+this.token():this.get_gravatar(this.profile.email,r||18)+"&d=mm"},loggedIn:function(){return!!this.token()},displayName:function(){return this.profile?profile.fullName||this.username()||profile.email||"Your Account":this.username()},orgId:function(){return this.organization?this.organization.id:i("esri_auth")?JSON.parse(i("esri_auth")).accountId:void 0},orgUrlKey:function(){return this.organization?this.organization.urlKey:i("esri_auth")?JSON.parse(i("esri_auth")).urlKey:void 0},orgUrl:function(){if(this.organization){var r=this.organization.allSSL?"https://":"http://";return r+this.orgUrlKey()+SiteConfig.ago_maps}},token:function(){return!!i("esri_auth")&&JSON.parse(i("esri_auth")).token},role:function(){var r=JSON.parse(i("esri_auth"));return!!r&&(!!r.role&&r.role.replace("org_","").replace("account_",""))},isAdmin:function(){return"admin"===this.role()},username:function(){return this.profile?this.profile.username:i("esri_auth")?JSON.parse(i("esri_auth")).email:void 0},userId:function(){return this.username()},requireSession:function(){this.loggedIn()||this.redirect("/sign-in",{redirect_uri:window.encodeURIComponent(window.location.href)})},logout:function(){redirect("https://www.arcgis.com/sharing/rest/oauth2/signout",{redirect_uri:SiteConfig.destination})},developerSubscription:function(){if(this.organization&&this.organization.subscriptionInfo&&("Trial Developer"===this.organization.subscriptionInfo.type||"Developer"===this.organization.subscriptionInfo.type))return!0},developer:function(){return this.developerSubscription()},trial:function(){if(this.organization&&this.organization.subscriptionInfo.type.match(/Trial/))return!0},expired:function(){if(this.organization&&this.organization.subscriptionInfo&&"expired"===this.organization.subscriptionInfo.state)return!0},suspended:function(){if(this.organization&&this.organization.subscriptionInfo&&"suspended"===this.organization.subscriptionInfo.state)return!0},firstName:function(){return this.profile.fullName.split(/ |\.|_/)[0]},finishSignin:function(r){var e=this.isPublicAccount()?"/public-account/":"/applications/",i=c.urlToObject(window.location.href).query,o=i&&i.redirect_uri?i.redirect_uri:e;this.redirect(o)},isPublicAccount:function(){return!!i("esri_auth")&&!JSON.parse(i("esri_auth")).role}});window.ArcGIS=window.ArcGIS||{},window.ArcGIS.Session=new h;var f=i("esri_auth"),p=f?JSON.parse(f):void 0;return p&&!window.ArcGIS.shouldExpireSession&&(u(SiteConfig.portal+"/rest/portals/self",{query:{token:ArcGIS.Session.token(),f:"json"}}).then(function(r){ArcGIS.Session.profile=r.user,ArcGIS.Session.organization=r,o.publish("session:organization"),u({url:SiteConfig.billing+"/subscription",content:{token:ArcGIS.Session.token(),f:"json"}}).then(function(r){ArcGIS.Session.subscription=r.subscription,ArcGIS.Session.ready=!0;for(var e=ArcGIS.Session._callbacks.length-1;e>=0;e--)ArcGIS.Session._callbacks[e]();o.publish("session:ready")},function(r){ArcGIS.Session.logout(),document.location.reload(!0)})},function(r){ArcGIS.Session.logout(),document.location.reload(!0)}),ArcGIS.Session.queue(function(){var r=ArcGIS.Session.expired()||ArcGIS.Session.suspended(),e=t("#account-alerts").length;if(e&&r){var i=new s(t("#account-notifications")[0]),o=ArcGIS.Session.developer()&&ArcGIS.Session.expired(),n=ArcGIS.Session.developer()&&ArcGIS.Session.suspended(),a=!ArcGIS.Session.developer();if(o&&i.error("It looks like your account has expired. You won't be able to create new applications or feature services until you <a href='/account/modify-plan/'>renew your account</a>."),n&&i.error("Looks like you went over your credit limit for this month. You won't be able to create new applications or feature services. You can either <a href='/account/modify-plan/'>upgrade to a larger plan</a> or wait until next month."),a){var u=" <a href='"+ArcGIS.Session.orgUrl()+"/home/organization.html'>Upgrade Subscription</a>";i.error("Your subscription has been suspended or has expired."+u)}}})),window.ArcGIS.Session});