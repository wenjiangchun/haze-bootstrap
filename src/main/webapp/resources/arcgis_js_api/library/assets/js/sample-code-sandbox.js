/*! ArcGIS API for JavaScript 4.3 | Copyright (c) 2017 Esri. All rights reserved. | http://www.esri.com/legal/privacy | https://developers.arcgis.com/terms/faq */
require(["beautify-web/beautify-html","eligrey/FileSaver","dojo/_base/connect","dojo/_base/event","dojo/dom-construct","dojo/dom-style","dojo/has","dojo/on","dojo/query","esri/config","esri/core/urlUtils","esri/request","dojo/NodeList-dom","dojo/domReady!"],function(e,o,n,t,a,c,i,s,d,r,l,m){function u(){M("setSampleFolder");var e=l.urlToObject(document.location.href);e.query=e.query||{};var o=document.location.pathname.replace("sample-code/sandbox/index.html","");e.query&&e.query.sample?(q=e.query.sample,document.title="Sandbox: "+q,A=document.location.protocol+"//"+document.location.host+o+"sample-code/"+e.query.sample+"/live"):A=o+"sample-code/get-started-mapview/live"}function p(){M("startEditor"),ace.config.set("workerPath","../../assets/js/libs/ace");var e=d(".js-sandbox-editor")[0];K=ace.edit(e),K.$blockScrolling=1/0,K.setPrintMarginColumn(0),K.setTheme("ace/theme/github"),K.getSession().setTabSize(2),K.getSession().setUseSoftTabs(!0),K.getSession().setMode("ace/mode/html"),K.setOption("wrap",!0);var o={current:"ace",ace:null,vim:void 0};ace.config.loadModule("ace/keyboard/vim",function(e){o.vim=e.handler;var n=e.CodeMirror.Vim;n.defineEx("write","w",function(e,o){e.ace.execCommand("sandboxSaveCommand")})}),K.commands.addCommand({name:"sandboxSaveCommand",bindKey:{win:"Ctrl-Enter",mac:"Command-Enter"},exec:function(e){j()}}),K.commands.addCommand({name:"sandboxKeybindingCommand",bindKey:{win:"Ctrl-K",mac:"Command-K"},exec:function(e){"ace"===o.current?(e.setKeyboardHandler(o.vim),o.current="vim"):(e.setKeyboardHandler(o.ace),o.current="ace")}}),K.commands.addCommand({name:"sandboxCommentLinesCommand",bindKey:{win:"Ctrl-/",mac:"Command-/"},exec:function(e){e.toggleCommentLines()}}),K.commands.addCommand({name:"sandboxBeautifyCommand",bindKey:{win:"Ctrl-Shift-L",mac:"Command-Shift-L"},exec:function(e){S()}}),K.commands.addCommand({name:"sandboxToogleHTMLCommand",bindKey:{win:"Ctrl-1",mac:"Command-1"},exec:function(e){g()}}),K.commands.addCommand({name:"sandboxToogleOutputCommand",bindKey:{win:"Ctrl-2",mac:"Command-2"},exec:function(e){b()}})}function f(){M("bindEventHandlers"),I=d(".js-btn-html"),W=d(".js-btn-output"),F=d(".js-btn-sample-description"),D=d(".js-btn-save-file"),U=d(".js-btn-open-in-jsbin"),P=d(".js-btn-refresh"),Z=d(".js-sandbox-container"),B=d(".js-sandbox-handle"),Q=d(".js-sandbox-output"),ee=d(".js-loader"),I.on("click",g),W.on("click",b),F.on("click",h),D.on("click",v),U.on("click",x),P.on("click",j),X=d(".js-btn-sandbox-keyboard-shortcuts"),X.on("click",z),$=d(".js-sandbox-keyboard-shortcuts-modal-close"),$.on("click",function(){G.style("display","none")}),J=d(".js-sandbox-keyboard-shortcut-container"),G=d(".js-sandbox-keyboard-shortcuts-modal"),N=d(".js-sandbox-keyboard-shortcuts-modal-content tbody"),B.on("mousedown",C),F.attr("data-sample-description-url","../../sample-code/"+q+"/index.html"),s(window,"resize",y)}function g(){I.toggleClass("btn-clear"),I.toggleClass("icon-ui-minimize"),I.toggleClass("icon-ui-maximize"),Z.toggleClass("sandbox-container-minimized"),Q.toggleClass("sandbox-output-maximized"),B.toggleClass("sandbox-container-minimized"),y(),K.resize(!0)}function b(){W.toggleClass("btn-clear"),W.toggleClass("icon-ui-minimize"),W.toggleClass("icon-ui-maximize"),Z.toggleClass("sandbox-container-maximized"),Q.toggleClass("sandbox-output-minimized"),B.toggleClass("sandbox-container-minimized"),y(),K.resize(!0)}function h(){var e=F.attr("data-sample-description-url")[0];document.location=e}function v(){M("saveFile");try{var e=!!new Blob;if(e){var n=new Blob([K.getSession().getValue()],{type:"text/plain;charset='"+document.characterSet+"'"});o(n,q+".html")}}catch(e){console.log("Download is not supported for %s",navigator.userAgent)}}function x(){function e(){function e(e){for(var o="",n=0;n<e;n++)o+=(65536*(1+Math.random())|0).toString(16).substring(1);return o}return[e(2),e(1),e(1),e(1),e(3)].join("-")}M("openJSBin");var o,n=window.open("about:blank",e()),t=K.getSession().getValue(),a=E(t),c=["html"],i=n.document.createElement("form");i.setAttribute("target","_self"),i.setAttribute("method","post"),i.setAttribute("action","https://jsbin.com?html,output"),i.style.display="none";for(var s=0;s<c.length;s++)o=n.document.createElement("input"),i.appendChild(o),o.type="hidden",o.name=c[s],o.value=encodeURIComponent(a);n.document.body.appendChild(i),i.submit()}function C(e){function o(e,o){Z[0].style.right=o-e+"px",Q[0].style.left=e+"px"}t.stop(e),B.addClass("resizing"),Y.addClass("resizing");var a=50,i=70,d=c.get("wrapper","width"),r=s(window,"mousemove",function(e){t.stop(e),e.pageX>a&&e.pageX+i<d&&(o(e.pageX+11,d),K.resize(!0))});s.once(parent.document,"mouseup",function(e){B.removeClass("resizing"),Y.removeClass("resizing"),n.disconnect(r)})}function y(){Q.removeAttr("style"),Z.removeAttr("style"),O()}function w(){function e(e){M("handleSample");var o=e.data;K.getSession().setValue(o),F.toggleClass("btn-disabled"),D.removeClass("btn-disabled"),U.removeClass("btn-disabled"),j()}function o(e){console&&console.log&&console.log("error getting code sample: ",e)}M("fetchSandboxSampleCode");var n=A+"/index.html";m(n,{responseType:"text"}).then(e,o)}function j(){M("updateSandboxOutput"),ee.addClass("is-active"),Y=d(".js-sandbox-iframe"),Y&&a.destroy(Y[0]),H&&n.disconnect(H);var e=a.create("iframe",{class:"sandbox-iframe js-sandbox-iframe"},Q[0]);H=s(e,"load",function(){Y=d(".js-sandbox-iframe"),ee.removeClass("is-active"),P.removeClass("btn-disabled")}),M("sandboxIsLoaded"),idoc=e.contentWindow?e.contentWindow:e.contentDocument.document?e.contentDocument.document:e.contentDocument;var o=K.getSession().getValue();o=T(o),i("ie")?(idoc.contents=o,e.src="javascript:window['contents']"):(idoc.document.open(),idoc.document.write(o),idoc.document.close())}function S(){var o={brace_style:"none",end_with_newline:!1,extra_liners:"",indent_size:2,max_preserve_newlines:2,preserve_newlines:!0,wrap_line_length:80},n=K.getSession().getValue(),t=e.html_beautify(n,o);K.getSession().setValue(t)}function E(e){var o="<!-- \n  ArcGIS API for JavaScript, https://js.arcgis.com\n  For more information about the {{ sample_name }} sample, read the original sample description at developers.arcgis.com.\n  {{ sample_url }}  \n  -->\n  ",n=e,t=/<title>[^<]*<\/title>/im,a=e.match(t),c=a?a[0]:"",i=c.replace(/<\/?title>/gim,"");if(c&&""!==c){var s=A.match(/[-\w]*(?=\/live(\/index\.html)?)/im),d=s?s[0]:"sample",r="https://developers.arcgis.com/javascript/latest/"+d+"/index.html",l="";l+='<meta name="description" content="['+i+']">\n  ',l+=o.replace(/{{\ssample_name\s}}/,d).replace(/{{\ssample_url\s}}/,r)+c,n=e.replace(t,l)}return n}function k(){L=document.documentElement.getAttribute("data-platform"),R=/mac/i.test(L)?ne.mac:ne.win,V=_(0,R.length-1);var e=R[V];J[0].innerHTML="<span class='command'>"+e.command+'</span><span class="action">'+e.description+"</span>"}function z(){if(G&&"block"!==G.style("display")[0]){var e="";R.forEach(function(o){e+="<tr><td><span class='command'>"+o.command+'</span></td><td><span class="action">'+o.description+"</span></td></tr>"}),N[0].innerHTML=e,G.style("display","block"),O()}}function O(){var e=G[0].clientWidth,o=G[0].clientHeight,n=(document.body.clientHeight-o)/2+"px",t=(document.body.clientWidth-e)/2+"px";G.style("top",n),G.style("left",t)}function T(e){var o=e.match(/issMeshUrl = ".+?"/g);if(o&&(o=o.filter(function(e){return e.indexOf("//")===-1}),o.forEach(function(o){var n=o.split('"')[1];e=e.replace(n,A+"/"+n)})),o=e.match(/url = ".+?"/g),o&&(o=o.filter(function(e){return e.indexOf("//")===-1}),o.forEach(function(o){var n=o.split('"')[1];e=e.replace(n,A+"/"+n)})),o=e.match(/".\/Clock.js"/g),o&&(o=o.filter(function(e){return e.indexOf("//")===-1}),o.forEach(function(o){var n=o.split('"')[1];e=e.replace(n,A+"/"+n)})),o=e.match(/".\/clock.svg"/g),o&&(o=o.filter(function(e){return e.indexOf("//")===-1}),o.forEach(function(o){var n=o.split('"')[1];e=e.replace(n,A+"/"+n)})),o=e.match(/image: ".+?"/g),o&&(o=o.filter(function(e){return e.indexOf("//")===-1}),o.forEach(function(o){var n=o.split('"')[1];e=e.replace(n,A+"/"+n)})),o=e.match(/url: ".+?"/g),o&&(o=o.filter(function(e){return e.indexOf("//")===-1}),o.forEach(function(o){var n=o.split('"')[1];e=e.replace(n,A+"/"+n)})),o=e.match(/src='.+?'/g),o&&(o=o.filter(function(e){return e.indexOf("//")===-1}),o.forEach(function(o){var n=o.split("'")[1];e=e.replace(n,A+"/"+n)})),o=e.match(/src=".+?"/g),o&&(o=o.filter(function(e){return e.indexOf("//")===-1}),o=o.filter(function(e){return e.indexOf("{")===-1}),o.forEach(function(o){var n=o.split('"')[1];e=e.replace(n,A+"/"+n)})),o=e.match(/"dojo\/text!.+?"/g),o&&(o=o.filter(function(e){return e.indexOf("//")===-1}),o.forEach(function(o){var n=o.split('"')[1];e=e.replace(n,"dojo/text!"+A+"/brightest.txt")})),/layers-scenelayerview-query/.test(A)){var n=/<img[^>]*>/im,t=new RegExp(A+"/");if(n.test(e)){var a=e.match(n)[0],c=a.replace(t,"");e=e.replace(n,c)}}return e}function _(e,o){return e=Math.ceil(e),o=Math.floor(o),Math.floor(Math.random()*(o-e+1))+e}function M(e){oe&&console&&console.log&&console.log(Array.prototype.slice.call(arguments))}var K,L,q,A,H,R,V,B,U,D,F,I,W,P,X,J,G,N,$,Q,Y,Z,ee,oe=!1,ne={mac:[{command:"<code>Cmd</code> + <code>Enter</code>",description:"Refresh Output"},{command:"<code>Cmd</code> + <code>/</code>",description:"Comment lines / Uncomment lines"},{command:"<code>Cmd</code> + <code>Shift</code> + <code>L</code>",description:"Beautify sandbox code"},{command:"<code>Cmd</code> + <code>1</code>",description:"Toggle HTML"},{command:"<code>Cmd</code> + <code>2</code>",description:"Toggle Output"},{command:"<code>Cmd</code> + <code>K</code>",description:"Toggle vim, <code>:w</code> Refresh Output"}],win:[{command:"<code>Ctrl</code> + <code>Enter</code>",description:"Refresh Output"},{command:"<code>Ctrl</code> + <code>/</code>",description:"Comment lines / Uncomment lines"},{command:"<code>Ctrl</code> + <code>Shift</code> + <code>L</code>",description:"Beautify sandbox code"},{command:"<code>Ctrl</code> + <code>1</code>",description:"Toggle HTML"},{command:"<code>Ctrl</code> + <code>2</code>",description:"Toggle Output"},{command:"<code>Ctrl</code> + <code>K</code>",description:"Toggle vim, <code>:w</code> Refresh Output"}]};r.request.corsEnabledServers.push("https://developers.arcgis.com/javascript/samples"),u(),p(),f(),w(),k()});