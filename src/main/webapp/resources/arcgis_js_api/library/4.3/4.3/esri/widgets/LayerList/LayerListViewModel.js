// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Collection ../../core/Evented ../../core/HandleRegistry ../../core/watchUtils ./ListItem ./support/layerListUtils dojo/debounce ../../core/accessorSupport/decorators".split(" "),function(d,v,m,f,n,p,q,r,g,k,t,u,e){var l=p.ofType(k);d=function(d){function c(a){var b=d.call(this)||this;b._actionsOpenMap=new Map;b._itemOpenMap=new Map;b._handles=new r;b.createActionsFunction=
null;b.operationalItems=new l;b.view=null;b._handles.add(g.init(b,"view",function(){return b._viewHandles()}),"view");b._compileList=u(b._compileList,0);return b}m(c,d);c.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null;this.operationalItems.removeAll()};Object.defineProperty(c.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});c.prototype.triggerAction=function(a,b){a&&this.emit("trigger-action",{action:a,
item:b})};c.prototype._createMapHandles=function(a){var b=this;this._handles.remove("map");var h=a&&a.get("map.layers");h&&(h=h.on("change",function(){return b._compileList(a)}),this._handles.add(h,"map"))};c.prototype._resetMapItems=function(a){this._actionsOpenMap.clear();this._itemOpenMap.clear();this._createMapHandles(a);this._compileList(a)};c.prototype._setUpChildActions=function(a){var b=this;a.forEach(function(a){return b._setupActions(a)})};c.prototype._watchItemProperties=function(a){var b=
this;this._handles.add([g.watch(a,"actionsOpen",function(c){b._actionsOpenMap.set(a.layer,c)}),g.watch(a,"open",function(c){b._itemOpenMap.set(a.layer,c)}),a.children.on("change",function(){b._setUpChildActions(a.children)})],"list-items")};c.prototype._setupActions=function(a){if("function"===typeof this.createActionsFunction){var b=this.createActionsFunction.call(null,{item:a});b&&b.length&&(a.actionsSections=b)}};c.prototype._createListItem=function(a){var b=!!this._actionsOpenMap.get(a),c=!!this._itemOpenMap.get(a);
a=new k({actionsOpen:b,open:c,layer:a,view:this.view});this._setupActions(a);this._setUpChildActions(a.children);this._watchItemProperties(a);return a};c.prototype._compileList=function(a){var b=this;if(!this.destroyed){this._handles.remove("list-items");a=a&&a.get("map.layers");var c=[];a&&a.forEach(function(a){"hide"!==t.findLayerListMode(a)&&(a=b._createListItem(a),c.unshift(a))});this.operationalItems.removeAll();this.operationalItems.addMany(c)}};c.prototype._viewHandles=function(){var a=this,
b=this.view;this._handles.remove("layers");this._resetMapItems(b);b&&b.then(function(){a._handles.add([g.init(b,"map",function(){return a._resetMapItems(b)}),b.layerViews.on("change",function(){return a._compileList(b)}),g.init(a,"createActionsFunction",function(){return a._compileList(b)})],"layers")})};return c}(e.declared(n,q));f([e.property()],d.prototype,"createActionsFunction",void 0);f([e.property({type:l})],d.prototype,"operationalItems",void 0);f([e.property({dependsOn:["view.ready"],readOnly:!0})],
d.prototype,"state",null);f([e.property()],d.prototype,"view",void 0);return d=f([e.subclass("esri.widgets.LayerList.LayerListViewModel")],d)});