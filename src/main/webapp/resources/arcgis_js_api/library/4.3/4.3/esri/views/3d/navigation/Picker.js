// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define(["../../../core/declare","../support/RenderCoordsHelper","../lib/glMatrix","../webgl-engine/lib/Selector"],function(l,k,m,n){var e=m.vec3d,g=e.create(),f=e.create();return l([],{constructor:function(b,c){this.navigation=b;this.pickAlongRay=c._pickRay.bind(c);this.createPickRay=c._pickRayWithBeginPoint.bind(c);this.selector=new n},pickPointInScreen:function(b,c){return this.pickedIntersectionPoint(this.pickInScreen(b,!1),c)},pickFreePointInScreen:function(b,c){this.createPickRay(b,void 0,this.navigation.currentCamera.viewMatrix,
g,f);c||(c=e.create());e.subtract(f,g);e.normalize(f);var a=this.navigation.view.dataExtent;b=Math.max(a.xmax-a.xmin,a.ymax-a.ymin,8*Math.max(a.xmax-a.xmin,a.ymax-a.ymin));var d=this.navigation.currentCamera,h=Math.max(0,a.xmin-d.eye[0],d.eye[0]-a.xmax),a=Math.max(0,a.ymin-d.eye[1],d.eye[1]-a.ymax),h=Math.sqrt(h*h+a*a),a="global"==this.navigation.view.viewingMode?k.Spherical.prototype.getAltitude(d.eye):k.Planar.prototype.getAltitude(d.eye),d=this.navigation._getTerrainElevationBelowCamera(d),d=b/
Math.max(1,Math.pow(Math.max(0,Math.log(b/(Math.abs(a-d)+Number.MIN_VALUE))),2)),d=Math.max(d,Math.min(h,b));e.scale(f,d);e.add(g,f,c)},pickInScreen:function(b,c){this.createPickRay(b,void 0,this.navigation.currentCamera.viewMatrix,g,f);c&&e.set(this.navigation.currentCamera.eye,g);return this.pickAlongRay(g,f,b,b,null,null,this.selector)},pickedIntersectionPoint:function(b,c){if(!b)return!1;c||(c=e.create());return b.getMinResult().getIntersectionPoint(c)}})});