// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ../core/lang ../core/urlUtils ../core/Logger ../core/Error ../core/arrayUtils ../portal/Portal ../symbols/WebStyleSymbol ../symbols/support/jsonUtils ../symbols/support/symbolUtils ./Renderer ./support/arcadeUtils ./support/diffUtils".split(" "),function(c,A,u,f,a,g,r,v,p,t,q,w,m,x,y,n,z){var k=v.getLogger("esri.renderers.UniqueValueRenderer");c=l=function(c){function a(b){b=
c.call(this)||this;b._valueInfoMap={};b._isDefaultSymbolDerived=!1;b.type="uniqueValue";b.field=null;b.field2=null;b.field3=null;b.valueExpression=null;b.valueExpressionTitle=null;b.legendOptions=null;b.defaultLabel=null;b.fieldDelimiter=null;b.portal=null;b.styleOrigin=null;b.diff={uniqueValueInfos:function(b,a){if(b||a){if(!b||!a)return{type:"complete",oldValue:b,newValue:a};for(var d=!1,c={type:"collection",added:[],removed:[],changed:[]},h=function(e){var h=t.find(b,function(b){return b.value===
a[e].value});h?z.diff(h,a[e])&&(c.changed.push({type:"complete",oldValue:h,newValue:a[e]}),d=!0):(c.added.push(a[e]),d=!0)},f=0;f<a.length;f++)h(f);h=function(e){t.find(a,function(d){return d.value===b[e].value})||(c.removed.push(b[e]),d=!0)};for(f=0;f<b.length;f++)h(f);return d?c:void 0}}};b._set("uniqueValueInfos",[]);return b}u(a,c);a.prototype.writeValueExpression=function(b,d,a,e){e&&"web-scene"===e.origin?b&&e.messages&&e.messages.push(new p("property:unsupported",this.declaredClass+".valueExpression is not supported in Web Scene. Please remove this property to save the Web Scene.",
{instance:this,propertyName:"valueExpression",context:e})):d.valueExpression=b};a.prototype.writeValueExpressionTitle=function(b,d,a,e){e&&"web-scene"===e.origin?b&&e.messages&&e.messages.push(new p("property:unsupported",this.declaredClass+".valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:"valueExpressionTitle",context:e})):d.valueExpressionTitle=b};Object.defineProperty(a.prototype,"compiledFunc",{get:function(){return n.createFunction(this.valueExpression)},
enumerable:!0,configurable:!0});a.prototype.readLegendOptions=function(b){return g.clone(b)};a.prototype.writeLegendOptions=function(b,d,a,e){e&&"web-scene"===e.origin?b&&e.messages&&e.messages.push(new p("property:unsupported",this.declaredClass+".legendOptions is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:"legendOptions",context:e})):d.legendOptions=g.clone(b)};Object.defineProperty(a.prototype,"defaultSymbol",{set:function(b){this._isDefaultSymbolDerived=
!1;this._set("defaultSymbol",b)},enumerable:!0,configurable:!0});a.prototype.readDefaultSymbol=function(b,d,a){return m.read(b,d,a)};a.prototype.writeDefaultSymbol=function(b,d,a,e){!this._isDefaultSymbolDerived&&(b=m.write(b,{},e))&&(d.defaultSymbol=b)};a.prototype.readPortal=function(b,d,a){return a.portal||q.getDefault()};a.prototype.readStyleOrigin=function(b,d,a){if(d.styleName)return Object.freeze({styleName:d.styleName});if(d.styleUrl)return b=r.read(d.styleUrl,a),Object.freeze({styleUrl:b})};
a.prototype.writeStyleOrigin=function(b,d,a,e){b.styleName?d.styleName=b.styleName:b.styleUrl&&(d.styleUrl=r.write(b.styleUrl,e))};Object.defineProperty(a.prototype,"uniqueValueInfos",{set:function(b){this.styleOrigin?k.error("#uniqueValueInfos\x3d","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",b.slice(0)),this._updateValueInfoMap())},enumerable:!0,configurable:!0});a.prototype.readUniqueValueInfos=function(b,d,a){if(Array.isArray(b))return b.map(function(b){b=
g.clone(b);b.symbol=m.read(b.symbol,d,a);return b})};a.prototype.writeUniqueValueInfos=function(b,a,c,e){this.styleOrigin||(a.uniqueValueInfos=(this.uniqueValueInfos||[]).map(function(b){b=g.clone(b);b.symbol&&(b.symbol=m.write(b.symbol,{},e));b.value+="";return g.fixJson(b)}))};a.prototype.addUniqueValueInfo=function(b,a){this.styleOrigin?k.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(b="object"===typeof b?b:{value:b,symbol:a},
this.uniqueValueInfos.push(b),this._valueInfoMap[b.value+""]=b)};a.prototype.removeUniqueValueInfo=function(b){if(this.styleOrigin)k.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");else for(var a=0;a<this.uniqueValueInfos.length;a++)if(this.uniqueValueInfos[a].value+""===b+""){delete this._valueInfoMap[b];this.uniqueValueInfos.splice(a,1);break}};a.prototype.getUniqueValueInfo=function(b,a){var d=this.field,e=b.attributes;if(this.valueExpression)d=
n.executeFunction(this.compiledFunc,n.createExecContext(b,n.getView(a)));else if(this.field2){b=this.field2;a=this.field3;var c=[];d&&c.push(e[d]);b&&c.push(e[b]);a&&c.push(e[a]);d=c.join(this.fieldDelimiter||"")}else d=d&&"function"===typeof d?d(b):e[d];return this._valueInfoMap[d+""]};a.prototype.getSymbol=function(b,a){return(b=this.getUniqueValueInfo(b,a))&&b.symbol||this.defaultSymbol};a.prototype.clone=function(){var b=new l({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,
defaultSymbol:g.clone(this.defaultSymbol),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:g.clone(this.visualVariables),legendOptions:g.clone(this.legendOptions),authoringInfo:g.clone(this.authoringInfo)});this._isDefaultSymbolDerived&&(b._isDefaultSymbolDerived=!0);b._set("portal",this.portal);var a=g.clone(this.uniqueValueInfos);this.styleOrigin&&(b._set("styleOrigin",Object.freeze(g.clone(this.styleOrigin))),
Object.freeze(a));b._set("uniqueValueInfos",a);b._updateValueInfoMap();return b};a.prototype.collectRequiredFields=function(b){this.inherited(arguments);[this.field,this.field2,this.field3].forEach(function(a){a&&(b[a]=!0)})};a.prototype.populateFromStyle=function(){var b=this;return x.fetchStyle(this.styleOrigin,{portal:this.portal}).then(function(a){var d=[];b._valueInfoMap={};a&&a.data&&Array.isArray(a.data.items)&&a.data.items.forEach(function(c){var e=new w({styleUrl:a.styleUrl,styleName:a.styleName,
portal:b.portal,name:c.name});b.defaultSymbol||c.name!==a.data.defaultItem||(b.defaultSymbol=e,b._isDefaultSymbolDerived=!0);e={value:c.name,symbol:e};d.push(e);b._valueInfoMap[c.name]=e});b._set("uniqueValueInfos",Object.freeze(d));!b.defaultSymbol&&b.uniqueValueInfos.length&&(b.defaultSymbol=b.uniqueValueInfos[0].symbol,b._isDefaultSymbolDerived=!0);return b})};a.prototype._updateValueInfoMap=function(){var b=this;this._valueInfoMap={};this.uniqueValueInfos.forEach(function(a){return b._valueInfoMap[a.value+
""]=a})};a.fromPortalStyle=function(b,a){var d=new l(a&&a.properties);d._set("styleOrigin",Object.freeze({styleName:b}));d._set("portal",a&&a.portal||q.getDefault());a=d.populateFromStyle();a.otherwise(function(a){k.error("#fromPortalStyle('"+b+"'[, ...])","Failed to create unique value renderer from style name",a)});return a};a.fromStyleUrl=function(b,a){a=new l(a&&a.properties);a._set("styleOrigin",Object.freeze({styleUrl:b}));a=a.populateFromStyle();a.otherwise(function(a){k.error("#fromStyleUrl('"+
b+"'[, ...])","Failed to create unique value renderer from style URL",a)});return a};return a}(a.declared(y));f([a.property()],c.prototype,"type",void 0);f([a.property({json:{read:{source:"field1"},write:{target:"field1"}}})],c.prototype,"field",void 0);f([a.property({json:{write:!0}})],c.prototype,"field2",void 0);f([a.property({json:{write:!0}})],c.prototype,"field3",void 0);f([a.property({json:{write:!0}})],c.prototype,"valueExpression",void 0);f([a.writer("valueExpression")],c.prototype,"writeValueExpression",
null);f([a.property({json:{write:!0}})],c.prototype,"valueExpressionTitle",void 0);f([a.writer("valueExpressionTitle")],c.prototype,"writeValueExpressionTitle",null);f([a.property({dependsOn:["valueExpression"]})],c.prototype,"compiledFunc",null);f([a.property({json:{write:!0}})],c.prototype,"legendOptions",void 0);f([a.reader("legendOptions")],c.prototype,"readLegendOptions",null);f([a.writer("legendOptions")],c.prototype,"writeLegendOptions",null);f([a.property({json:{write:!0}})],c.prototype,"defaultLabel",
void 0);f([a.property()],c.prototype,"defaultSymbol",null);f([a.reader("defaultSymbol")],c.prototype,"readDefaultSymbol",null);f([a.writer("defaultSymbol")],c.prototype,"writeDefaultSymbol",null);f([a.property({json:{write:!0}})],c.prototype,"fieldDelimiter",void 0);f([a.property({type:q,readOnly:!0})],c.prototype,"portal",void 0);f([a.reader("portal",["styleName"])],c.prototype,"readPortal",null);f([a.property({readOnly:!0,json:{write:!0}})],c.prototype,"styleOrigin",void 0);f([a.reader("styleOrigin",
["styleName","styleUrl"])],c.prototype,"readStyleOrigin",null);f([a.writer("styleOrigin")],c.prototype,"writeStyleOrigin",null);f([a.property()],c.prototype,"uniqueValueInfos",null);f([a.reader("uniqueValueInfos")],c.prototype,"readUniqueValueInfos",null);f([a.writer("uniqueValueInfos")],c.prototype,"writeUniqueValueInfos",null);f([a.property({dependsOn:["field","field2","field3"],readOnly:!0})],c.prototype,"requiredFields",void 0);c=l=f([a.subclass("esri.renderers.UniqueValueRenderer")],c);var l;
return c});