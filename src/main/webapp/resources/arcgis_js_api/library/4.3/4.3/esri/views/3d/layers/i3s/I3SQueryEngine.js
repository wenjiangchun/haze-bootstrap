// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define("require exports dojo/promise/all ../../../../core/promiseUtils ../../../../core/Error ../../../../tasks/support/FeatureSet".split(" "),function(m,n,h,f,k,l){return function(){function e(a,b){this._support=a;this._options=b}e.prototype.queryExtent=function(a){var b=this;return this._rejectUnsupported(a).then(function(){var c=0,d=b._support.createExtentBuilder();b._forAllQueried(a,function(a){c++;d.add(a)});return{count:c,extent:0===c?null:d.getExtent()}})};e.prototype.queryFeatureCount=function(a){var b=
this;return this._rejectUnsupported(a).then(function(){var c=0;b._forAllQueried(a,function(){return c++});return c})};e.prototype.queryFeatures=function(a){var b=this;return this._rejectUnsupported(a).then(function(){var c=[],d=a&&a.outFields,g=[];b._forAllQueried(a,function(a){return g.push(b._support.createGraphic(a))},function(a){d&&(c.push(b._support.requestFields(a,g,d)),g=[])});d||c.push(f.resolve(g));return h(c)}).then(function(a){a=a.reduce(function(a,b){return a.concat(b)},[]);var b=new l;
b.features=a;return b})};e.prototype.queryObjectIds=function(a){var b=this;return this._rejectUnsupported(a).then(function(){var c=[];b._forAllQueried(a,function(a){return c.push(a.id)});return c})};e.prototype._forAllQueried=function(a,b,c){var d=[];if(a&&a.objectIds){var e=a.objectIds;d.push(function(a){return 0<=e.indexOf(a.id)})}this._options.addVisibilityFilter&&d.push(this._support.createVisibilityFilter());this._support.forAll(function(a){for(var c=0;c<d.length;c++)if(!(0,d[c])(a))return;b(a)},
c)};e.prototype._rejectUnsupported=function(a){if(null==a)return f.resolve();var b=function(a){return f.reject(new k("Unsupported Query","Unsupported property '"+a+"'"))};return null!=a.distance?b("distance"):null!=a.geometryPrecision?b("geometryPrecision"):a.groupByFieldsForStatistics&&a.groupByFieldsForStatistics.length?b("groupByFieldsForStatistics"):null!=a.maxAllowableOffset?b("maxAllowableOffset"):a.multipatchOption?b("multipatchOption"):null!=a.num?b("num"):a.orderByFields&&a.orderByFields.length?
b("orderByFields"):a.outSpatialReference?b("outSpatialReference"):a.outStatistics&&a.outStatistics.length?b("outStatistics"):a.pixelSize?b("pixelSize"):a.quantizationParameters?b("quantizationParameters"):a.relationParam?b("relationParam"):a.returnDistinctValues?b("returnDistinctValues"):null!=a.start?b("start"):a.text?b("text"):a.timeExtent?b("timeExtent"):a.where?b("where"):a.geometry?b("geometry"):!this._options.enableOutFields&&a.outFields&&a.outFields.length?b("outFields"):!this._options.enableObjectId&&
a.objectIds&&a.objectIds.length?b("objectIds"):f.resolve()};return e}()});