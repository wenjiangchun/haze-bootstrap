// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define("require exports dojo/_base/lang ../../../core/lang ../../../core/promiseUtils ../../support/utils ./support/utils ./color ./size ../support/utils".split(" "),function(x,l,e,k,g,m,d,t,n,h){function u(a){if(!(a&&a.layer&&(a.field||a.valueExpression||a.sqlExpression)))return g.reject(d.createError("univariate-colorsize-visual-variables:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required"));var b=e.mixin({},a);b.basemap=d.getBasemapId(b.basemap);
b.layer=h.createLayerAdapter(b.layer);return b.layer?b.layer.load().then(function(){var a=h.getFieldsList({field:b.field,normalizationField:b.normalizationField,valueExpression:b.valueExpression});return(a=d.verifyBasicFieldValidity(b.layer,a,"univariate-colorsize-visual-variables:invalid-parameters"))?g.reject(a):b}):g.reject(d.createError("univariate-colorsize-visual-variables:invalid-parameters","'layer' must be one of these types: "+p))}function q(a,b){a=e.mixin({},a);b=0===b?a.colorOptions:a.sizeOptions;
delete a.sizeOptions;delete a.colorOptions;return e.mixin(a,b)}function v(a){if(!(a&&a.layer&&(a.field||a.valueExpression||a.sqlExpression)))return g.reject(d.createError("univariate-colorsize-continuous-renderer:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required"));var b=e.mixin({},a);b.basemap=d.getBasemapId(b.basemap);b.symbolType=b.symbolType||"2d";b.layer=h.createLayerAdapter(b.layer);return b.layer?b.layer.load().then(function(){var a=h.getFieldsList({field:b.field,
normalizationField:b.normalizationField,valueExpression:b.valueExpression});return(a=d.verifyBasicFieldValidity(b.layer,a,"univariate-colorsize-continuous-renderer:invalid-parameters"))?g.reject(a):b}):g.reject(d.createError("univariate-colorsize-continuous-renderer:invalid-parameters","'layer' must be one of these types: "+p))}function w(a){a=e.mixin({},a);var b=a.sizeOptions;delete a.sizeOptions;delete a.colorOptions;return e.mixin(a,b)}function r(a){return u(a).then(function(a){var b;return t.createVisualVariable(q(a,
0)).then(function(f){var c=q(a,1);c.statistics=f.statistics;b=f;return n.createVisualVariables(c)}).then(function(f){var c=b.visualVariable,e=f.visualVariables,d=c.stops.length;e.forEach(function(a){null!=a.minDataValue&&(a.minDataValue=c.stops[0].value,a.maxDataValue=c.stops[d-1].value)});return{basemapId:a.basemap,statistics:b.statistics,defaultValuesUsed:b.defaultValuesUsed,color:{visualVariable:c,colorScheme:b.colorScheme},size:{visualVariables:e,sizeScheme:f.sizeScheme},authoringInfo:{type:"univariate-color-size",
visualVariables:[k.clone(b.authoringInfo.visualVariables[0]),k.clone(f.authoringInfo.visualVariables[0])]}}})})}var p=h.supportedLayerTypes.join(", ");l.createVisualVariables=r;l.createContinuousRenderer=function(a){return v(a).then(function(a){var b;return n.createContinuousRenderer(w(a)).then(function(f){var c=e.mixin({},a),d=c.symbolType,g=-1<d.indexOf("3d-volumetric");delete c.symbolType;delete c.defaultSymbolEnabled;if(c.worldScale=g)c.sizeOptions=e.mixin({},c.sizeOptions),c.sizeOptions.axis=
"3d-volumetric-uniform"===d?"all":"height";c.statistics=f.statistics;b=f;return r(c)}).then(function(a){var c=b.renderer;c.visualVariables=a.size.visualVariables.map(function(a){return m.cloneSizeVariable(a)});c.visualVariables.push(m.cloneColorVariable(a.color.visualVariable));c.authoringInfo=k.clone(a.authoringInfo);return{renderer:c,statistics:b.statistics,defaultValuesUsed:b.defaultValuesUsed,color:a.color,size:a.size,basemapId:a.basemapId}})})}});