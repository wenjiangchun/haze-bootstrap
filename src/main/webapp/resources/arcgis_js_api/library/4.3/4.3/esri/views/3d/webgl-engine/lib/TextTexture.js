// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define("require exports ./Texture ./Util ../../../webgl/Texture ../../../webgl/enums".split(" "),function(m,n,k,h,l,p){return function(){function a(c,b,g){this._idHint=g;this._text=c;this._textLines=c.split(/\r?\n/);this._params=b||{color:[0,0,0]};this._params.size=this._params.size||18;this._params.font=this._params.font||{family:"Arial"};this._params.font.family=this._params.font.family||"Arial";this._params.font.weight=this._params.font.weight||"normal";this._params.font.style=this._params.font.style||
"normal";this._fillStyle="rgb("+this._params.color.map(function(c){return Math.floor(255*c)}).toString()+")"}a.prototype.getId=function(){null==this._id&&(this._id=k.idGen.gen(this._idHint));return this._id};a.prototype.getParams=function(){return this._params};a.prototype.getString=function(){return this._text};a.prototype.initializeThroughRender=function(c,b){var g=this._create2DCanvas(),a=g.getContext("2d");a.save();var d=this.getTextWidth(),f=this.getTextHeight();g.setAttribute("width",d.toString());
g.setAttribute("height",f.toString());b.samplingMode=9729;b.wrapMode=33071;b.flipped=!0;this._params.enableMipmapping&&(d=h.nextHighestPowerOfTwo(d),f=h.nextHighestPowerOfTwo(f),b.hasMipmap=!0,b.samplingMode=9985);this.renderText(1,d,f,a);c=new l(c,b,g);this._params.enableMipmapping&&this._renderMipmap(c);a.restore();return c};a.prototype.getTextWidth=function(){var c=this._create2DCanvas().getContext("2d");this._setTextProperties(c,this._params.size);var b=0,a;for(a in this._textLines){var e=c.measureText(this._textLines[a]).width;
e>b&&(b=e)}a=this._params.font;if("italic"===a.style||"oblique"===a.style||"string"===typeof a.weight&&("bold"===a.weight||"bolder"===a.weight)||"number"===typeof a.weight&&600<a.weight)b+=.3*c.measureText("A").width;return b};a.prototype.getTextHeight=function(){return this.getLineHeight()*this._textLines.length};a.prototype.getTexcoordScale=function(){if(this._params.enableMipmapping){var a=this.getTextHeight(),b=this.getTextWidth();return[b/h.nextHighestPowerOfTwo(b),a/h.nextHighestPowerOfTwo(a)]}return[1,
1]};a.prototype.getLineHeight=function(){return Math.floor(1.275*this._params.size)};a.prototype.setUnloadFunc=function(a){this._unloadFunc=a};a.prototype.unload=function(){this._unloadFunc&&(this._unloadFunc(this._id),this._unloadFunc=null)};a.prototype.renderText=function(a,b,g,e,d,f){void 0===d&&(d=0);void 0===f&&(f=0);g=this.getLineHeight()*a;this._setTextProperties(e,this._params.size*a);a="center"===e.textAlign?.5*b:"right"===e.textAlign?b:0;a+=d;d=0+f;for(var c in this._textLines)e.fillText(this._textLines[c],
a,d),d+=g};a.prototype._create2DCanvas=function(){null==a._textCanvas2D&&(a._textCanvas2D=document.createElement("canvas"),a._textCanvas2D.setAttribute("id","canvas2d"),a._textCanvas2D.setAttribute("width","1024"),a._textCanvas2D.setAttribute("height","1024"),a._textCanvas2D.setAttribute("style","display:none"));return a._textCanvas2D};a.prototype._setTextProperties=function(a,b){a.fillStyle=this._fillStyle;var c=this._params.font;a.font=c.style+" "+c.weight+" "+b+"px "+c.family;a.textAlign="left";
a.textBaseline="top";this._params.canvasStyle&&h.mergeObjects(a,this._params.canvasStyle,a)};a.prototype._renderMipmap=function(a){var b=this._create2DCanvas(),c=b.getContext("2d"),e=parseInt(b.getAttribute("width"),10)/2,d=parseInt(b.getAttribute("height"),10)/2,f=.5,h=1;do b.setAttribute("width",e.toString()),b.setAttribute("height",d.toString()),this.renderText(f,e,d,c),a.updateData(h,0,0,e,d,b),f*=.5,e*=.5,d*=.5,h++;while(1<e&&1<d)};return a}()});