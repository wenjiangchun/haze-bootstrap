// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ./ElevationInfo ../../webgl-engine/Stage ../../lib/glMatrix ../../support/aaBoundingBox".split(" "),function(r,A,u,v,w,t,e,h,k){r=h.vec3d;var x=h.mat4d,q=[0,0,0];h=function(){function c(a,b,e,f,y,d,k,g){this._addedToStage=!1;this.alignedTerrainElevation=0;this.graphics3DSymbolLayer=a;this.uniqueMaterials=f;this.uniqueGeometries=e;this.uniqueTextures=
y;this.stageObject=b;this.elevationAligner=d;this.elevationInfo=new z(k);this.stageLayer=this.stage=null;this._shown=!1;this._visibilityFlags={};this.visibilityMode=null!=g?g:c.VisibilityModes.HIDE_FACERANGE}c.prototype.initialize=function(a,b){this.stageLayer=a;this.stage=b;if(this.uniqueMaterials)for(a=0;a<this.uniqueMaterials.length;a++)b.add(e.ModelContentType.MATERIAL,this.uniqueMaterials[a]);if(this.uniqueGeometries)for(a=0;a<this.uniqueGeometries.length;a++)b.add(e.ModelContentType.GEOMETRY,
this.uniqueGeometries[a]);if(this.uniqueTextures)for(a=0;a<this.uniqueTextures.length;a++)b.add(e.ModelContentType.TEXTURE,this.uniqueTextures[a]);b.add(e.ModelContentType.OBJECT,this.stageObject)};c.prototype.isDraped=function(){return!1};c.prototype.areVisibilityFlagsSet=function(a,b){for(var c=!0,f=Object.keys(this._visibilityFlags),e=0;e<f.length;e++){var d=f[e];if(d!==b){if(d===a)return this._visibilityFlags[d];c=c&&this._visibilityFlags[d]}}return c};c.prototype.setVisibilityFlag=function(a,
b){this._visibilityFlags[a]=b;return this._calcAndSetVisibility()};c.prototype._calcAndSetVisibility=function(){if(null!=this.stage){var a=this.areVisibilityFlagsSet();return this._shown!==a?((this._shown=a)?this._addedToStage?this.stageObject.unhideAllComponents():(this.stageLayer.addObject(this.stageObject),this._addedToStage=!0):this.visibilityMode===c.VisibilityModes.HIDE_FACERANGE?this.stageObject.hideAllComponents():(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1),!0):
!1}};c.prototype.destroy=function(){var a=this.stage;if(this.stageLayer){if(this.uniqueMaterials)for(var b=0;b<this.uniqueMaterials.length;b++)a.remove(e.ModelContentType.MATERIAL,this.uniqueMaterials[b].getId());if(this.uniqueGeometries)for(b=0;b<this.uniqueGeometries.length;b++)a.remove(e.ModelContentType.GEOMETRY,this.uniqueGeometries[b].getId());if(this.uniqueTextures)for(b=0;b<this.uniqueTextures.length;b++)a.remove(e.ModelContentType.TEXTURE,this.uniqueTextures[b].getId())}a.remove(e.ModelContentType.OBJECT,
this.stageObject.getId());this._addedToStage&&(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1);this._shown=!1;this.stage=this.stageLayer=null};c.prototype.mustAlignToTerrain=function(){return null!==this.elevationAligner};c.prototype.alignWithElevation=function(a,b){this.elevationAligner&&this.elevationAligner(this,a,b)};c.prototype.setDrawOrder=function(a,b,c){};c.prototype.getBSRadius=function(){return this.stageObject.getBSRadius()};c.prototype.getCenterObjectSpace=function(){return this.stageObject.getCenter(!0)};
c.prototype.getBoundingBoxObjectSpace=function(a){var b=this.stageObject;a||(a=k.create());k.setMin(a,b.getBBMin(!0));k.setMax(a,b.getBBMax(!0));return a};c.prototype.getProjectedBoundingBox=function(a,b,c){return w(this,void 0,void 0,function(){var f,e,d,h,g,p;return v(this,function(n){switch(n.label){case 0:f=this.getBoundingBoxObjectSpace(c);e=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(d=0;d<e.length;d++)h=e[d],l[0]=f[h[0]],l[1]=f[h[1]],l[2]=f[h[2]],x.multiplyVec3(this.stageObject.objectTransformation,
l),m[3*d+0]=l[0],m[3*d+1]=l[1],m[3*d+2]=l[2];if(!a(m,0,8))return[3,6];k.set(f,k.NEGATIVE_INFINITY);for(d=0;d<m.length;d+=3)for(g=0;3>g;g++)f[g]=Math.min(f[g],m[d+g]),f[g+3]=Math.max(f[g+3],m[d+g]);if(!b)return[3,5];k.center(f,q);if(this.elevationInfo.mode===t.MODES.ABSOLUTE_HEIGHT)return[3,5];p=void 0;n.label=1;case 1:return n.trys.push([1,3,,4]),[4,b.queryElevation(q[0],q[1])];case 2:return p=n.sent(),[3,4];case 3:return n.sent(),p=null,[3,4];case 4:null!=p&&k.offset(f,0,0,-this.alignedTerrainElevation+
p),n.label=5;case 5:return[2,f];case 6:return[2,null]}})})};c.prototype.getScreenSize=function(){throw Error("Not implemented for this symbol layer/graphic type");};return c}();h.VisibilityModes={REMOVE_OBJECT:0,HIDE_FACERANGE:1};var m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l=r.create(),z=function(c){function a(a){a=c.call(this,a)||this;a.centerPointInElevationSR=null;return a}u(a,c);return a}(t);return h});