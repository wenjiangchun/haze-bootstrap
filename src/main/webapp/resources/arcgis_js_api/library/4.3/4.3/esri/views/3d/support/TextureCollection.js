// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define("../../../core/declare dojo/Deferred dojo/_base/lang ../webgl-engine/Stage ../webgl-engine/lib/Texture ../webgl-engine/lib/Util".split(" "),function(f,g,h,d,k,l){var e=l.assert;return f(null,{constructor:function(a,b,c){this._streamDataSupplier=a;this._stage=b;this._textureRecords={};this._loadedHandler=this._loadedHandler.bind(this);this._errorHandler=this._errorHandler.bind(this);this._textureOptions=c||{}},acquire:function(a,b){var c;if(c=this._textureRecords[a])return c.referenceCount++,
c.texture||c.clientDfd;if(b)return b=b(a),this._stage.add(d.ModelContentType.TEXTURE,b),c={texture:b,referenceCount:1},this._textureRecords[a]=c,b;c=new g;b=this._streamDataSupplier.request(a,"image");this._textureRecords[a]={clientDfd:c,loaderDfd:b,texture:null,referenceCount:1};b.then(this._loadedHandler,this._errorHandler);return c.promise},release:function(a){var b=this._textureRecords[a];b?(1>b.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+a),b.referenceCount--,
1>b.referenceCount&&(b.texture?(this._stage.remove(d.ModelContentType.TEXTURE,b.texture.getId()),b.texture=null):this._streamDataSupplier.cancelRequest(b.loaderDfd),delete this._textureRecords[a])):console.warn("TextureCollection: texture doesn't exist: "+a)},isInUse:function(a){a=this._textureRecords[a];e(!a||0<a.referenceCount,"texture record with zero reference count");return!!a},_loadedHandler:function(a,b,c){a=this._textureRecords[a];e(a&&!a.texture);c=h.mixin({width:b.width,height:b.height},
this._textureOptions);b=new k(b,"symbol",c);this._stage.add(d.ModelContentType.TEXTURE,b);a.texture=b;a.clientDfd.resolve(b)},_errorHandler:function(a){a=this._textureRecords[a];e(a&&!a.texture);a.clientDfd.reject()}})});