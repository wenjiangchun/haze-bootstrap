// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ./Widget ./support/widget dojo/i18n!../nls/common dojo/i18n!./LayerList/nls/LayerList ../core/HandleRegistry ./LayerList/LayerListViewModel ../core/watchUtils".split(" "),function(e,z,u,h,f,v,c,n,q,x,t,r){var y=e.toUrl("./LayerList/images/default-action.svg");e=function(e){function d(){var a=e.call(this)||this;a._handleRegistry=new x;a.createActionsFunction=null;a.operationalItems=
null;a.view=null;a.viewModel=new t;return a}u(d,e);d.prototype.postInitialize=function(){var a=this,b=this.operationalItems;this.own(r.on(this,"operationalItems","change",function(){return a._itemsChanged(b)}))};d.prototype.destroy=function(){this._handleRegistry.destroy();this._handleRegistry=null};d.prototype.triggerAction=function(a,b){};d.prototype.render=function(){var a=this,b=this._getItems(),b=0===b.length?c.jsxFactory.createElement("div",{class:"esri-layer-list__no-items"},q.noItemsToDisplay):
c.jsxFactory.createElement("ul",{class:c.join("esri-layer-list__list","esri-layer-list__list--root","esri-layer-list__list--independent"),role:"tree"},b.map(function(b,c){return a._renderItem(b,null)})),w=(g={},g["esri-disabled"]="disabled"===this.viewModel.state,g);return c.jsxFactory.createElement("div",{class:"esri-layer-list esri-widget",classes:w},b);var g};d.prototype._getItems=function(){var a=this;return this.operationalItems.toArray().filter(function(b){return a.errorsVisible||!b.error})};
d.prototype._renderItem=function(a,b){var w=this,g=this.id+"_"+a.uid,p=g+"_actions",d=!!a.children.length,e=!!a.error,h=e?q.layerError:"",f=a.visibilityMode,r=a.children&&a.children.toArray(),t=(m={},m["esri-layer-list__list--exclusive"]="exclusive"===f,m["esri-layer-list__list--inherited"]="inherited"===f,m["esri-layer-list__list--independent"]="inherited"!==f&&"exclusive"!==f,m),m=(k={},k["esri-layer-list__item--has-children"]=d,k["esri-layer-list__item--error"]=!!h,k["esri-layer-list__item--updating"]=
a.updating&&!b,k["esri-layer-list__item--invisible-at-scale"]=!a.visibleAtCurrentScale,k),u=(k=this._countActions(a.actionsSections))?this._renderActionMenuItem(a,a.actionsSections):null,v=(l={},l["esri-icon-handle-horizontal"]=!a.actionsOpen,l["esri-icon-close"]=a.actionsOpen,l),l=1<k?c.jsxFactory.createElement("div",{key:a.uid+"__actions-menu-toggle","data-item":a,onclick:this._toggleActionsOpen,onkeydown:this._toggleActionsOpen,class:"esri-layer-list__item-actions-menu-item",tabindex:"0",role:"button",
"aria-controls":p,"aria-expanded":a.actionsOpen?"true":"false",title:a.actionsOpen?n.close:n.open},c.jsxFactory.createElement("span",{"aria-hidden":"true",classes:v})):null,l=k?c.jsxFactory.createElement("div",{key:a.uid+"__actions-menu",class:"esri-layer-list__item-actions-menu"},u,l):null,p=1<k?this._renderActionsSections(a,a.actionsSections,p):null,f=d?c.jsxFactory.createElement("ul",{key:a.uid+"__child-list",class:"esri-layer-list__list",classes:t,id:g,role:"exclusive"===f?"radiogroup":"group",
hidden:a.open?null:!0},r.map(function(b,c){return w._renderItem(b,a)})):null,g=d?c.jsxFactory.createElement("span",{onclick:this._toggleChildrenClick,onkeydown:this._toggleChildrenClick,"data-item":a,key:g+"__toggle-children",class:"esri-layer-list__child-toggle",tabindex:"0",role:"button","aria-expanded":a.open?"true":"false","aria-controls":g,title:a.open?n.collapse:n.expand},c.jsxFactory.createElement("span",{"aria-hidden":"true",class:c.join("esri-layer-list__child-toggle-icon--closed","esri-icon-right-triangle-arrow")}),
c.jsxFactory.createElement("span",{"aria-hidden":"true",class:c.join("esri-layer-list__child-toggle-icon--opened","esri-icon-down-arrow")}),c.jsxFactory.createElement("span",{"aria-hidden":"true",class:c.join("esri-layer-list__child-toggle-icon--closed-rtl","esri-icon-left-triangle-arrow")})):null;b=this._createLabelNode(a,b);e=e?c.jsxFactory.createElement("div",{key:a.uid+"__error",class:"esri-layer-list__item-error-message",role:"alert"},c.jsxFactory.createElement("span",{"aria-hidden":"true",class:"esri-icon-notice-triangle"}),
c.jsxFactory.createElement("span",null,h)):null;return c.jsxFactory.createElement("li",{key:a.uid+"__list-item",class:"esri-layer-list__item",classes:m,role:"treeitem"},c.jsxFactory.createElement("div",{key:a.uid+"__list-item-container",class:"esri-layer-list__item-container"},g,b,l),e,p,f);var m,k,l};d.prototype._createLabelNode=function(a,b){b=b&&b.visibilityMode;var d=(g={},g["esri-icon-radio-checked"]="exclusive"===b&&a.visible,g["esri-icon-radio-unchecked"]="exclusive"===b&&!a.visible,g["esri-icon-visible"]=
"exclusive"!==b&&a.visible,g["esri-icon-non-visible"]="exclusive"!==b&&!a.visible,g),g="exclusive"===b?"radio":"checkbox",p=a.visible?"true":"false",e=c.jsxFactory.createElement("span",{class:"esri-layer-list__item-title"},a.title||q.untitledLayer);return"inherited"===b?c.jsxFactory.createElement("span",{key:a.uid+"__label",class:"esri-layer-list__item-label",title:a.visibleAtCurrentScale?"":q.layerInvisibleAtScale},e):c.jsxFactory.createElement("span",{key:a.uid+"__label",onclick:this._labelClick,
onkeydown:this._labelClick,"data-item":a,"data-parent-visibility":b,class:"esri-layer-list__item-label",tabindex:"0","aria-checked":p,role:g,title:a.visibleAtCurrentScale?a.visible?n.visibility.hide:n.visibility.show:q.layerInvisibleAtScale},c.jsxFactory.createElement("span",{class:"esri-layer-list__item-toggle"},c.jsxFactory.createElement("span",{class:"esri-layer-list__item-toggle-icon"},c.jsxFactory.createElement("span",{"aria-hidden":"true",classes:d}))),e);var g};d.prototype._renderActionMenuItem=
function(a,b){if(b=(b=b.getItemAt(0))&&b.getItemAt(0)){var d=this._getActionImageStyles(b),g=(e={},e[b.className]=b.className,e["esri-layer-list__item-action-image"]=d["background-image"],e);return c.jsxFactory.createElement("div",{key:b.uid+"__action-menu-item",bind:this,"data-item":a,"data-action":b,onclick:this._triggerAction,onkeydown:this._triggerAction,class:"esri-layer-list__item-actions-menu-item",role:"button",tabindex:"0",title:b.title},c.jsxFactory.createElement("span",{classes:g,styles:d}))}var e};
d.prototype._watchActionSectionChanges=function(a,b){var c=this,d="action-section"+b;this._handleRegistry.add(a.on("change",this.scheduleRender.bind(this)),d);a.forEach(function(a){return c._renderOnActionChanges(a,b)})};d.prototype._renderOnActionChanges=function(a,b){var c=this;b="actions"+b;this._handleRegistry.add([r.init(a,"className, image, id, title, visible",function(){return c.scheduleRender()})],b)};d.prototype._renderOnItemChanges=function(a){var b=this,c=a.uid,d="items"+c;this._handleRegistry.add([r.init(a,
"actionsOpen, visible, open, updating, title, visibleAtCurrentScale, error, visibilityMode",function(){return b.scheduleRender()}),a.actionsSections.on("change",function(){return b.scheduleRender()}),a.children.on("change",function(){return b.scheduleRender()})],d);a.children.forEach(function(a){return b._renderOnItemChanges(a)});a.actionsSections.forEach(function(a){return b._watchActionSectionChanges(a,c)})};d.prototype._itemsChanged=function(a){var b=this;this._handleRegistry.removeAll();a.forEach(function(a){return b._renderOnItemChanges(a)});
this.scheduleRender()};d.prototype._renderActionsSections=function(a,b,d){var e=this;b=b.toArray().map(function(b){return c.jsxFactory.createElement("ul",{key:a.uid+"__actions-list",class:"esri-layer-list__item-actions-list"},e._renderActionSection(a,b))});return c.jsxFactory.createElement("div",{key:a.uid+"__actions-section",id:d,class:"esri-layer-list__item-actions",hidden:a.actionsOpen?null:!0},b)};d.prototype._renderActionSection=function(a,b){var c=this;return(b&&b.toArray()).map(function(b){return c._renderAction(a,
b)})};d.prototype._renderAction=function(a,b){var d=this._getActionImageStyles(b),e=(f={},f[b.className]=b.className,f["esri-layer-list__item-action-image"]=d["background-image"],f);return c.jsxFactory.createElement("li",{key:b.uid+"__action",bind:this,"data-item":a,"data-action":b,onclick:this._triggerAction,onkeydown:this._triggerAction,class:"esri-layer-list__item-action",tabindex:"0",role:"button",title:b.title},c.jsxFactory.createElement("span",{"aria-hidden":"true",class:"esri-layer-list__item-action-icon",
classes:e,styles:d}),c.jsxFactory.createElement("span",{class:"esri-layer-list__item-action-title"},b.title));var f};d.prototype._countActions=function(a){return a.reduce(function(a,c){return a+c.length},0)};d.prototype._getActionImageStyles=function(a){var b=a.image||null;a.className||b||(b=y);return{"background-image":b?'url("'+b+'")':null}};d.prototype._toggleActionsOpen=function(a){a=a.currentTarget["data-item"];a.actionsOpen=!a.actionsOpen};d.prototype._triggerAction=function(a){a=a.currentTarget;
this.triggerAction(a["data-action"],a["data-item"])};d.prototype._labelClick=function(a){var b=a.currentTarget;a=b.getAttribute("data-parent-visibility");b=b["data-item"];"exclusive"===a&&b.visible||(b.visible=!b.visible)};d.prototype._toggleChildrenClick=function(a){a=a.currentTarget["data-item"];a.open=!a.open};return d}(f.declared(v));h([f.aliasOf("viewModel.createActionsFunction"),c.renderable()],e.prototype,"createActionsFunction",void 0);h([f.property(),c.renderable()],e.prototype,"errorsVisible",
void 0);h([f.aliasOf("viewModel.operationalItems"),c.renderable()],e.prototype,"operationalItems",void 0);h([f.aliasOf("viewModel.view"),c.renderable()],e.prototype,"view",void 0);h([c.vmEvent("trigger-action"),f.property({type:t}),c.renderable("viewModel.state")],e.prototype,"viewModel",void 0);h([f.aliasOf("viewModel.triggerAction")],e.prototype,"triggerAction",null);h([c.accessibleHandler()],e.prototype,"_toggleActionsOpen",null);h([c.accessibleHandler()],e.prototype,"_triggerAction",null);h([c.accessibleHandler()],
e.prototype,"_labelClick",null);h([c.accessibleHandler()],e.prototype,"_toggleChildrenClick",null);return e=h([f.subclass("esri.widgets.LayerList")],e)});