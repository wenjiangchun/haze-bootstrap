// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define("../../core/Accessor ../../core/Collection ../../core/Error ../../core/Evented ../../core/HandleRegistry ../../core/lang ../../core/promiseUtils ../../core/watchUtils ../../geometry/Extent ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/scaleUtils ../../Graphic ../../PopupTemplate ../../styles/basic ../../symbols/PictureMarkerSymbol ../../symbols/SimpleFillSymbol ../../symbols/SimpleLineSymbol ../../symbols/SimpleMarkerSymbol ../../tasks/Locator dojo/_base/array dojo/_base/lang dojo/Deferred dojo/has dojo/i18n!./nls/Search require".split(" "),
function(v,D,E,F,G,w,A,t,B,x,H,C,y,I,J,K,L,M,N,O,P,u,r,Q,p,R){var z={locator:new O({url:"//geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer"}),singleLineFieldName:"SingleLine",outFields:["Addr_type","Match_addr","StAddr","City"],name:p.esriLocatorName,localSearchOptions:{minScale:3E5,distance:5E4},placeholder:p.placeholder,resultSymbol:new K({url:R.toUrl(Q("trident")?"../../themes/base/images/search-symbol-32.png":"../../themes/base/images/search-symbol-32.svg"),size:24,width:24,height:24,
xoffset:0,yoffset:0})},S=/https?:\/\/services.*\.arcgis\.com/i;v=v.createSubclass([F],{properties:{activeSource:{},activeSourceIndex:{},allPlaceholder:{},autoNavigate:{},autoSelect:{},currentSuggestion:{},defaultSource:{readOnly:!0},resultGraphicEnabled:{},resultGraphic:{},locationToAddressDistance:{},maxInputLength:{},maxResults:{},maxSuggestions:{},minSuggestCharacters:{},placeholder:{},popup:{dependsOn:["view.popup"],readOnly:!0},popupEnabled:{},popupTemplate:{type:I},results:{},scale:{dependsOn:["view.scale"],
readOnly:!0},searchAllEnabled:{},selectedResult:{},popupOpenOnSelect:{},searchTerm:{},sources:{type:D},suggestionDelay:{},suggestions:{},suggestionsEnabled:{},view:{},zoomScale:{}},declaredClass:"esri.widgets.Search.SearchViewModel",constructor:function(){this._deferredSuggestions=[];this._handles=new G;this._manageSuggest=this._manageSuggest.bind(this)},getDefaults:function(){return u.mixin(this.inherited(arguments),{defaultSource:z,popupTemplate:{},sources:[z]})},initialize:function(){this._handles.add([t.init(this,
"activeSourceIndex",function(a){this._updateActiveSource();this._setPlaceholder(a)}.bind(this)),t.init(this,"allPlaceholder",function(){this._setPlaceholder(this.activeSourceIndex)}.bind(this)),t.init(this,"sources",function(){this._setDefaultActiveSourceIndex();this._setPlaceholder(this.activeSourceIndex)}.bind(this)),t.init(this,"searchTerm",function(a){this.currentSuggestion&&this.currentSuggestion.text!==a&&(this.currentSuggestion=null)}.bind(this)),t.init(this,"searchAllEnabled",this._setDefaultActiveSourceIndex.bind(this))])},
destroy:function(){this.clearGraphics();this._viewReadyPromise&&this._viewReadyPromise.cancel();this._handles.destroy();this._handles=null},_i18n:p,_defaultSR:H.WGS84,activeSource:null,activeSourceIndex:0,allPlaceholder:p.allPlaceholder,autoNavigate:!0,autoSelect:!0,resultGraphicEnabled:!0,popupEnabled:!0,currentSuggestion:null,defaultSource:null,resultGraphic:null,locationToAddressDistance:1500,maxInputLength:128,maxResults:6,maxSuggestions:6,minSuggestCharacters:1,placeholder:"",popup:null,_popupGetter:function(){return this.get("view.popup")||
null},popupTemplate:null,results:null,scale:null,_scaleGetter:function(){return this.get("view.scale")||null},searchAllEnabled:!0,selectedResult:null,popupOpenOnSelect:!0,searchTerm:"",sources:null,_sourcesSetter:function(a){a.forEach(function(a){a.name||(a.name=this._getSourceName(a))},this);this._set("sources",a)},suggestionDelay:150,suggestions:null,suggestionsEnabled:!0,view:null,zoomScale:1E3,clear:function(){this.set({searchTerm:"",results:null,suggestions:null,selectedResult:null,currentSuggestion:null});
this.clearGraphics();this.emit("search-clear")},search:function(a){this.emit("search-start");return this._viewReady().then(function(){return this._searchDeferred(a)}.bind(this)).then(function(a){var c=a.results;this.results=c;this.emit("search-complete",a);this._selectFirstResult(c,a.activeSourceIndex);return c}.bind(this))},suggest:function(a){a||(a=this.searchTerm);this.emit("suggest-start",{searchTerm:a});this.cancelSuggest();this._suggestionQueryTimer=setTimeout(function(){this._manageSuggest(a)}.bind(this),
this.suggestionDelay)},cancelSuggest:function(){this._cancelDeferreds();this._suggestionQueryTimer&&clearTimeout(this._suggestionQueryTimer)},select:function(a){var d=this._getDefaultSymbol(a),c,b=this.sources,e=this.activeSourceIndex,h=this.resultGraphicEnabled,f=this.autoNavigate,k=this.popupOpenOnSelect,l=this.popupEnabled,g=this.popupTemplate,n=a.feature.clone();this.selectedResult=a;if(-1===e){var q=this._getSourceIndexOfResult(a);null!==q&&(c=b.getItemAt(q),e=q)}else c=b.getItemAt(e);c&&(b=
c.featureLayer,c.hasOwnProperty("resultSymbol")&&(d=c.resultSymbol),c.hasOwnProperty("resultGraphicEnabled")&&(h=c.resultGraphicEnabled),c.hasOwnProperty("autoNavigate")&&(f=c.autoNavigate),c.hasOwnProperty("popupOpenOnSelect")&&(k=c.popupOpenOnSelect),c.hasOwnProperty("popupEnabled")&&(l=c.popupEnabled),c.hasOwnProperty("popupTemplate")?g=c.popupTemplate:b&&b.popupTemplate&&(g=b.popupTemplate));if(n){var m=this.resultGraphic,b=n.attributes,q=null;l&&(q=g);this._removeFromGraphics(m);m=new y({geometry:n.geometry,
symbol:d,attributes:b,popupTemplate:q});"text-symbol"===m.get("symbol.type")&&(m.symbol.text=a.name);var p=this.popup,d=this.view,g=new r;d&&f&&a&&a.hasOwnProperty("extent")?(f=a.extent,"3d"===d.type&&(f={target:a.extent,tilt:0}),d.goTo(f).always(g.resolve)):g.resolve();g.then(function(){h&&this._addToGraphics(m);p&&l&&k&&p.open({features:[m],location:m.geometry})}.bind(this));this.resultGraphic=m}this.emit("select-result",{result:a,source:c,sourceIndex:e})},clearGraphics:function(){this.view&&this.view.graphics.remove(this.resultGraphic);
this.resultGraphic=null},_manageSuggest:function(a){return this._viewReady().then(function(){return this._suggestDeferred(a)}.bind(this)).then(function(a){var c=null;a&&(c=a.results);this.suggestions=c;this.emit("suggest-complete",a);return c}.bind(this))},_addToGraphics:function(a){this.view&&this.view.graphics.push(a)},_removeFromGraphics:function(a){this.view&&this.view.graphics.remove(a)},_error:function(a){return new E(this.declaredClass,a)},_searchDeferred:function(a){var d=new r,c=this.searchTerm,
b=this.activeSourceIndex;a&&a.hasOwnProperty("sourceIndex")&&(b=a.sourceIndex);this.clearGraphics();var e={magicKey:this.currentSuggestion?this.currentSuggestion.magicKey:null,text:c};a?"string"===typeof a?(e.text=a,a=this._searchQueries(e)):a="object"===typeof a&&a.hasOwnProperty("magicKey")?this._searchQueries(a):"object"===typeof a&&a.hasOwnProperty("geometry")?this._searchQueries({geometry:a}):"object"===typeof a&&"point"===a.type?this._searchQueries({point:a}):a instanceof Array&&2===a.length?
this._searchQueries({latlon:a}):this._searchQueries(e):a=this._searchQueries(e);a.always(function(a){a=this._formatResults(a,b,c);d.resolve(a)}.bind(this));return d.promise},_viewReady:function(){var a=new r;this._viewReadyPromise&&this._viewReadyPromise.cancel();var d=this.view;d?this._viewReadyPromise=d.always(function(){a.resolve()}):a.resolve();return a.promise},_suggestDeferred:function(a){var d=new r;this._deferredSuggestions.push(d);var c=this.activeSourceIndex;this._suggestQueries({text:a}).always(function(b){var e;
if(b)for(var h=0;h<b.length;h++)b[h]&&(e=!0);e?(b=this._formatResults(b,c,a),d.resolve(b)):d.resolve()}.bind(this));return d.promise},_getDefaultSymbol:function(a){var d=z.resultSymbol,c,b,e=this.get("view.map.basemap.id");e||(e="topo");a&&a.feature&&a.feature.geometry&&(b=a.feature.geometry.type);if(b){if(a=J.getSchemes({theme:"default",basemap:e,geometryType:b}))c=a.primaryScheme;c&&(c.color&&c.hasOwnProperty("opacity")&&(c.color.a=c.opacity),d=c,a=c.color,c=c.size,d="point"===b?new N({color:a,
size:null!==c?c:d.size,outline:{color:d.outline.color,width:d.outline.width}}):"polyline"===b?new M({color:a,width:null!==c?c:d.width}):"polygon"===b?new L({color:a,outline:{color:d.outline.color,width:d.outline.width}}):void 0)}return d},_selectFirstResult:function(a,d){this.autoSelect&&a&&(a=this._getFirstResult(a))&&this.select(a)},_getSourceResults:function(a,d){return a&&a[d]&&a[d].results},_getSourceIndexOfResult:function(a){var d=this.results;if(d)for(var c=0;c<d.length;c++){var b=d[c].sourceIndex,
e=this._getSourceResults(d,c);if(e)for(var h=0;h<e.length;h++)if(e[h]===a)return parseInt(b,10)}return null},_getFirstResult:function(a){if(a)for(var d=0;d<a.length;d++){var c=this._getSourceResults(a,d);if(c=c&&c[0])return c}return!1},_validField:function(a,d){return a.getField(d)},_validFields:function(a,d){return a&&d?d.every(function(c){return this._validField(a,c)},this):!1},_getCodedName:function(a,d){if(a&&a.length)for(var c=0,b=a.length;c<b;c++){var e=a[c];if(e.code===d)return e.name}},_getCodedValue:function(a,
d,c){if(a&&a.length)for(var b=0,e=a.length;b<e;b++){var h=a[b],f=h.name,k=d;c||(f=f.toLowerCase(),k=k.toLowerCase());if(f===k)return h.code}return!1},_whereClause:function(a,d,c,b){var e=null;if(a){var h="";S.test(d.url)&&this._containsNonLatinCharacter(a)&&(h="N");if(c&&c.length)for(var f=0,k=c.length;f<k;f++){var l="",g=a.replace(/\'/g,"''"),l=c[f],n=d.getField(l),q=d.getFieldDomain(l);q&&"codedValue"===q.type&&(g=this._getCodedValue(q.codedValues,g,b));!1!==g&&(n=n.type,"string"===n||"date"===
n?l=b?l+" \x3d "+h+"'"+g+"'":"UPPER("+l+") LIKE "+h+"'%"+g.toUpperCase()+"%'":"oid"===n||"small-integer"===n||"integer"===n||"single"===n||"double"===n?(g=parseFloat(g),l=isNaN(g)?!1:l+" \x3d "+g):l=l+" \x3d "+g,l&&(e=e?e+" or ":"",e+=l))}}return e},_suggest:function(a){a||(a={sourceIndex:this.activeSourceIndex,text:this.searchTerm});var d=new r,c=a.sourceIndex,b=this.sources.getItemAt(c),e=b.featureLayer,h=this.suggestionsEnabled;b.hasOwnProperty("suggestionsEnabled")&&(h=b.suggestionsEnabled);var f=
0,k;a.hasOwnProperty("text")&&a.text&&(k=u.trim(a.text),f=a.text.length);a=b.minSuggestCharacters||this.minSuggestCharacters;if(h&&k&&f>=a){var l="";b.prefix&&(l+=b.prefix);l+=k;b.suffix&&(l+=b.suffix);var g=this._defaultSR,g=this.get("view.spatialReference"),h={};b.locator?(b.categories&&(h.categories=b.categories),b.locator.outSpatialReference=g,this.view&&b.localSearchOptions&&b.localSearchOptions.hasOwnProperty("distance")&&b.localSearchOptions.hasOwnProperty("minScale")&&(f=this.scale,!b.localSearchOptions.minScale||
f&&f<=parseFloat(b.localSearchOptions.minScale))&&(h.location=this.view.extent.center,h.distance=b.localSearchOptions.distance),h.text=l,b.withinViewEnabled&&this.get("view.extent")&&(h.searchExtent=this.view.extent),b.searchExtent&&(h.searchExtent=b.searchExtent),h.maxSuggestions=b.maxSuggestions||this.maxSuggestions,b.sourceCountry&&(h.countryCode=b.sourceCountry),b.countryCode&&(h.countryCode=b.countryCode),b.locator.suggestLocations(h).then(function(a){d.resolve(a)},function(a){a||(a=this._error("Locator suggestLocations could not be performed."));
d.reject(a)}.bind(this))):e?this._loadLayer(e).then(function(){if(this._supportsPagination(e)){var a=this._getDisplayField(b),h=b.searchFields||[a],f=[];b.suggestionTemplate?b.suggestionTemplate.replace(/(?:\{([^}]+)\})/g,function(a,b){f.push(b)}):f.push(a);-1===P.indexOf(f,e.objectIdField)&&f.push(e.objectIdField);var a=this._validField(e,a),k=this._validFields(e,f),p=this._validFields(e,h);a&&k&&p?(a=e.createQuery(),b.hasOwnProperty("suggestQueryParams")&&u.mixin(a,b.suggestQueryParams),a.outSpatialReference=
g,a.returnGeometry=!1,a.num=b.maxSuggestions||this.maxSuggestions,a.outFields=f,b.withinViewEnabled&&this.get("view.extent")&&(a.geometry=this.view.extent),b.searchExtent&&(a.geometry=b.searchExtent),(h=this._whereClause(l,e,h,!1))?(a.where=h,e.queryFeatures(a).then(function(a){var b;(a=a.features)&&(b=this._hydrateResults(a,c,!0));d.resolve(b)}.bind(this),function(a){a||(a=this._error("FeatureLayer queryFeatures errored with suggestions"));d.reject(a)}.bind(this))):d.resolve()):d.reject(this._error("Invalid FeatureLayer field"))}else d.resolve()}.bind(this)):
d.reject(this._error("Invalid source"))}else d.resolve();return d.promise},_loadLayer:function(a){var d=new r;a&&"not-loaded"===a.loadStatus?a.load().then(d.resolve,d.reject):d.resolve(a);return d.promise},_supportsPagination:function(a){return a&&a.get("advancedQueryCapabilities.supportsPagination")},_suggestQueries:function(a){var d=this.sources,c=this.activeSourceIndex,b=[];if(-1===c)for(c=0;c<d.length;c++)a.sourceIndex=c,b.push(this._suggest(a));else a.sourceIndex=c,b.push(this._suggest(a));return A.eachAlways(b)},
_searchQueries:function(a){a.hasOwnProperty("sourceIndex")||(a.sourceIndex=this.activeSourceIndex);var d=this.sources,c=[];if(-1===a.sourceIndex)for(var b=0;b<d.length;b++)a.sourceIndex=b,c.push(this._search(a));else c.push(this._search(a));return A.eachAlways(c)},_getPointFromGeometry:function(a){if(a&&a.type){var d=a.type;return"point"===d?a:"extent"===d?a.center:"polygon"===d?a.centroid:"multipoint"===d?a.getPoint(0):"polyline"===d?a.getPoint(0,0):a.extent.center}},_search:function(a){a||(a={text:this.searchTerm,
magicKey:null,geometry:null,point:null,sourceIndex:this.activeSourceIndex,latlon:null});var d,c=new r,b=a.sourceIndex,e=this.sources.getItemAt(b),h;a.hasOwnProperty("text")&&a.text&&(h=u.trim(a.text));if(e){var f=e.featureLayer,k="";e.prefix&&!a.magicKey&&(k+=e.prefix);k+=h;e.suffix&&!a.magicKey&&(k+=e.suffix);var l=this._defaultSR,l=this.get("view.spatialReference");if(e.locator)if(a.hasOwnProperty("text")&&h){var g={};e.categories&&(g.categories=e.categories);l&&(e.locator.outSpatialReference=l);
if(this.view&&e.localSearchOptions&&e.localSearchOptions.hasOwnProperty("distance")&&e.localSearchOptions.hasOwnProperty("minScale")){var n=this.scale;if(!e.localSearchOptions.minScale||n&&n<=parseFloat(e.localSearchOptions.minScale))g.location=this.view.extent.center,g.distance=e.localSearchOptions.distance}g.address={};g.maxLocations=e.maxResults||this.maxResults;e.withinViewEnabled&&this.get("view.extent")&&(g.searchExtent=this.view.extent);e.searchExtent&&(g.searchExtent=e.searchExtent);e.sourceCountry&&
(g.countryCode=e.sourceCountry);e.countryCode&&(g.countryCode=e.countryCode);a.magicKey&&(g.magicKey=a.magicKey);e.singleLineFieldName?g.address[e.singleLineFieldName]=k:g.address["Single Line Input"]=k;e.outFields&&(g.outFields=e.outFields);e.locator.addressToLocations(g).then(function(a){a=this._hydrateResults(a,b,!1);c.resolve(a)}.bind(this),function(a){a||(a=this._error("Locator addressToLocations could not be performed"));c.reject(a)}.bind(this))}else a.geometry?(d=this._getPointFromGeometry(a.geometry.geometry))?
this._reverseGeocodePoint(b,d).then(function(a){c.resolve(a)},function(a){c.reject(a)}):c.reject(this._error("Invalid point to reverse geocode")):a.point?this._reverseGeocodePoint(b,a.point).then(function(a){c.resolve(a)},function(a){c.reject(a)}):a.latlon?(g=new x({longitude:a.latlon[0],latitude:a.latlon[1]}),this._reverseGeocodePoint(b,g).then(function(a){c.resolve(a)},function(a){c.reject(a)})):a.hasOwnProperty("text")&&!h?c.resolve([]):c.reject(this._error("Invalid query type for Locator"));else f?
this._loadLayer(f).then(function(){var g=this._getDisplayField(e),m=e.searchFields||[g],g=this._validField(f,g),n=this._validFields(f,m);if(g&&n){g=f.createQuery();e.hasOwnProperty("searchQueryParams")&&u.mixin(g,e.searchQueryParams);l&&(g.outSpatialReference=l,n=C.getUnitValueForSR(l))&&(g.maxAllowableOffset=n);g.returnGeometry=!0;e.outFields&&(g.outFields=e.outFields);var p;a.hasOwnProperty("magicKey")||(this._supportsPagination(f)&&(g.num=e.maxResults||this.maxResults),e.withinViewEnabled&&this.get("view.extent")&&
(g.geometry=this.view.extent),e.searchExtent&&(g.geometry=e.searchExtent),p=e.exactMatch);a.hasOwnProperty("magicKey")&&a.magicKey?(g.objectIds=[a.magicKey],m=!0):a.hasOwnProperty("text")&&h&&!g.objectIds?(m=this._whereClause(k,f,m,p))?(g.where=m,m=!0):m=!1:a.geometry?(g.geometry=a.geometry,m=!0):a.point?(g.geometry=a.point,m=!0):a.latlon?(d=new x({longitude:a.latlon[0],latitude:a.latlon[1]}),g.geometry=d,m=!0):(a.hasOwnProperty("text")&&!h?c.resolve([]):c.reject(this._error("Invalid query type for FeatureLayer")),
m=!1);m?f.queryFeatures(g).then(function(a){a=a.features;var d;a&&(d=this._hydrateResults(a,b,!1));c.resolve(d)}.bind(this),function(a){a||(a=this._error("FeatureLayer queryFeatures could not be performed"));c.reject(a)}.bind(this)):c.resolve()}else c.reject(this._error("Invalid FeatureLayer field"))}.bind(this)):c.reject(this._error("Invalid source"))}else c.reject(this._error("Source is undefined"));return c.promise},_isError:function(a){return a instanceof Error||a.hasOwnProperty("code")||a.hasOwnProperty("message")?
!0:!1},_formatResults:function(a,d,c){c={activeSourceIndex:d,searchTerm:c,numResults:0,numErrors:0,errors:null,results:null};var b=this.sources,e=[],h=[],f;if(a){var k,l;if(-1===d)for(d=0;d<a.length;d++)k=(f=a[d])&&f.value||[],l=f&&f.error,f=b.getItemAt(d),l?(e.push({sourceIndex:d,source:f,error:l}),c.numErrors++):(h.push({sourceIndex:d,source:f,results:k}),c.numResults+=k.length);else k=(f=a[0])&&f.value||[],l=f&&f.error,f=b.getItemAt(d),l?(e.push({sourceIndex:d,source:f,error:l}),c.numErrors++):
(h.push({sourceIndex:d,source:f,results:k}),c.numResults+=k.length)}c.numErrors&&(c.errors=e);c.numResults&&(c.results=h);return c},_reverseGeocodePoint:function(a,d){var c=new r,b=this.sources.getItemAt(a);if(d&&b){var e=b.locationToAddressDistance||this.locationToAddressDistance;b.locator.outSpatialReference=this._defaultSR;b.locator.outSpatialReference=this.get("view.spatialReference");b.locator.locationToAddress(d,e).then(function(b){b=this._hydrateResults([b],a,!1);c.resolve(b)}.bind(this),function(a){a||
(a=this._error("Locator locationToAddress could not be performed"));c.reject(a)}.bind(this))}else c.reject(this._error("No point or source defined for reverse geocoding"));return c.promise},_cancelDeferreds:function(){this._deferredSuggestions.forEach(function(a){a.cancel(this.declaredClass+" cancelling request")},this);this._deferredSuggestions.length=0},_getFeatureLayerName:function(a){var d=a.featureLayer;if(d){var c=d.title;(a.searchFields||[this._getDisplayField(a)]).forEach(function(a,e){c=
0===e?c+": ":c+", ";e=d.getField(a);c+=e&&e.alias||a});return c}},_getSourceName:function(a){return this._getName(a)||this._getFeatureLayerName(a)||p.untitledSource},_getName:function(a){return a&&a.name},_getFirstStringField:function(a){if(a&&(a=a.fields)&&a.length)for(var d=0;d<a.length;d++){var c=a[d];if("string"===c.type)return c.name}return""},_getDisplayField:function(a){return a.displayField||a.featureLayer.displayField||this._getFirstStringField(a.featureLayer)},_validExtent:function(a){return a&&
a.xmin&&"NaN"!==a.xmin&&a.ymin&&"NaN"!==a.ymin&&a.xmax&&"NaN"!==a.xmax&&a.ymax&&"NaN"!==a.ymax},_hydrateResult:function(a,d,c){var b={},e=this._defaultSR,h,f=this.sources.getItemAt(d),k=this.get("view.map"),e=this.get("view.spatialReference");if(a.hasOwnProperty("text")&&a.hasOwnProperty("magicKey"))return a;if(a instanceof y&&!c){if(b.feature=a.clone(),h=b.feature.geometry)h.spatialReference=e}else if(a.hasOwnProperty("location")){var l=new x({x:a.location.x,y:a.location.y,spatialReference:e});h=
{};a.hasOwnProperty("attributes")&&(h=a.attributes);a.hasOwnProperty("score")&&(h.score=a.score);b.feature=new y({geometry:l,attributes:h})}else c||(b.feature=null);if(a.hasOwnProperty("extent")&&this._validExtent(a.extent))b.extent=new B(a.extent),b.extent.spatialReference=e;else if(b.feature&&b.feature.geometry&&!c)switch(b.feature.geometry.type){case "extent":b.extent=b.feature.geometry;break;case "multipoint":b.extent=b.feature.geometry.extent;break;case "polygon":b.extent=b.feature.geometry.extent;
break;case "polyline":b.extent=b.feature.geometry.extent;break;case "point":k?(e=this.zoomScale,f&&f.zoomScale&&(e=f.zoomScale),b.extent=this.scale>e?C.getExtentForScale(this.view,e).clone().centerAt(b.feature.geometry):this.view.extent.clone().centerAt(b.feature.geometry)):b.extent=new B({xmin:b.feature.geometry.x-.25,ymin:b.feature.geometry.y-.25,xmax:b.feature.geometry.x+.25,ymax:b.feature.geometry.y+.25})}else c||(b.extent=null);f.featureLayer?(k=this._getDisplayField(f),e=f.featureLayer.getFieldDomain(k),
c?(f.suggestionTemplate?b.text=w.substitute(a.attributes,f.suggestionTemplate):k&&a.hasOwnProperty("attributes")&&a.attributes.hasOwnProperty(k)&&(k=a.attributes[k],b.text=e&&"codedValue"===e.type?this._getCodedName(e.codedValues,k):k),b.text||(b.text=p.untitledResult),b.magicKey=a.attributes[f.featureLayer.objectIdField],b.sourceIndex=d):f.searchTemplate?b.name=w.substitute(a.attributes,f.searchTemplate):k&&a.hasOwnProperty("attributes")&&a.attributes.hasOwnProperty(k)&&(k=a.attributes[k],b.name=
e&&"codedValue"===e.type?this._getCodedName(e.codedValues,k):k)):"object"===typeof a.address&&f.searchTemplate?b.name=w.substitute(a.address,f.searchTemplate):a.hasOwnProperty("name")?b.name=a.name:a.hasOwnProperty("attributes")&&"object"===typeof a.attributes&&a.attributes.Match_addr?(b.name=a.attributes.Match_addr,a.attributes.Addr_type&&"POI"===a.attributes.Addr_type&&a.attributes.StAddr&&a.attributes.City&&(b.name+=" - "+a.attributes.StAddr+", "+a.attributes.City)):a.hasOwnProperty("address")&&
"string"===typeof a.address?b.name=a.address:a.hasOwnProperty("address")&&"object"===typeof a.address&&(a.address.hasOwnProperty("Match_addr")||a.address.hasOwnProperty("Address"))?b.name=a.address.Match_addr||a.address.Address:b.feature&&b.feature.geometry&&(b.name=b.feature.geometry.x+","+b.feature.geometry.y);c?b.text||(b.text=p.untitledResult):b.name||(b.name=p.untitledResult);return b},_hydrateResults:function(a,d,c){var b=[],e=a&&a.length;if(e)for(var h=0;h<e;h++){var f=this._hydrateResult(a[h],
d,c);b.push(f)}return b},_containsNonLatinCharacter:function(a){for(var d=0;d<a.length;d++)if(255<a.charCodeAt(d))return!0;return!1},_setPlaceholder:function(a){var d="",c=this.sources.getItemAt(a);-1===a?d=this.allPlaceholder||p.allPlaceholder:c&&c.placeholder&&(d=c.placeholder);this.placeholder=d},_updateActiveSource:function(){var a=this.sources,d=this.activeSourceIndex;this.activeSource=a&&a.getItemAt(d)||null},_setDefaultActiveSourceIndex:function(){var a=this.sources;this.activeSourceIndex=
a&&1===a.length||!this.searchAllEnabled?0:-1}});v.ALL_INDEX=-1;return v});