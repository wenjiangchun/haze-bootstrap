// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define("../../core/Accessor ../../core/Scheduler ../../core/now ../ViewAnimation ./unitBezier ./viewpointUtils".split(" "),function(m,n,d,g,f,h){var l=function(a,b,c,e){var k=a.targetGeometry,d=b.targetGeometry;e?"string"===typeof e&&(e=f.parse(e)||f.ease):e=f.ease;this.easing=e;this.duration=c;this.sCenterX=k.x;this.sCenterY=k.y;this.sScale=a.scale;this.sRotation=a.rotation;this.tCenterX=d.x;this.tCenterY=d.y;this.tScale=b.scale;this.tRotation=b.rotation;this.dCenterX=this.tCenterX-this.sCenterX;
this.dCenterY=this.tCenterY-this.sCenterY;this.dScale=this.tScale-this.sScale;this.dRotation=this.tRotation-this.sRotation;180<this.dRotation?this.dRotation-=360:-180>this.dRotation&&(this.dRotation+=360)};l.prototype.applyRatio=function(a,b){var c=this.easing(b),e,d;1<=b?(b=this.tCenterX,e=this.tCenterY,d=this.tRotation,c=this.tScale):(b=this.sCenterX+c*this.dCenterX,e=this.sCenterY+c*this.dCenterY,d=this.sRotation+c*this.dRotation,c=this.sScale+c*this.dScale);a.targetGeometry.x=b;a.targetGeometry.y=
e;a.scale=c;a.rotation=d};return m.createSubclass({constructor:function(){this._updateTask=n.addFrameTask({postRender:this._postRender.bind(this)});this._updateTask.pause()},getDefaults:function(){return{viewpoint:h.create()}},properties:{animation:null,duration:{value:200},transition:{value:null},easing:{value:f.ease},viewpoint:null},animateTo:function(a,b,c){h.copy(this.viewpoint,b);this.transition=new l(this.viewpoint,a,c&&c.duration||this.duration,c&&c.easing||this.easing);this.animation&&(this.animation.stop(),
this.animation=null);a=this.animation=new g({target:a.clone()});a.always(function(){this._updateTask&&(this._updateTask.pause(),this.animation=null)}.bind(this));this._startTime=d();this._updateTask.resume();return a},animateContinous:function(a,b){this.updateFunction=b;this.viewpoint=a;this.animation&&(this.animation.stop(),this.animation=null);a=this.animation=new g({target:a.clone()});a.always(function(){this._updateTask&&(this._updateTask.pause(),this.animation=null)}.bind(this));this._startTime=
d();this._updateTask.resume();return a},stop:function(){this.animation&&(this.animation.finish(),this.animation=this.updateFunction=null)},_postRender:function(a){if((a=this.animation)&&a.state!==g.STOPPED){if(this.updateFunction)this.updateFunction(this.viewpoint);else{a=(d()-this._startTime)/this.transition.duration;var b=1<=a;this.transition.applyRatio(this.viewpoint,a);b&&this.animation.finish()}this.animation._dfd.progress(this.viewpoint)}else this._updateTask.pause()}})});