// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/extendsHelper ../../core/tsSupport/decorateHelper ./Bucket ./style/StyleLayer ./LineTess".split(" "),function(r,t,n,u,p,q,e){return function(m){function g(a,c,b,d,f){a=m.call(this,a,c)||this;a.extrudeVectorsDoubleBuffer=[e.allocExtrudeVectors(),e.allocExtrudeVectors()];a.recycledTriangleBridge=e.allocTriangles(20);a.recycledTrianglePie=e.allocTriangles(20);a.lineVertexBuffer=b;a.lineIndexBuffer=d;return a}n(g,m);Object.defineProperty(g.prototype,"triangleIndexStart",
{get:function(){return this.triangleElementsStart},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"triangleIndexCount",{get:function(){return this.triangleElementsCount},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"connectorStart",{get:function(){return 0},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"connectorCount",{get:function(){return 0},enumerable:!0,configurable:!0});g.prototype.assignBufferInfo=function(a){a.triangleElementsStart=
this.triangleElementsStart;a.triangleElementsCount=this.triangleElementsCount};g.prototype.processFeatures=function(a,c){this.triangleElementsStart=this.lineIndexBuffer.index;this.triangleElementsCount=0;a&&a.setExtent(this.layerExtent);c=new q.LineLayout(this.layer,this.zoom);for(var b=0,d=this._features;b<d.length;b++){var f=d[b].getGeometry(a);this._processFeature(c,f)}};g.prototype._processFeature=function(a,c){if(c)for(var b=c.length,d=0;d<b;d++)this._processGeometry(c[d],a)};g.prototype._processGeometry=
function(a,c){if(!(2>a.length)){var b=a[0],d=a[a.length-1],f=d.x-b.x,b=d.y-b.y,f=1E-6>f*f+b*b;if(!(2>a.length)){b=a[0];for(d=1;d<a.length;){var k=a[d].x-b.x,l=a[d].y-b.y;1E-6>k*k+l*l?a.splice(d,1):(b=a[d],++d)}if(!(2>a.length)){this.vertices=a;this.isClosed=f;this.cap=c.cap;this.join=c.join;this.almostParallelRads=.05;this.veryShallowRads=.1;this.miterSafeRads=e.MITER_SAFE_RADS;this.miterLimitMag=Math.min(c.miterLimit,e.SYSTEM_MAG_LIMIT);this.roundLimitRads=Math.min(c.roundLimit,.5);this.newRoundJoinsSafeRads=
2.3;c=this.lineIndexBuffer.index;for(var b=0,h=void 0,d=0;d<a.length;++d)l=a[d],k=h===this.extrudeVectorsDoubleBuffer[d%2]?this.extrudeVectorsDoubleBuffer[(d+1)%2]:this.extrudeVectorsDoubleBuffer[d%2],this._computeExtrudeVectors(k,d),this._writeGPUVertices(l.x,l.y,b,k),!k.capCenter||f&&d===a.length-1||this._writeGPUPieElements(k),h&&this._writeGPUBridgeElements(h,k),d<a.length-1&&(h=a[d+1],l=e.length([h.x-l.x,h.y-l.y]),b+=l),h=k;this.triangleElementsCount+=3*(this.lineIndexBuffer.index-c)}}}};g.prototype._computeExtrudeVectors=
function(a,c){var b=this.vertices,d=this.isClosed,f=b[c],k=[void 0,void 0],l=[void 0,void 0];if(0<c&&c<b.length-1){var h=b[(c+b.length-1)%b.length],g=b[(c+1)%b.length];e.normalize(k,[f.x-h.x,f.y-h.y]);e.normalize(l,[g.x-f.x,g.y-f.y])}else if(0===c)g=b[(c+1)%b.length],e.normalize(l,[g.x-f.x,g.y-f.y]),d?(h=b[b.length-2],e.normalize(k,[f.x-h.x,f.y-h.y])):k=l;else if(c===b.length-1)h=b[(c+b.length-1)%b.length],e.normalize(k,[f.x-h.x,f.y-h.y]),d?(h=b[1],e.normalize(l,[h.x-f.x,h.y-f.y])):l=k;else throw Error("Parameter i out of range.");
d||0!==c?d||c!==b.length-1?this._computeJoinExtrudeVectors(a,k,l):this._computeCapExtrudeVectors(a,k,l,e.CapPosition.END):this._computeCapExtrudeVectors(a,k,l,e.CapPosition.START)};g.prototype._computeCapExtrudeVectors=function(a,c,b,d){if(0===this.cap)e.buttCap(a,c,b);else if(1===this.cap)e.roundCap(a,c,b,d,e.getNumberOfSlices(Math.PI));else if(2===this.cap)e.squareCap(a,c,b,d);else throw Error("Unknown cap type!");};g.prototype._computeJoinExtrudeVectors=function(a,c,b){var d=e.getRads(c,b);if(d>
Math.PI-this.almostParallelRads)e.rectJoin(a,c,b);else if(2===this.join||d<this.veryShallowRads)d<this.almostParallelRads?e.fastMiterJoin(a,c,b):d<this.miterSafeRads?e.miterJoin(a,c,b):e.bevelJoin(a,c,b,this.miterLimitMag);else if(0===this.join)e.bevelJoin(a,c,b,1);else if(1===this.join){var f=e.getNumberOfSlices(d);d<this.newRoundJoinsSafeRads?2>f||d<this.roundLimitRads?e.bevelJoin(a,c,b,1):e.roundJoin(a,c,b,f):e.unitRoundJoin(a,c,b,f)}};g.prototype._writeGPUVertices=function(a,c,b,d){for(var f=
0;f<d.vectors.count;++f){var e=this.lineVertexBuffer.add(a,c,d.vectors.items[f].vector[0],d.vectors.items[f].vector[1],0,d.vectors.items[f].side,b);d.vectors.items[f].base=e}};g.prototype._writeGPUBridgeElements=function(a,c){e.bridge(this.recycledTriangleBridge,a,c,!1);for(a=0;a<this.recycledTriangleBridge.count;++a)c=this.recycledTriangleBridge.items[a],this.lineIndexBuffer.add(c.v1.base,c.v2.base,c.v3.base)};g.prototype._writeGPUPieElements=function(a){e.pie(this.recycledTrianglePie,a);for(a=0;a<
this.recycledTrianglePie.count;++a){var c=this.recycledTrianglePie.items[a];this.lineIndexBuffer.add(c.v1.base,c.v2.base,c.v3.base)}};return g}(p)});