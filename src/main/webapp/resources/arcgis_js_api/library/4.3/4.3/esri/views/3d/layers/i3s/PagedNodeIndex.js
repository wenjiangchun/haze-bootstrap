// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define("require exports ../../lib/glMatrix ../../support/projectionUtils ../../support/aaBoundingBox ../../support/orientedBoundingBox".split(" "),function(v,w,p,u,q,r){return function(){function c(a,b,f){this._pages=[];this.pageSize=0;this._renderSR=this._nodeSR=null;this._nodeSR=a;this._renderSR=b;this.pageSize=f}c.prototype.addPage=function(a,b){for(;this._pages.length<a;)this._pages.push(null);for(var f=this._pages,c=this._nodeSR,g=this._renderSR,h=new r.ObbArray(b.length),d=0;d<b.length;d++)u.bufferToBuffer(b[d].obb.center,
c,0,h.obbs[d].center,g,0,1),p.vec3.set(b[d].obb.halfSize,h.obbs[d].halfSize),p.quat4.set(b[d].obb.quaternion,h.obbs[d].quaternion);f[a]={nodes:b,renderObbs:h.obbs,parents:new Uint32Array(this.pageSize)};a=this._pages;b=this.pageSize;for(f=[0];f.length;)for(c=f.pop(),g=a[c/b|0].nodes[c%b],h=0;h<g.childCount;h++)d=g.firstChild+h,null!=a[d/b|0]&&(a[d/b|0].parents[d%b]=c,f.push(d))};c.prototype.hasPage=function(a){return!!this._pages[a]};c.prototype.getNode=function(a){var b=this.pageSize;return this._pages[a/
b|0].nodes[a%b]};c.prototype.getRenderObb=function(a){var b=this.pageSize;return this._pages[a/b|0].renderObbs[a%b]};c.prototype.getRenderCenter=function(a){return this.getRenderObb(a).center};c.prototype.getParentId=function(a){var b=this.pageSize;return this._pages[a/b|0].parents[a%b]};c.prototype.hasNodes=function(a,b){b=(a+b-1)/this.pageSize|0;for(a=a/this.pageSize|0;a<=b;a++)if(null==this._pages[a])return!1;return!0};c.prototype.createVisibilityTraverse=function(){var a=this,b=[],c=[],p=q.create();
return function(g,h){b.length=0;b.push(0);c.length=0;for(c.push(0);0<b.length;){var d=b.pop(),f=c.pop(),l=a.getNode(d),m=a.getRenderObb(d),n=!0;if(null!=g.clippingBox){var k=1<<g.frustumPlanes.length;if(0===(f&k)){var e=r.toAaBoundingBox(m,p);q.containsAabb(g.clippingBox,e)?f|=k:q.intersectsAabb(g.clippingBox,e)||(n=!1)}}for(e=0;e<g.frustumPlanes.length&&n;e++)if(k=1<<e,0===(f&k)){var t=r.intersectPlane(m,g.frustumPlanes[e]);0<t?n=!1:0>t&&(f|=k)}if(h.predicate(d,l,n)){m=l.firstChild;l=l.childCount;
e=!1;n=(m+l-1)/a.pageSize|0;for(k=m/a.pageSize|0;k<=n;k++)if(!a.hasPage(k)){h.pageMiss(d,k);e=!0;break}if(!e)for(e=0;e<l;e++)b.push(m+e),c.push(f)}}}};return c}()});