// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define("require exports ./IdGen ./Util ./DDSUtil ./gl-matrix ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/enums ./DefaultVertexBufferLayouts ./DefaultVertexAttributeLocations".split(" "),function(l,B,q,k,n,r,t,m,u,v,w,C,x,y){function z(c,b,a,e,g,h,d){d=!1!==d;var f=new Image;f.onerror=function(){h(null);f.onerror=void 0;f.onload=void 0};f.onload=function(){k.assert(1<=f.width&&1<=f.height);a.samplingMode=
d?9987:9729;a.hasMipmap=d;if(k.isPowerOfTwo(f.width)&&k.isPowerOfTwo(f.height))a.width=f.width,a.height=f.height,b=new m(c,a,f);else var b=p(c,f,a,e,g);c.bindTexture(b);h(b);f.onerror=void 0;f.onload=void 0};f.src=b}function p(c,b,a,e,g){var h=k.nextHighestPowerOfTwo(b.width),d=k.nextHighestPowerOfTwo(b.height);k.assert(h!==b.width||d!==b.height);a.width=h;a.height=d;var f=new m(c,a),l=t.createWithAttachments(c,f,{colorTarget:0,depthStencilTarget:0});b=new m(c,{target:3553,pixelFormat:6408,dataType:5121,
wrapMode:33071,samplingMode:9728,flipped:!0,maxAnisotropy:8},b);c.bindFramebuffer(l);void 0===g&&(g=c.getViewport(),g=[g.x,g.y,g.width,g.height]);c.setViewport(0,0,h,d);e=e.get("texOnly");h=A.identity();c.bindProgram(e);e.setUniformMatrix4fv("model",h);e.setUniformMatrix4fv("view",h);e.setUniformMatrix4fv("proj",h);e.setUniform4fv("color",new Float32Array([1,1,1,1]));e.setUniform1i("tex",0);e=new v(c,y.Default3D,{geometry:x.Pos3Tex},{geometry:w.createVertex(c,35044,k.createQuadVertexUvBuffer())});
c.bindTexture(b,0);c.bindVAO(e);c.setDepthTestEnabled(!1);c.setBlendingEnabled(!1);c.drawArrays(5,0,u.vertexCount(e,"geometry"));c.setDepthTestEnabled(!0);c.bindFramebuffer(null);c.setViewport(g[0],g[1],g[2],g[3]);e.dispose(!0);b.dispose();c.bindFramebuffer(null);l.detachColorTexture();l.dispose();a.hasMipmap&&f.generateMipmap();return f}var A=r.mat4d;l=function(){function c(b,a,e){this.data=b;this.id=c.idGen.gen(a);this.unloadFunc=void 0;this.params=e||{};this.params.wrapClamp=this.params.wrapClamp||
!1;this.params.mipmap=!1!==this.params.mipmap;this.params.noUnpackFlip=this.params.noUnpackFlip||!1;this.estimatedTexMemRequiredMB=c.estimateTexMemRequiredMB(this.data,this.params)}c.estimateTexMemRequiredMB=function(b,a){return null==b?0:b instanceof ArrayBuffer||b instanceof Uint8Array?b.byteLength/1E6:b instanceof Image||b instanceof ImageData||b instanceof HTMLCanvasElement?1.3*b.width*b.height*4/1E6:1.3*a.width*a.height*4/1E6||0};c.prototype.getId=function(){return this.id};c.prototype.getEstimatedTexMemRequiredMB=
function(){return this.estimatedTexMemRequiredMB};c.prototype.dispose=function(){this.data=void 0};c.prototype.deferredLoading=function(){return"string"===typeof this.data};c.prototype.getWidth=function(){return this.params.width};c.prototype.getHeight=function(){return this.params.height};c.prototype.initializeThroughUpload=function(b,a,e,g,h){var d=this.data;a.flipped=!this.params.noUnpackFlip;a.samplingMode=this.params.mipmap?9987:9729;a.hasMipmap=this.params.mipmap;if("string"===typeof d)z(b,
d,a,e,g,h,this.params.mipmap);else if(d instanceof Image||d instanceof ImageData||d instanceof HTMLCanvasElement)this.params.width=d.width,this.params.height=d.height,!this.params.mipmap&&this.params.wrapClamp||k.isPowerOfTwo(d.width)&&k.isPowerOfTwo(d.height)?(a.width=d.width,a.height=d.height,a=new m(b,a,d)):a=p(b,d,a,e,g),b.bindTexture(a),h(a);else if(d instanceof ArrayBuffer&&this.params.encoding===c.DDS_ENCODING)a=n.createDDSTexture(b,a,d,this.params.mipmap),b.bindTexture(a),h(a);else if(d instanceof
Uint8Array&&this.params.encoding===c.DDS_ENCODING)a=n.createDDSTexture(b,a,d.buffer,this.params.mipmap),b.bindTexture(a),h(a);else if(d instanceof Uint8Array)k.assert(0<this.params.width&&0<this.params.height),a.pixelFormat=1===this.params.components?6409:6408,a.width=this.params.width,a.height=this.params.height,a=new m(b,a,d),b.bindTexture(a),h(a);else if(null!==d)throw console.warn("Unsupported image data"),Error("Unsupported image data");this.data=void 0};c.prototype.setUnloadFunc=function(b){this.unloadFunc=
b};c.prototype.unload=function(){void 0!==this.unloadFunc&&(this.unloadFunc(this.id),this.unloadFunc=void 0)};return c}();l.idGen=new q;l.DDS_ENCODING="image/vnd-ms.dds";return l});