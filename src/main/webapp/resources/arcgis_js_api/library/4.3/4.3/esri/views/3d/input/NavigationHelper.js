// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define("require exports ../lib/glMatrix ../support/earthUtils ../webgl-engine/lib/Util ../support/mathUtils".split(" "),function(m,n,a,p,q,r){m=function(){function g(b){this.picker=b;this.earthUtils=p;this._axisTmp1=a.vec3d.create();this._axisTmp2=a.vec3d.create();this._axisTmp3=a.vec3d.create();this._tmpTransform2=a.mat4d.create();this.spherical=new t(this);this.planar=new u(this)}g.prototype.normalizeRotationDelta=function(a){for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;return a};
g.prototype.rotationFromPointsAroundAxis=function(b,d,c){var e=this._axisTmp1,f=this._axisTmp2,h=this._axisTmp3;a.vec3d.set(b,f);a.vec3d.set(d,h);b=a.vec3d.dot(f,c);d=a.vec3d.dot(h,c);a.vec3d.scale(c,b,e);a.vec3d.subtract(f,e);a.vec3d.normalize(f);a.vec3d.scale(c,d,e);a.vec3d.subtract(h,e);a.vec3d.normalize(h);b=a.vec3d.dot(f,h);a.vec3d.cross(c,f,e);c=a.vec3d.dot(h,e);return Math.atan2(c,b)};g.prototype.applyRotation=function(b,d,c,e){var f=this._tmpTransform2;a.mat4d.identity(f);a.mat4d.rotate(f,
e,c);a.vec3d.subtract(b.eye,d);a.mat4d.multiplyVec3(f,b.eye,b.eye);a.vec3d.add(b.eye,d);a.vec3d.subtract(b.center,d);a.mat4d.multiplyVec3(f,b.center,b.center);a.vec3d.add(b.center,d);a.mat4d.multiplyVec3(f,b.up,b.up);b.markViewDirty()};return g}();n.NavigationHelper=m;var u=function(){function g(b){this._helper=b;this._tmpForward=a.vec3d.create();this._tmpP0=a.vec3d.create();this._tmpP1=a.vec3d.create()}g.prototype.applyZoom=function(b,d,c,e,f){b=this._tmpForward;f=1-f;a.vec3d.subtract(e,c.eye,b);
var h=a.vec3d.length(b),g=h*(1-f);0<=f&&4>g&&(g=4);g=d.navigation.limitAltitude(g,e,b,h,0<=f?-1:1);1E-6>Math.abs(h-g)||(f=-(g-h)/h,a.vec3d.scale(b,f),a.vec3d.add(c.eye,b),a.vec3d.lerp(c.center,e,f),d.navigation.fixTargetUpVector(),c.markViewDirty())};g.prototype.intersectPlaneFromScreenPoint=function(b,d,c,e){var f=this._tmpP0,g=this._tmpP1;this._helper.picker.createPickRay(c,null,d.viewMatrix,f,g);a.vec3d.subtract(g,f);d=a.vec3d.dot(b.normal,g);if(0===d)return!1;b=a.vec3d.dot(b.normal,f)-b.distance;
a.vec3d.add(f,a.vec3d.scale(g,-b/d,e),e);return!0};g.prototype.computePointCenter=function(b,d){a.vec3d.set3(0,0,0,d);for(var c=0;c<b.length;c++)a.vec3d.add(d,b[c]);a.vec3d.scale(d,1/b.length)};return g}(),t=function(){function g(b){this._helper=b;this._tmpForward=a.vec3d.create();this._tmpP0=a.vec3d.create();this._tmpP1=a.vec3d.create();this._tmpAxis=a.vec3d.create();this._tmpTransform=a.mat4d.create()}g.prototype.applyZoom=function(b,d,c,e){var f=this._tmpForward;a.vec3d.subtract(c.center,c.eye,
f);b/=a.vec3d.length(c.center);var g=1-b,k=a.vec3d.length(f),l;l=d.navigation.limitAltitude(k*e,c.center,f,k);e=l/k;1E-6>Math.abs(k-l)||(a.vec3d.scale(c.center,b+g*e),a.vec3d.scale(f,e),a.vec3d.subtract(c.center,f,c.eye),c.markViewDirty(),d.navigation.applyConstraints(c))};g.prototype.makeRenderCoordSpherePoint=function(b,d,c,e){this._helper.picker.createPickRay(c,null,d.viewMatrix,this._tmpP0,this._tmpP1);a.vec3d.subtract(this._tmpP1,d.eye);this.intersect(b,d.eye,this._tmpP1,e)||this.closestPointOnSilhouette(b,
d.eye,this._tmpP0,e)};g.prototype.intersect=function(a,d,c,e){return q.raySphereClosestPositive(d,c,a,e)};g.prototype.closestPointOnSilhouette=function(b,d,c,e){var f=this._tmpAxis,g=this._tmpTransform;a.vec3d.cross(d,c,f);a.vec3d.cross(f,d,e);a.vec3d.scale(e,1/a.vec3d.length(e)*b);b=-r.asin(b/a.vec3d.length(d));a.mat4d.identity(g);a.mat4d.rotate(g,b,f);a.mat4d.multiplyVec3(g,e)};g.prototype.rotationFromPoints=function(b,d,c,e){a.vec3d.cross(d,c,e);return-Math.acos(1-a.vec3d.dist2(d,c)/(2*b*b))};
g.prototype.computePointCenter=function(b,d,c){a.vec3d.set3(0,0,0,c);for(var e=0;e<b.length;e++)a.vec3d.add(c,b[e]);a.vec3d.normalize(c);a.vec3d.scale(c,d)};return g}()});