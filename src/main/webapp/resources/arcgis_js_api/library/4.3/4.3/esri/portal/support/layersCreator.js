// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define("require exports dojo/has ../../core/promiseUtils ../../core/requireUtils ../../layers/Layer ../../renderers/support/styleUtils".split(" "),function(q,f,B,h,r,t,u){function v(e,a,b){var c,g;return r.when(q,"../../layers/"+a).then(function(a){var d={};e.itemId&&(d.portalItem={id:e.itemId,portal:b.context.portal});g=c=new a(d);g.read(e,b.context);return u.loadStyleRenderer(g,b.context).then(function(){return h.resolve(c)})})}function l(e,a){var b=e.layerType||e.type;!b&&a&&a.defaultLayerType&&
(b=a.defaultLayerType);var c;switch(a.context.origin){case "web-scene":switch(a.context.layerContainerType){case "basemap":c=w;break;case "ground":c=x;break;default:c=y}break;default:switch(a.context.layerContainerType){case "basemap":c=z;break;default:c=A}}return v(e,c[b]||"UnknownLayer",a)}function m(e,a,b){return a&&a.filter?b.then(function(c){var b=a.filter(c);return void 0===b?h.resolve(c):b instanceof t?h.resolve(b):b}):b}function k(e,a,b){if(!a)return[];for(var c=[],g=[],f=0;f<a.length;f++){var d=
a[f],k=l(d,b);c.push(k);g.push(null);if("GroupLayer"===d.layerType&&d.layers&&Array.isArray(d.layers)&&0<d.layers.length){d=d.layers.map(function(a){return l(a,b)});c.push.apply(c,d);for(var n=0;n<d.length;n++)g.push(k)}}var p={};return c.map(function(a,c){var d=function(a,b){p[b.id]=c;var d=a.findIndex(function(a){if(!a.id)return!1;a=p[a.id];return void 0===a?!1:c<a});0>d&&(d=void 0);a.add(b,d)};return m(e,b,a).then(function(a){if(null===g[c])d(e,a);else return g[c].then(function(b){d(b.layers,a);
return h.resolve(a)});return h.resolve(a)})})}var y={ArcGISFeatureLayer:"FeatureLayer",ArcGISMapServiceLayer:"MapImageLayer",PointCloudLayer:"PointCloudLayer",ArcGISSceneServiceLayer:"SceneLayer",IntegratedMeshLayer:"IntegratedMeshLayer",ArcGISTiledElevationServiceLayer:"ElevationLayer",ArcGISTiledImageServiceLayer:"TileLayer",ArcGISTiledMapServiceLayer:"TileLayer",GroupLayer:"GroupLayer",OpenStreetMap:"OpenStreetMapLayer",WebTiledLayer:"WebTileLayer",CSV:"CSVLayer",VectorTileLayer:"VectorTileLayer",
DefaultTileLayer:"TileLayer"},x={ArcGISTiledElevationServiceLayer:"ElevationLayer",DefaultTileLayer:"ElevationLayer"},w={ArcGISTiledMapServiceLayer:"TileLayer",ArcGISTiledImageServiceLayer:"TileLayer",OpenStreetMap:"OpenStreetMapLayer",WebTiledLayer:"WebTileLayer",DefaultTileLayer:"TileLayer",VectorTileLayer:"VectorTileLayer"},A={ArcGISFeatureLayer:"FeatureLayer",ArcGISImageServiceLayer:"ImageryLayer",ArcGISImageServiceVectorLayer:"UnsupportedLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISStreamLayer:"StreamLayer",
ArcGISTiledElevationServiceLayer:"ElevationLayer",ArcGISTiledImageServiceLayer:"TileLayer",ArcGISTiledMapServiceLayer:"TileLayer",GroupLayer:"GroupLayer",OpenStreetMap:"OpenStreetMapLayer",VectorTileLayer:"VectorTileLayer",WebTiledLayer:"WebTileLayer",CSV:"CSVLayer",GeoRSS:"GeoRSSLayer",KML:"UnsupportedLayer",WMS:"UnsupportedLayer",DefaultTileLayer:"TileLayer"},z={ArcGISImageServiceLayer:"ImageryLayer",ArcGISImageServiceVectorLayer:"UnsupportedLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISTiledImageServiceLayer:"TileLayer",
ArcGISTiledMapServiceLayer:"TileLayer",OpenStreetMap:"OpenStreetMapLayer",VectorTileLayer:"VectorTileLayer",WebTiledLayer:"WebTileLayer",bingLayer:"UnsupportedLayer",WMS:"UnsupportedLayer",DefaultTileLayer:"TileLayer"};f.createLayer=l;f.processLayer=m;f.populateLayers=k;f.populateOperationalLayers=function(e,a,b){return k(e,a,b)}});