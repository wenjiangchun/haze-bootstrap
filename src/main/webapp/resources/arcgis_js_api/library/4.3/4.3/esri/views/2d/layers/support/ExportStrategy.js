// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define(["require","exports","../../engine/Bitmap","../../viewStateUtils","../../../../geometry/Extent"],function(p,q,m,l,n){var e=[0,0,0,0],b=[0,0];return function(){function g(b,f,a,c,d,k,e){void 0===c&&(c=0);void 0===d&&(d=!1);void 0===k&&(k=2048);void 0===e&&(e=2048);this.container=b;this.fetchImage=f;this.requestUpdate=a;this.debouncing=c;this.rotationSupported=d;this.imageMaxWidth=k;this.imageMaxHeight=e;this._imagePromise=null}g.prototype.destroy=function(){};Object.defineProperty(g.prototype,
"updating",{get:function(){return null!==this._imagePromise},enumerable:!0,configurable:!0});g.prototype.update=function(h){var f=this,a=h.state;this._imagePromise&&(this._imagePromise.cancel(),this._imagePromise=null);if(h.stationary){this.rotationSupported?(b[0]=a.width,b[1]=a.height):l.getOuterSize(b,a);b[0]=Math.min(b[0],this.imageMaxWidth||2048);b[1]=Math.min(b[1],this.imageMaxHeight||2048);l.getBBox(e,a,b);var c={extent:new n(e[0],e[1],e[2],e[3],a.spatialReference),width:b[0],height:b[1],rotation:this.rotationSupported?
a.rotation:0};h=this.fetchImage(c);h.then(function(d){f._imagePromise=null;var a=new m(d);a.coords[0]=d.coords[0]=c.extent.xmin;a.coords[1]=d.coords[1]=c.extent.ymax;a.resolution=d.resolution=c.extent.width/b[0];d.rotation=c.rotation;a.width=c.width;a.height=c.height;f.container.removeAllChildren();f.container.addChild(a)}).otherwise(function(a){f._imagePromise=null;if("cancel"!==a.dojoType)throw a;});this._imagePromise=h}};g.prototype.updateExports=function(b,e){for(var a=0,c=this.container.children;a<
c.length;a++){var d=c[a];if(!d.visible||!d.attached)break;b(d,e)?console.error("ExportStrategy.updateExports doesn't support promise yet"):d.requestRender()}};return g}()});