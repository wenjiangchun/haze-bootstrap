// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/screenUtils ../../../symbols/support/Symbol3DOutline ../../../symbols/support/symbolPreview ../../../core/promiseUtils dojo/_base/lang dojo/Deferred dojo/dom-construct dojo/on dojo/i18n!../nls/SymbolStyler".split(" "),function(U,c,n,P,Q,R,S,T,C,D,h){function q(a,b){a[b]||(a[b]={})}function g(a,b){return-1<a.indexOf(b)}function k(a){return a&&"Icon"===a.type}function m(a){return a&&"Object"===a.type}function t(a){return a&&"Extrude"===a.type}function u(a){return a&&
"Text"===a.type}function v(a){return l(a,"simple-line","2d")}function p(a){return l(a,"simple-marker","2d")}function w(a){return l(a,"picture-marker","2d")}function e(a){return g(a.type,"3d")}function f(a){return a.symbolLayers.getItemAt(0)}function E(a,b){return l(a,"marker",b)||l(a,"point",b)}function l(a,b,d){b=g(a&&a.type,b+"-symbol");return d?b&&("3d"===d?e(a):!e(a)):b}function F(a,b){return l(a,"line",b)}function G(a,b){return l(a,"fill",b)}function x(a){return e(a)?!1:a&&"string"===typeof a.style&&
g(r,a.style)}function y(a){if(e(a))return a=(a=f(a))&&"Fill"===a.type||k(a)&&H(a)?{color:a.outline.color,size:n.pt2px(a.outline.size)}:a&&"Line"===a.type||a&&"Path"===a.type?{color:a.material&&a.material.color,size:n.pt2px(a.size)}:null,a;a=v(a)?{color:a.color,size:a.width}:l(a,"fill","2d")||p(a)?{color:a.get("outline.color"),size:a.get("outline.width")}:null;return a}function I(a,b){!isNaN(b)&&a&&(e(a)?(a=f(a),k(a)||a&&"Fill"===a.type?(q(a,"outline"),a.outline.size=n.px2pt(b)):a&&"Line"===a.type?
(q(a,"size"),a.size=n.px2pt(b)):a&&"Path"===a.type&&(q(a,"size"),a.size=b)):v(a)?a.width=b:a&&a.outline&&(a.outline.width=b))}function J(a,b){b&&a&&!e(a)&&(b=y(a).color?b:"none",v(a)?a.style=b:a&&a.outline&&(a.outline.style=b))}function K(a,b){if(a&&!isNaN(b))if(e(a))if(a=f(a),k(a)||u(a))a.size=n.px2pt(b);else if(m(a)){var d=a.width,c=a.height,h=a.depth;b/=Math.max(d,c,h);a.set({width:d*b,height:c*b,depth:h*b})}else t(a)&&(a.size=b);else d=a.width,d!==b&&(w(a)?(c=a.url,b=L({dimensions:a,targetDimension:"width",
targetSize:b}),a.height=b.height,a.width=b.width,c&&"http://"!==c&&(g(c,"http://")||g(c,"data:"))&&(a.xoffset||a.yoffset)&&(b=a.width/d,a.xoffset=Math.round(a.xoffset*b),a.yoffset=Math.round(a.yoffset*b))):a.size=b)}function M(a,b){e(a)?z(a,{color:b}):a.color=b}function A(a,b){if(e(a)){var d=f(a);d&&"Line"===d.type||d&&"Path"===d.type?z(a,{color:b}):(q(d,"outline"),d.outline.color=b)}else y(a).color=b}function L(a){var b=a.dimensions,d=a.targetSize;return"height"===("height"===a.targetDimension?"height":
"width")?{height:d,width:b.width/b.height*d}:{height:b.height/b.width*d,width:d}}function z(a,b){a=f(a);a.material=b.color?S.mixin({},a.material,b):void 0}function N(a){return k(a)&&g(r,a.get("resource.primitive"))}function H(a){return k(a)?a.outline&&!a.get("resource.href"):!1}function O(a,b){return e(a)&&e(b)?(a=f(a),b=f(b),k(a)&&k(b)&&!a.resource.href&&!b.resource.href&&!g(r,a.resource.primitive)&&g(r,b.resource.primitive)):B(a,b)}function B(a,b){return p(a)&&p(b)&&!x(a)&&x(b)}var r=["x","cross"];
c.is3d=e;c.getSymbolLayer=f;c.isPoint=E;c.hasExtrudeSymbolLayer=function(a){return e(a)&&t(f(a))};c.hasTextSymbolLayer=function(a){return e(a)&&u(f(a))};c.isLine=F;c.isPolygon=G;c.hasPureOutlineStyle=x;c.getOutline=y;c.setOutlineWidth=I;c.setOutlineStyle=J;c.setSize=K;c.getMarkerLength=function(a){if(e(a)){a=f(a);if(k(a)||u(a))return n.pt2px(a.size);if(m(a))return Math.max(a.width,a.height,a.depth);if(t(a))return a.size}else{if(p(a))return a.size;if(w(a))return Math.max(a.width,a.height,a.depth)}};
c.setFillColor=M;c.getFillColor=function(a){return e(a)?f(a).get("material.color"):a.color};c.setOutlineColor=A;c.renderOnSurface=function(a,b,d){void 0===d&&(d=24);return Q.renderPreviewHTML(a,{node:b,size:d})};c.preserveAspectRatio=L;c.testImageUrl=function(a){var b=new T,d=C.create("img"),c=D(d,"load",function(){0===d.width&&0===d.height?b.reject("image has both width and height of 0"):b.resolve({width:d.width,height:d.height})}),e=D(d,"error",function(a){b.reject("error ocurred while loading image",
a)});d.src=a;b.promise.always(function(){c.remove();e.remove();C.destroy(d)});return b.promise};c.updateShape=function(a){e(a.symbol);K(a.symbol,a.size)};c.updateFill=function(a){e(a.symbol);M(a.symbol,a.color)};c.updateOutline=function(a){e(a.symbol)?A(a.symbol,a.color):(A(a.symbol,a.color),J(a.symbol,a.pattern));I(a.symbol,a.size)};c.blendsIntoBackground=function(a){if(e(a))return!1;var b=void 0;return(b=a&&a.outline?a.outline.color:a.color)&&246<b.r&&246<b.g&&246<b.b};c.updateMaterial=z;c.ensureSupportedSimpleFillSymbolStyle=
function(a){l(a,"simple-fill","2d")&&"solid"!==a.style&&"none"!==a.style&&(a.style="solid")};c.getApplicableTabs=function(a,b){void 0===b&&(b=[]);if(e(a)){a=f(a);var d=a.type,c=["Icon","Object"],h=["Icon","Object","Fill","Extrude","Text"],l=["Icon","Fill","Line","Path"];return{shape:{state:g(b,"shape")||!g(c,d)?"excluded":"enabled"},fill:{state:g(b,"fill")||!g(h,d)?"excluded":N(a)?"disabled":"enabled"},outline:{state:g(b,"outline")||!g(l,d)?"excluded":!k(a)||H(a)||N(a)?"enabled":"disabled"}}}var d=
a.type,c=["simple-marker-symbol","picture-marker-symbol"],h=["simple-marker-symbol","simple-fill-symbol"],l=["simple-marker-symbol","simple-line-symbol","simple-fill-symbol"],m=F(a),n=G(a);return{shape:{state:g(b,"shape")||m||n?"excluded":g(c,d)?"enabled":"disabled"},fill:{state:g(b,"fill")||m?"excluded":h[0]===d&&g(["circle","square","diamond"],a.style)||h[1]===d?"enabled":"disabled"},outline:{state:g(b,"outline")?"excluded":g(l,d)?"enabled":"disabled"}}};c.getSizeUnit=function(a){return e(a)&&(a=
f(a).type,"Extrude"===a||"Object"===a)?"meters":"pixels"};c.getOutlineUnit=function(a){return e(a)&&"Path"===f(a).type?"meters":"pixels"};c.getSymbolSource=function(a){return e(a)?E(a)?(a=f(a),m(a)?"web-style:volumetric":k(a)?"web-style:flat":"web-style"):"web-style":"symbol-set"};c.getDimensionality=function(a){a=f(a).type;return"Object"===a||"Path"===a||"Extrude"===a?"volumetric":"flat"};c.ensureProps=function(a){if(e(a)){var b=f(a);if(k(b)&&(b.outline||(b.outline=new P.Symbol3DOutline({color:void 0,
size:0})),void 0===b.size))return b.computeSize().then(function(d){b.size=d[0];return a});if(m(b)&&void 0===b.width&&void 0===b.height&&void 0===b.depth)return b.computeSize().then(function(d){b.set({width:d[0],height:d[1],depth:d[2]});return a})}return R.resolve(a)};c.switchedFromRasterToVectorSymbol=function(a,b){return e(a)&&e(b)?(a=f(a),b=f(b),k(a)&&m(b)&&!!a.resource.href&&!b.resource.href&&!!b.resource.primitive):w(a)&&p(b)};c.switchedToPureOutline=O;c.switchedFromPureOutline=function(a,b){return e(a)&&
e(b)?O(b,a):B(b,a)};c.switchedSmsStyleToPureOutline=B;c.getSymbolName=function(a){if(!e(a))return"";var b=f(a);if(!k(b)&&!m(b))return"";if(a.styleOrigin)return a.styleOrigin.name;if(b.get("resource.href")||!b.get("resource.primitive"))return"";a=b.get("resource.primitive");if(k(b))return h[a];if(m(b)){var d=b.depth,c=b.height,b=b.width;return{sphere:h.sphere,cylinder:h.cylinder,"tall-cylinder":h.tallCylinder,cube:h.cube,"tall-cube":h.tallCube,cone:h.cone,"tall-cone":h.tallCone,"inverted-cone":h.invertedCone,
diamond:h.diamond,tetrahedron:h.tetrahedron}[b&&d&&c&&b===d&&b<c?"tall-"+a:a]}}});