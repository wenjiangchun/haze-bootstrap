// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define("require exports dojo/has ./PerformanceTimer ./gl-matrix ./Object3D".split(" "),function(h,v,w,x,m,q){var e=m.vec3d,d=m.mat4d,n=d.create(),r=e.create(),t=e.create();h=function(){function a(f,b,c,a,u,k,g){void 0===g&&(g=!1);this.dir=e.create();this.normalDir=null;this.minResult=new p;this.maxResult=new p;this.invertedM=d.create();this.enableHUDSelection=!0;this.enableInvisibleTerrain=!1;this.enableBackfacesTerrain=!0;this.performanceInfo={queryDuration:0,numObjectsTested:0};this.intersectObject=
this.intersectObject.bind(this);this.init(f,b,c,a,u,k,g)}a.prototype.init=function(f,b,c,a,d,k,g){b&&c&&e.subtract(c,b,this.dir);this.minResult.init(b,c);this.maxResult.init(b,c);this.numObjectsTested=0;this.point=a;this.camera=d;this.isSelection=g;this.layers=f;this.p0=b;this.p1=c;this.hudResults=[];null==k&&(k=1E-5);this.tolerance=k;if(this.layers)for(f=0;f<this.layers.length;++f)if(b=this.layers[f],c=b.getSpatialQueryAccelerator?b.getSpatialQueryAccelerator():void 0)c.forEachAlongRay(this.p0,this.dir,
this.intersectObject);else for(b=b.getObjects(),c=0;c<b.length;++c)this.intersectObject(b[c])};a.prototype.getDirection=function(){this.normalDir||(this.normalDir=e.create(),e.normalize(this.dir,this.normalDir));return this.normalDir};a.prototype.intersectObject=function(f){var b=this;this.numObjectsTested++;for(var c=f.getId(),a=f.getGeometryRecords(),e=f.getObjectTransformation(),k,g=0;g<a.length;g++){var l=a[g],h=l.geometry,m=l.materials,q=l.instanceParameters;k=h.getId();d.set(e,n);d.multiply(n,
l.getShaderTransformation());d.inverse(n,this.invertedM);d.multiplyVec3(this.invertedM,this.p0,r);d.multiplyVec3(this.invertedM,this.p1,t);m[0].intersect(h,q,n,this,r,t,function(a,e,g,d,h){0<=a&&(h?(h=new p,h.set(f,c,a,e,d,f.getCenter(),k,g),b.hudResults.push(h)):((null==b.minResult.priority||d>=b.minResult.priority)&&(null==b.minResult.dist||a<b.minResult.dist)&&b.minResult.set(f,c,a,e,d,null,k,g),(null==b.maxResult.priority||d>=b.maxResult.priority)&&(null==b.maxResult.dist||a>b.maxResult.dist)&&
b.maxResult.set(f,c,a,e,d,null,k,g)))},l.customTransformation)}};a.prototype.getMinResult=function(){return this.minResult};a.prototype.getMaxResult=function(){return this.maxResult};a.prototype.getHudResults=function(){return this.hudResults};return a}();h.DEFAULT_TOLERANCE=1E-5;h.Result=typeof p;var p=function(){function a(a,b){this.normal=e.create();this.init(a,b)}a.prototype.getIntersectionPoint=function(a){if(null==this.dist)return!1;e.lerp(this.p0,this.p1,this.dist,a);return!0};a.prototype.set=
function(a,b,c,d,h,k,g,l){this.dist=c;e.set(d,this.normal);this.targetType=a?a instanceof q?"StageObject":"StagePoint":"None";this.target=a;this.name=b;this.priority=h;this.center=k;this.geometryId=g;this.triangleNr=l};a.prototype.setIntersector=function(a){this.intersector=a};a.prototype.init=function(a,b){this.dist=void 0;this.targetType="None";this.priority=this.name=this.target=void 0;this.triangleNr=this.geometryId=this.center=null;this.intersector="stage";this.p0=a;this.p1=b};return a}();return h});