// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define("require exports dojo/_base/lang dojo/Deferred dojox/gfx/matrix dojox/gfx ../../request ../../core/sniff ../../core/Error ../../core/promiseUtils ../../core/urlUtils".split(" "),function(I,u,z,A,B,C,D,v,E,w,F){function G(a){return a.map(function(b){return b.command+" "+b.values.join(",")}).join(" ").trim()}function H(a,b,c,h){var d=h&&h.node||document.createElement("div"),f=C.createSurface(d,b,c);null!=h.opacity&&(d.style.opacity=h.opacity.toString());try{a.forEach(function(a){var d=f.createGroup(),
g=0;a.forEach(function(a){var b=a.shape,c=a.fill,e=a.stroke;g+=e&&e.width||0;var f=null;b&&("path"===b.type&&"string"!==typeof b.path&&(b.path=G(b.path)),"image"===b.type&&b.src&&"data:"!==b.src.substr(0,5)&&(b.src+=(-1===b.src.indexOf("?")?"?":"\x26")+"legend\x3d1"),f=d.createShape(b).setFill(c).setStroke(e?e:{width:0}),"text"===b.type&&f.setFont(a.font))});var e=d.getBoundingBox();a=e.width;var k=e.height,n=-(e.x+a/2),l=-(e.y+k/2),p=f.getDimensions(),n={dx:n+p.width/2,dy:l+p.height/2},l=!1;if(h.scale&&
0!==e.width&&0!==e.height){var l=e.width/e.height,m=(b>c?b:c)-2*g,r=1,t=1;isNaN(m)||(1<l?(r=m/e.width,t=m/l/e.height):(t=m/e.height,r=m*l/e.width));d.applyTransform(B.scaleAt(r,t,p.width/2,p.height/2));l=!0}!l&&(a>b||k>c)&&(e=a/b>k/c,a=((e?b:c)-5)/(e?a:k),z.mixin(n,{xx:a,yy:a}));d.applyTransform(n)})}catch(g){return f.clear(),f.destroy(),null}return d}function x(a,b){a=Math.ceil(a);b=Math.ceil(b);var c=document.createElement("canvas");c.width=a;c.height=b;c.style.width=a+"px";c.style.height=b+"px";
c=c.getContext("2d");c.clearRect(0,0,a,b);return c}function y(a,b,c,h){if(!a)return w.reject(new E("renderUtils: imageDataSize","href not provided."));var d;if(F.isDataProtocol(a)){var f=new Image;f.src=a;if(f.complete)d=w.resolve({data:f});else{var g=new A;d=g.promise;f.onload=function(){g.resolve({data:f})};f.onerror=g.reject}}else c||(a+=(-1===a.indexOf("?")?"?":"\x26")+"legend\x3d1"),d=D(a,{responseType:"image",allowImageDataAccess:c});return d.then(function(a){a=a.data;var d=a.width,e=a.height,
f=d/e,g=b;h&&(g=Math.min(g,Math.max(d,e)));return{image:c?a:null,width:1>=f?Math.ceil(g*f):g,height:1>=f?g:Math.ceil(g/f)}}).otherwise(function(d){if(c)return y(a,b,!1,h);throw d;})}u.renderSymbol=function(a,b,c){var h=Math.ceil(b[0]);b=Math.ceil(b[1]);return a.some(function(a){return!!a.length})?H(a,h,b,c):null};u.tintImageWithColor=function(a,b,c,h){return y(a,b,!!c,h).then(function(d){var f=d.width?d.width:b,g=d.height?d.height:b;if(d.image&&c){var h=x(f,g),q=d.image.width,e=d.image.height;(v("edge")||
v("ie"))&&/\.svg$/i.test(a)&&(--q,--e);h.drawImage(d.image,0,0,q,e,0,0,f,g);h.globalCompositeOperation="source-atop";h.rect(0,0,f,g);h.fillStyle=c.toCss();h.fill();var k=x(f,g);k.drawImage(d.image,0,0,q,e,0,0,f,g);k.globalCompositeOperation="multiply";k.drawImage(h.canvas,0,0);a=k.canvas.toDataURL("image/png")}return{url:a,width:f,height:g}}).otherwise(function(){return{url:a,width:b,height:b}})}});