// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/_base/lang ../core/accessorSupport/decorators ../core/HandleRegistry ../core/watchUtils ../core/promiseUtils ../Viewpoint ../geometry/Point ../geometry/ScreenPoint ../geometry/Extent ../geometry/SpatialReference ./View ./ViewAnimation ./2d/FrameTask ./2d/PaddedViewState ./2d/MapViewConstraints ./2d/AnimationManager ./2d/viewpointUtils".split(" "),function(c,C,r,f,l,g,t,m,u,v,k,w,n,x,y,z,p,A,q,B,h){c=
function(c){function d(a){var b=c.call(this,a)||this;b._frameTask=new p(b);b._handles=new t;b.interacting=!1;b.resizeAlign="center";b.type="2d";b.constraints=new q;b.padding={top:0,right:0,bottom:0,left:0};b._frameTask=new p(b);b.watch("stationary",function(a){b._frameTask.stationary=a;b._frameTask.requestFrame()},!0);b.watch("state.viewpoint",function(a){b._flipStationary();b._frameTask.requestFrame()},!0);b._handles.add([b.on("resize",function(a){return b._resizeHandler(a)})]);b.watch("ready",function(a){return b._readyWatcher(a)},
!0);b.watch("animationManager.animation",function(a){b.animation||(b.animation=a)});a=b.notifyChange.bind(b,"tileInfo");m.on(b,"map.basemap.baseLayers","change",a,a,a);m.on(b,"map.layers","change",a,a,a);var e=function(){this._set("updating",this.layerViewManager.factory.working||this.allLayerViews.some(function(a){return!0===a.updating}))}.bind(b);b.allLayerViews.on("change",function(){e();b._handles.remove("layerViewsUpdating");b._handles.add(b.allLayerViews.map(function(a){return a.watch("updating",
e)}).toArray(),"layerViewsUpdating")});return b}r(d,c);Object.defineProperty(d.prototype,"animation",{set:function(a){var b=this,e=this._get("animation");e&&e.stop();!a||a.isFulfilled()?this._set("animation",null):(this._set("animation",a),a.then(function(){return b.animation=null},function(){return b.animation=null},function(a){return b.state.viewpoint=a}))},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"center",{get:function(){if(!this.ready)return this._get("center");var a=
this.content.center;return new k({x:a[0],y:a[1],spatialReference:this.content.spatialReference})},set:function(a){if(null!=a)if(this.ready){var b=this.viewpoint;h.centerAt(b,b,a);this.viewpoint=b}else this._set("center",a),this.notifyChange("initialExtentRequired")},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"constraints",{set:function(a){var b=this,e=this._get("constraints");e&&(this._handles.remove("constraints"),e.view=null);this._set("constraints",a);a&&(this.ready&&(a.view=
this,this.state.viewpoint=a.constrain(this.content.viewpoint,null)),this._handles.add(a.on("update",function(){b.ready&&b.state&&(b.state.viewpoint=a.constrain(b.content.viewpoint,null))}),"constraints"))},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"extent",{get:function(){return this.ready?this.content.extent.clone():this._get("extent")},set:function(a){if(null!=a)if(this.ready){var b=this.viewpoint;h.setExtent(b,b,a,this.size,{constraints:this.constraints});this.viewpoint=
b}else this._set("extent",a),this._set("center",null),this._set("scale",0),this.notifyChange("initialExtentRequired")},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"initialExtentRequired",{get:function(){var a=this.get("map.initialViewProperties.viewpoint"),b=this._get("extent"),e=this._get("center"),c=this._get("scale"),d=this._get("viewpoint"),g=this._get("zoom"),f=this.initialExtent;return a?!(!(e&&0<c)||f):f?!1:!(b||d||e&&(0<c||-1!==g))},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"padding",{get:function(){return this.ready?this.state.padding:this._get("padding")},set:function(a){this.ready?(this.state.padding=a,this._set("padding",this.state.padding)):this._set("padding",a)},enumerable:!0,configurable:!0});d.prototype._readyGetter=function(){var a=this.get("map.basemap"),b=this.get("map.basemap.baseLayers.0"),e=this.get("map.layers.0"),c=!0;a&&a.load();b&&b.load();e&&e.load();a&&a.loaded?b&&b.loaded?c=!1:!b&&e&&e.loaded&&(c=!1):a||(e&&e.loaded?c=!1:e||(c=!1));return this.inherited(arguments)&&
!c};Object.defineProperty(d.prototype,"rotation",{get:function(){return this.ready?this.content.rotation:this._get("rotation")},set:function(a){if(!isNaN(a))if(this.ready){var b=this.viewpoint;h.rotateTo(b,b,a);this.viewpoint=b}else this._set("rotation",a)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"scale",{get:function(){return this.ready?this.content.scale:this._get("scale")},set:function(a){if(!isNaN(a))if(this.ready){var b=this.viewpoint;h.scaleTo(b,b,a);this.viewpoint=
b}else{this._set("scale",a);if(a=this._get("extent"))this._set("extent",null),this._set("center",a.center);this.notifyChange("initialExtentRequired")}},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"stationary",{get:function(){return!this.animation&&!this.interacting&&!this._get("resizing")&&!this._stationaryTimer},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"tileInfo",{get:function(){return this.get("map.basemap.baseLayers.0.tileInfo")||this.get("map.layers.0.tileInfo")},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"viewpoint",{get:function(){return this.ready?this.content.viewpoint.clone():this._get("viewpoint")},set:function(a){if(null!=a)if(this.ready){var b=h.create();h.copy(b,a);this.constraints.constrain(b,this.content.viewpoint);this.state.viewpoint=b;this._frameTask.requestFrame();this._set("viewpoint",b)}else this._set("viewpoint",a),this.notifyChange("initialExtentRequired")},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"zoom",{get:function(){return this.ready?this.constraints.scaleToZoom(this.scale):this._get("zoom")},set:function(a){if(null!=a&&(this.ready||(this.notifyChange("initialExtentRequired"),this._set("zoom",a)),this.constraints.effectiveLODs)){var b=this.viewpoint;h.scaleTo(b,b,this.constraints.zoomToScale(a));this.viewpoint=b;this._set("zoom",this.constraints.scaleToZoom(this.scale))}},enumerable:!0,configurable:!0});d.prototype.goTo=function(a,b){var e=this,c=this.content;b=l.mixin({animate:!0},b,{spatialReference:this.spatialReference||
null,size:c?c.size:this.size,currentViewpoint:c?c.viewpoint:this.viewpoint,constraints:this.constraints,snapToZoom:this.constraints.snapToZoom});return h.createAsync(a,b).then(function(a){if(b.animate){var c=null;if(!e.ready||!e.animationManager)return e.viewpoint=a,c=new z({target:a}),c.finish(),c;e.constraints.constrain(a,e.viewpoint);return c=e.animation=e.animationManager.animateTo(a,e.viewpoint,b)}e.viewpoint=a})};d.prototype.hitTest=function(a,b){return u.reject("Should be implemented by subclasses")};
d.prototype.toMap=function(a,b,c){if(!this.ready)return null;a&&null!=a.x&&(c=b,b=a.y,a=a.x);var e=[0,0];this.state.toMap(e,[a,b]);c=c||new k;c.x=e[0];c.y=e[1];c.spatialReference=this.spatialReference;return c};d.prototype.toScreen=function(a,b,c,d){if(!this.ready)return null;a&&null!=a.x&&(d=b,b=a.y,a=a.x);d=c||d||new w;a=[a,b];this.state.toScreen(a,a);d.x=a[0];d.y=a[1];return d};d.prototype.pixelSizeAt=function(a,b){if(!this.ready)return NaN;a&&null!=a.x&&(b=a.y,a=a.x);return this.content.pixelSizeAt([a,
b])};d.prototype.requestLayerViewUpdate=function(a){this.ready&&this._frameTask.requestLayerViewUpdate(a)};d.prototype.getDefaultSpatialReference=function(){return this.get("map.initialViewProperties.spatialReference")||this.get("defaultsFromMap.spatialReference")};d.prototype._resizeHandler=function(a){var b=this.state;if(b){var c=this.content.viewpoint,d=this.content.size.concat();b.size=[a.width,a.height];h.resize(c,c,d,this.content.size,this.resizeAlign);c=this.constraints.constrain(c,null);this.state.viewpoint=
c}};d.prototype._readyWatcher=function(a){a||this._frameTask.stop();this.constraints.view=this;a={zoom:this._get("zoom"),scale:this._get("scale"),center:this._get("center"),extent:this._get("extent"),padding:this._get("padding"),rotation:this._get("rotation"),viewpoint:this._get("viewpoint")};var b=this.get("map.initialViewProperties.viewpoint"),b=h.create(!b||a.center||a.extent?a:{viewpoint:b},{spatialReference:this.spatialReference,size:this.size,constraints:this.constraints,extent:this.initialExtent});
this._set("animationManager",new B);this.state=new A({padding:a.padding,size:this.size,viewpoint:b});this.content=this.state.content;this._frameTask.start()};d.prototype._flipStationary=function(){var a=this;this._stationaryTimer&&clearTimeout(this._stationaryTimer);this._stationaryTimer=setTimeout(function(){a._stationaryTimer=null;a.notifyChange("stationary")},160);this.notifyChange("stationary")};return d}(g.declared(y));f([g.property()],c.prototype,"animation",null);f([g.property({readOnly:!0})],
c.prototype,"animationManager",void 0);f([g.property({value:null,type:k,dependsOn:["content.center"]})],c.prototype,"center",null);f([g.property({type:q})],c.prototype,"constraints",null);f([g.property()],c.prototype,"content",void 0);f([g.property({value:null,type:n,dependsOn:["content.extent"]})],c.prototype,"extent",null);f([g.property({readOnly:!0})],c.prototype,"interacting",void 0);f([g.property({type:n})],c.prototype,"initialExtent",void 0);f([g.property({dependsOn:["map.initialViewProperties.viewpoint"]})],
c.prototype,"initialExtentRequired",null);f([g.property({value:{top:0,right:0,bottom:0,left:0},cast:function(c){return l.mixin({top:0,right:0,bottom:0,left:0},c)}})],c.prototype,"padding",null);f([g.property()],c.prototype,"resizeAlign",void 0);f([g.property({value:0,type:Number,dependsOn:["content.rotation"]})],c.prototype,"rotation",null);f([g.property({type:Number,dependsOn:["content.scale"]})],c.prototype,"scale",null);f([g.property({type:x,dependsOn:["map.initialViewProperties.spatialReference"]})],
c.prototype,"spatialReference",void 0);f([g.property()],c.prototype,"state",void 0);f([g.property()],c.prototype,"stationary",null);f([g.property({readOnly:!0,dependsOn:["map.initialViewProperties.viewpoint","map.layers","map.basemap"]})],c.prototype,"tileInfo",null);f([g.property({readOnly:!0})],c.prototype,"type",void 0);f([g.property({value:null,type:v,dependsOn:["content.viewpoint"]})],c.prototype,"viewpoint",null);f([g.property({value:-1,dependsOn:["content.scale"]})],c.prototype,"zoom",null);
return c=f([g.subclass("esri.views.MapViewBase")],c)});