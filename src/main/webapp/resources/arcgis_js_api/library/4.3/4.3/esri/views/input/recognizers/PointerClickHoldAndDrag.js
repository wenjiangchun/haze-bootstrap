// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler","./support"],function(g,h,k,l,m){g=function(f){function e(d,c,b){void 0===d&&(d=300);void 0===c&&(c=1.5);void 0===b&&(b=500);var a=f.call(this,"recognizers.PointerClickHoldAndDrag",!1)||this;a.maximumClickDelay=d;a.movementUntilDrag=c;a.holdDelay=b;a._pointerState=new Map;a._modifiers=new Set;a._pointerDrag=a.registerOutgoing("pointer-drag");a._pointerClick=a.registerOutgoing("pointer-click");a._pointerHold=a.registerOutgoing("hold");
a.registerIncoming("pointer-down",a._handlePointerDown.bind(a));a.registerIncoming("pointer-up",a._handlePointerUpOrLost.bind(a));a.registerIncoming("pointer-capture-lost",a._handlePointerUpOrLost.bind(a));a._moveHandle=a.registerIncoming("pointer-move",a._handlePointerMove.bind(a));a._moveHandle.pause();return a}k(e,f);e.prototype.onUninstall=function(){this._pointerState.forEach(function(d){0!==d.holdTimeout&&(clearTimeout(d.holdTimeout),d.holdTimeout=0)});f.prototype.onUninstall.call(this)};e.prototype._handlePointerDown=
function(d){var c=this,b=d.data,a=b.native.pointerId,e=0;0===this._pointerState.size&&(e=setTimeout(function(){var b=c._pointerState.get(a);b&&(b.isDragging||(c._pointerHold.emit(b.previousEvent),b.holdEmitted=!0),b.holdTimeout=0)},this.holdDelay));1===this._pointerState.size&&this._pointerState.forEach(function(a){0!==a.holdTimeout&&(clearTimeout(a.holdTimeout),a.holdTimeout=0)});this._pointerState.set(a,{startEvent:b,previousEvent:b,startTimestamp:d.timestamp,totalMovement:0,isDragging:!1,downButton:b.native.button,
holdTimeout:e});this.startCapturingPointer(b.native);this._moveHandle.resume()};e.prototype._createPointerDragData=function(d,c,b){return{action:d,startEvent:c.startEvent,previousEvent:c.previousEvent,currentEvent:b}};e.prototype._handlePointerMove=function(d){var c=d.data,b=this._pointerState.get(c.native.pointerId);b&&(b.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",b,c),this._modifiers):(b.totalMovement+=m.manhattanDistance(c,b.previousEvent),b.totalMovement>this.movementUntilDrag&&
(b.isDragging=!0,b.previousEvent=b.startEvent,this._modifiers=d.modifiers,0!==b.holdTimeout&&clearTimeout(b.holdTimeout),this._pointerDrag.emit(this._createPointerDragData("start",b,b.startEvent)),this._pointerDrag.emit(this._createPointerDragData("update",b,c)))),b.previousEvent=c)};e.prototype._handlePointerUpOrLost=function(d){var c=d.data,b=c.native.pointerId,a=this._pointerState.get(b);a&&(0!==a.holdTimeout&&clearTimeout(a.holdTimeout),a.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",
a,c),this._modifiers):a.downButton===c.native.button&&d.timestamp-a.startTimestamp<=this.maximumClickDelay&&!a.holdEmitted&&this._pointerClick.emit(c),this._pointerState.delete(b),this.stopCapturingPointer(c.native),0===this._pointerState.size&&this._moveHandle.pause())};return e}(l.InputHandler);h.PointerClickHoldAndDrag=g});