// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define("../../../../core/declare ../../../../core/screenUtils ../../../../Color ./Graphics3DSymbolLayer ./Graphics3DGraphicLayer ./ElevationAligners ./Graphics3DSymbolCommonCode ./Graphics3DIconSymbolLayer ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextTexture ../../webgl-engine/materials/HUDMaterial".split(" "),function(q,y,z,A,B,v,e,C,D,E,F,w){var G=[1,1,1],H=[0,0,1],x=v.perObjectElevationAligner;q=q([A],{_prepareResources:function(){var a=this.symbol;
this._anchor=-1<C.VALID_ANCHOR_STRINGS.indexOf(a.anchor)?a.anchor:"center";this.resolve()},destroy:function(){this.isFulfilled()||this.reject()},createGraphics3DGraphic:function(a,c,l,f){var b=a.geometry,m=!1;if("polyline"===b.type)b=e.placePointOnPolyline(b),m=!0;else if("polygon"===b.type)b=e.placePointOnPolygon(b);else if("extent"===b.type)b=b.get("center");else if("point"!==b.type)return this._logWarning("unsupported geometry type for text symbol: "+b.type),null;var d=this._context.layer.id+"_label_"+
a.uid,h=c.text||this.symbol.text;if(!h||1>h.length)return null;var r=this._getGraphicElevationInfo(a);return this._createAs3DShape(this.symbol,b,h,r,d,a.uid,c,l,f,m)},layerPropertyChanged:function(a,c,e){if("opacity"===a)console.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");else if("elevationInfo"===a){this._updateElevationInfo();if(c)for(var f in c){a=c[f];var b=a._graphics[e];b&&this.updateGraphicElevationInfo(a.graphic,b)}return!0}return!1},updateGraphicElevationInfo:function(a,
c){var l=this._context;a=this._getGraphicElevationInfo(a);c.elevationAligner=a.mode!==e.ELEV_MODES.ABSOLUTE_HEIGHT?x:null;c.elevationInfo.set(a);x(c,l.elevationProvider,l.renderCoordsHelper)},_defaultElevationInfoNoZ:function(){return I},_getGraphicElevationInfo:function(a){var c=this.inherited(arguments);c.mode===e.ELEV_MODES.ON_THE_GROUND?(c.mode=e.ELEV_MODES.RELATIVE_TO_GROUND,c.offset=1/this._context.renderCoordsHelper.unitInMeters,c.featureExpression={value:0}):c.mode!==e.ELEV_MODES.RELATIVE_TO_GROUND||
0!==c.offset||a.geometry.get("hasZ")||(c.offset=1/this._context.renderCoordsHelper.unitInMeters);return c},_createAs3DShape:function(a,c,l,f,b,m,d,h,r,g){var n=d.centerOffset||[0,0,0,1],p=d.screenOffset||[0,0],q=d.translation||[0,0,0,0],t=d.anchor||this._anchor||"center";this._anchor=t;var k=a.material?z.toUnitRGB(a.material.color):G,u={shadowColor:.35<.299*k[0]+.587*k[1]+.114*k[2]?"black":"white",shadowBlur:1};d=null!=r;a=new F(l,{size:y.pt2px(a.size)||12,color:k,font:{family:a.font&&a.font.family?
a.font.family:"Arial",weight:a.font&&a.font.weight?a.font.weight:"normal",style:a.font&&a.font.style?a.font.style:"normal"},canvasStyle:u},b,d);k=d?r.addTextTexture(a):null;u=this._getMaterialOpacity();p={textureId:d?k.texture.getId():a.getId(),texCoordScale:a.getTexcoordScale(),occlusionTest:!0,screenOffset:p,anchorPos:t,polygonOffset:!0,color:[1,1,1,u],transparent:1>u};g&&(p.shaderPolygonOffset=1E-4);g=null;t=JSON.stringify(p);null!=h?(g=h.getMaterial(t),null==g?(g=new w(p,b),h.addMaterial(t,g)):
d&&g.setTextureDirty()):g=new w(p,b);d=[g];g=[a.getTextWidth(),a.getTextHeight()];n=E.createPointGeometry(H,q,void 0,g,n,k?k.uvMinMax:null);n=[new D(n,b)];b=e.createStageObjectForPoint.call(this,c,n,[d],null,null,f,b,this._context.layer.id,m,!0);m=null;f.mode!==e.ELEV_MODES.ABSOLUTE_HEIGHT&&(m=v.perObjectElevationAligner);f=new B(this,b.object,n,null==h?d:null,null==r?[a]:null,m,f);f.alignedTerrainElevation=b.terrainElevation;f.metadata={labelText:l};e.extendPointGraphicElevationInfo(f,c,this._context.elevationProvider);
return f}});var I={mode:e.ELEV_MODES.RELATIVE_TO_GROUND,offset:0};return q});