// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define("require exports dojo/_base/lang dojox/gfx/matrix ../../../../core/screenUtils ../../../../geometry/Polygon ../../../../symbols/SimpleMarkerSymbol ../../../../symbols/support/gfxUtils".split(" "),function(L,l,y,r,q,H,p,t){function v(c,a){a.toRgba?(c[0]=a.r,c[1]=a.g,c[2]=a.b,c[3]=a.a):(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3]);return c}function w(c,a,b){null!=b&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=b);return c}function z(c,a){var b=c.width/c.height,f=1,d=1;isNaN(a)||(1<b?(f=a/c.width,d=a/b/c.height):
(d=a/c.height,f=a*b/c.width));return{xx:f,yy:d}}function A(c,a,b,f,d,h,g){var e=d.symbol,m=c.toScreenPoint(I,b,g[0]);b=m.x;g=m.y;c=[];var u=d.rotationAngle;d=d.size&&d.size[0];var n,k;"number"===typeof d&&(k=isFinite(d)&&d);k=(d=k&&isFinite(k)&&!isNaN(k))?q.pt2px(k):NaN;h&&c.push(r.rotategAt(h,m));u&&c.push(r.rotategAt(u,m));h=q.pt2px(e.xoffset);u=q.pt2px(e.yoffset);0===h&&0===u||c.push(r.translate(h,-u));0!==e.angle&&c.push(r.rotategAt(e.angle,m));if("simple-marker-symbol"===e.type)switch(n=e.style,
h=Math.round,k=d?k:q.pt2px(e.size),d=void 0,n){case p.STYLE_SQUARE:case p.STYLE_CROSS:case p.STYLE_X:case p.STYLE_DIAMOND:d=isNaN(k)?16:.5*k;n=x(a,f,B(n,b,g,h(b-d),h(b+d),h(g-d),h(g+d)));break;case p.STYLE_PATH:n=x(a,f,e.path);e=n.getBoundingBox();a=z(e,k);1===a.xx&&1===a.yy||c.push(r.scaleAt(a.xx,a.yy,m.x,m.y));c.push(r.translate(-(e.x+.5*e.width)+b,-(e.y+.5*e.height)+g));break;default:d=isNaN(k)?16:.5*k,n=C(a,f,{cx:b,cy:g,r:d})}else if("picture-marker-symbol"===e.type)n=d?k:q.pt2px(e.width),k=d?
k:q.pt2px(e.height),m=e.source,d=null,m&&m.imageData&&(d="data:"+(m.contentType||"image")+";base64,"+m.imageData),n=D(a,f,{x:b-.5*n,y:g-.5*k,width:n,height:k,src:d||e.url});else if("text-symbol"===e.type){if(m=e.font&&e.font.clone())m.size=d?k:q.pt2px(m.size);n=E(a,f,{type:"text",text:e.text,x:b,y:g,align:t.getSVGAlign(e),decoration:e.decoration||m&&m.decoration,rotated:e.rotated,kerning:e.kerning});m&&n.setFont(m);a=n.getNode();f=t.getSVGBaseline(e);e=t.getSVGBaselineShift(e);a&&(a.setAttribute("dominant-baseline",
f),e&&a.setAttribute("baseline-shift",e))}n.setTransform(r.multiply(c));return n}function D(c,a,b){return a?a.setShape(b):c.createImage(b)}function C(c,a,b){return a?a.setShape(b):c.createCircle(b)}function x(c,a,b){b=Array.isArray(b)?b.join(" "):b;return a?a.setShape(b):c.createPath(b)}function E(c,a,b){return a?a.setShape(b):c.createText(b)}function F(c,a){a=a&&a.shape&&a.shape.type;var b=c&&c.type;c=c&&c.style;b&&(c=J[b]||c);K[c]&&(c="path");return!(!a||!c||a===c)}function B(c,a,b,f,d,h,g,e){switch(c){case p.STYLE_SQUARE:return["M",
f+","+h,d+","+h,d+","+g,f+","+g,"Z"];case p.STYLE_CROSS:return["M",a+","+h,a+","+g,"M",f+","+b,d+","+b];case p.STYLE_X:return["M",f+","+h,d+","+g,"M",f+","+g,d+","+h];case p.STYLE_DIAMOND:return["M",a+","+h,d+","+b,a+","+g,f+","+b,"Z"];case p.STYLE_TARGET:return["M",f+","+h,d+","+h,d+","+g,f+","+g,f+","+h,"M",f-e+","+b,f+","+b,"M",a+","+(h-e),a+","+h,"M",d+e+","+b,d+","+b,"M",a+","+(g+e),a+","+g]}}function G(c,a){var b=a.symbol;if("picture-marker-symbol"!==b.type){var f=t.getFill(b);if("simple-marker-symbol"===
b.type){var d=b.style,h=(b=t.getStroke(b))&&b.color,d=d===p.STYLE_X||d===p.STYLE_CROSS,g=a.opacity;(a=a.color||v([0,0,0,0],d?h:f))&&null!=g&&(a=w([0,0,0,0],a,g));a&&(d?a!==h&&(b=b?y.mixin({},b):{},b.color=a):a!==f&&(f=a));c.setFill(f).setStroke(b)}else"text-symbol"===b.type&&(g=a.opacity,(a=a.color||v([0,0,0,0],f))&&null!=g&&(a=w([0,0,0,0],a,g)),a&&a!==f&&(f=a),c.setFill(f))}}l.getScaleMatrix=z;var I={x:0,y:0};l.drawPoint=A;l.drawMarkers=function(c,a,b,f,d,h,g){var e=d.symbol;b=b.points;a=f||a.createGroup();
f=[0];a.children[0]&&F(e,a.children[0])&&a.clear();for(var m=0,u=b.length,e=0;e<u;e++)for(var n=b[e],k=g.length,l=0;l<k;l++)f[0]=g[l],a.add(A(c,a,{x:n[0],y:n[1]},a.children[m++],d,h,f));c=a.children.length;if(b.length*g.length<c)for(g=b.length*g.length,e=c-1;e>=g;e--)a.children[e].removeShape();return a};l.drawShape=function(c,a,b,f,d){var h=[];"extent"===b.type&&(b=H.fromExtent(b));if("polyline"===b.type||"polygon"===b.type){for(var g=d.length,e=0;e<g;e++)h=h.concat(c.toScreenPath(b,d[e]));f=x(a,
f,h)}return f};l.drawRect=function(c,a,b){return a?a.setShape(b):c.createRect(b)};l.drawImage=D;l.drawCircle=C;l.drawPath=x;l.drawText=E;var J={"picture-marker-symbol":"image","picture-fill-symbol":"path","simple-fill-symbol":"path","simple-line-symbol":"path","text-symbol":"text"},K={square:1,cross:1,x:1,diamond:1,target:1};l.isShapeInvalid=F;l.smsToPath=B;l.stylePoint=G;l.styleMarkers=function(c,a){for(var b=c.children.length,f=0;f<b;f++)G(c.children[f],a)};l.styleShape=function(c,a){var b=a.symbol,
f=a.size,d=a.color;a=a.opacity;var h=t.getStroke(b),g=t.getFill(b),e=!1,m;"simple-line-symbol"===b.type?(e=!0,m="none"!==b.style):m=b.outline&&"none"!==b.outline.style;var l,n,k;f&&(k=isFinite(f[0])&&f[0]);null!=f&&(k=q.pt2px(k));!d&&null==a||"picture-fill-symbol"===b.type||(e?(l=d||h&&h.color&&v([0,0,0,0],h.color))&&null!=a&&(l=w(l,l,a)):g&&(n=d||v([0,0,0,0],g))&&null!=a&&(n=w(n,n,a)));!m||null==f&&!l?c.setStroke(h):c.setStroke(y.mixin({},h,null!=k?{width:k}:null,l&&{color:l}));c.setFill(n||g);c.rawNode.setAttribute("vector-effect",
"non-scaling-stroke")}});