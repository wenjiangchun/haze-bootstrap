// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define("../../lib/IdGen ../../lib/gl-matrix ../../parts/Model ../../lib/ComponentUtils ../../lib/Util ../../../../webgl/Util".split(" "),function(Y,E,Z,U,F,aa){var n=E.vec3d,ba=E.mat4d,L=E.mat4,M=F.VertexAttrConstants,c={};c.__Material_idGen=new Y;c.__GLMaterial_id=0;c.IDENTITY=ba.identity();c.fill=function(a,f,d,b,e,g){if(void 0===e||3!==g)for(e=0;e<g;++e)d[b+e]=a[f+e];else{var t=a[f],z=a[f+1];a=a[f+2];d[b]=e[0]*t+e[4]*z+e[8]*a+e[12];d[b+1]=e[1]*t+e[5]*z+e[9]*a+e[13];d[b+2]=e[2]*t+e[6]*z+e[10]*a+
e[14]}return g};var N=function(a,f,d,b,e,g){for(var t=a.length,z=0;z<t;++z){for(var v=d*a[z],x=0;x<d;++x)b[e+x]=f[v+x];e+=g}};c.fillInterleaved=function(a,f,d,b,e,g,t,z){for(var v=aa.getStride(e)/4,x=0;x<e.length;x++){var h=e[x],q=t+h.offset/4,h=h.name;if(null==z||null!=z[h]){var k;switch(h){case "uv0":k=a.vertexAttr[h];null!=k&&N(a.faces.indices[h],k.data,k.size,g,q,v);break;case "region":k=a.vertexAttr[h];var h=a.faces.indices[h],c=k.data,l=k.size;k=g;var w=v;k=new Uint16Array(k.buffer);for(var q=
2*q,w=2*w,n=h.length,u=0;u<n;++u){var r=l*h[u],m;for(m=0;m<l;++m)k[q+m]=c[r+m];q+=w}break;case "color":k=a.vertexAttr[h];if(b&&b.color)for(h=a.faces.indices[h],c=k.data,l=b.color,k=k.size,w=g,n=v,w=new Uint8Array(w.buffer),q*=4,n*=4,u=h.length,r=0;r<u;++r){m=k*h[r];var p;for(p=0;p<k;++p)w[q+p]=c[m+p]*l[p];4>p&&(w[q+3]=255*l[3]);q+=n}else for(h=a.faces.indices[h],c=k.data,l=k.size,k=g,w=v,k=new Uint8Array(k.buffer),q*=4,w*=4,n=h.length,u=0;u<n;++u){r=l*h[u];for(m=0;m<l;++m)k[q+m]=c[r+m];4>m&&(k[q+
3]=255);q+=w}break;default:if(k=a.vertexAttr[h],l=h===M.POSITION?f:h===M.NORMAL?d:void 0,void 0!==l&&3===k.size)for(h=a.faces.indices[h],c=k.data,k=g,w=v,n=h.length,u=0;u<n;++u)p=3*h[u],r=c[p],m=c[p+1],p=c[p+2],k[q]=l[0]*r+l[4]*m+l[8]*p+l[12],k[q+1]=l[1]*r+l[5]*m+l[9]*p+l[13],k[q+2]=l[2]*r+l[6]*m+l[10]*p+l[14],q+=w;else N(a.faces.indices[h],k.data,k.size,g,q,v)}}}};c.triangleVertexArrayToWireframeLines=function(a,f,d,b){for(d=Math.floor(d/3)-1;0<=d;d--){var e=f+3*d*b,g=f+6*d*b+5*b;this.fill(a,e,a,
g,null,b);g-=b;this.fill(a,e+b,a,g,null,b);g-=b;this.fill(a,e+b,a,g,null,b);g-=b;this.fill(a,e+2*b,a,g,null,b);g-=b;this.fill(a,e+2*b,a,g,null,b);g-=b;this.fill(a,e,a,g,null,b)}};var V=n.create(),ca=n.create(),da=n.create(),ea=n.create(),W=function(a,f,d,b,e,g){var t=a.getCenter();n.project(t,d,b,V);var c=n.dist2(V,t),v=a.getBSRadius(),t=f.visibilities,x=f.offsets;if(c<v*v){var c=a.getPrimitiveIndices(),v=a.getIndices(),h=a.getPosition(),q=c?c.length:v.length/3;if(1E4<q&&(a=a.getChildren(),void 0!==
a)){for(t=0;8>t;++t)void 0!==a[t]&&W(a[t],f,d,b,e,g);return}f=h.size;a=h.data;var h=d[0],k=d[1];d=d[2];var D=b[0]-h,l=b[1]-k;b=b[2]-d;for(var w=U.createVisibilityCache(),B=0;B<q;++B){var u=c?c[B]:B;if(U.lookupOffsetVisibility(t,x,3*u,w)){var r=f*v[3*u],m=f*v[3*u+1],p=f*v[3*u+2],P=a[r],Q=a[r+1],r=a[r+2],E=a[m],F=a[m+1],m=a[m+2],L=a[p],M=a[p+1],p=a[p+2],G=E-P,H=F-Q,I=m-r,J=L-P,A=M-Q,C=p-r,K=l*C-A*b,O=b*J-C*D,N=D*A-J*l,y=G*K+H*O+I*N;if(!(y>-e&&y<e)){var y=1/y,R=h-P,S=k-Q,T=d-r,K=y*(R*K+S*O+T*N);0>K||
1<K||(O=S*I-H*T,I=T*G-I*R,G=R*H-G*S,H=y*(D*O+l*I+b*G),0>H||1<K+H||(J=y*(J*O+A*I+C*G),0<=J&&(A=ca,C=da,y=ea,n.set3(P,Q,r,A),n.set3(E,F,m,C),n.set3(L,M,p,y),n.subtract(C,A,C),n.subtract(y,A,y),n.normalize(n.cross(C,y,A)),g(J,A,u))))}}}}};c.intersectTriangleGeometry=function(a,f,d,b,e,g,t){d=a.getData();f={offsets:d.componentOffsets,visibilities:f.componentVisibilities};F.assert("triangle"===d.primitiveType);W(a.getBoundingInfo(0),f,e,g,b.tolerance,t)};c.basicMaterialConstructor=function(a,f){var d=
!0,b=0,e=c.__Material_idGen.gen(f);a.getId=function(){return e};var g;a.getParentStage=function(){return g};a.addParentStage=function(a){F.assert(void 0===g,"Material can only be added to a single Stage");g=a};a.removeParentStage=function(a){g=void 0};a.setVisible=function(b){d!==b&&(d=b,a.notifyDirty("matChanged"))};a.isVisible=function(){return d};a.notifyDirty=function(b){g&&g.notifyDirty(Z.ContentType.MATERIAL,a,b)};a.setRenderPriority=function(a){b=a;this.notifyDirty("matChanged")};a.getRenderPriority=
function(){return b}};var D=c.aquireIfNotUndefined=function(a,f,d,b){if(void 0!==a)return d.aquire(a,f,b)},B=c.releaseIfNotUndefined=function(a,f){void 0!==a&&f.release(a)},X=L.create();c.bindView=function(a,f,d){L.translate(f,a,X);d.setUniformMatrix4fv("view",X)};c.bindCamPos=function(a,f,d){d.setUniform3f("camPos",f[3]-a[0],f[7]-a[1],f[11]-a[2])};c.basicGLMaterialConstructor=function(a,f){var d=c.__GLMaterial_id++;a.getId=function(){return d};a.getMaterialId=function(){return f.getId()};a.isVisible=
function(){return f.isVisible()};a.getRenderPriority=function(){return f.getRenderPriority()}};c.singleTextureGLMaterialConstructor=function(a,f,d,b){var e=D(d.textureId,d.initTexture,f,b);a.updateTexture=function(a){d.textureId!==a&&(B(d.textureId,f),d.textureId=a,e=D(d.textureId,d.initTexture,f,b))};a.renderTexture=function(a){(a=f.getTexture(d.textureId))&&a.dirty&&a.redraw&&a.redraw()};a.bindTexture=function(a,b){void 0!==e&&(b.setUniform1i("tex",0),a.bindTexture(e.getGLTexture()))};a.bindTextureSize=
function(a,b){void 0!==e&&(a=e.getGLTexture(),b.setUniform2f("texSize",a.descriptor.width,a.descriptor.height))};a.dispose=function(){B(d.textureId,f)}};c.multiTextureGLMaterialConstructor=function(a,f,d,b){for(var e=b.length,g=Array(e),c=0;c<e;c++)g[c]=D(d[b[c][0]],d[b[c][1]],f);a.updateTextures=function(a){for(var c=0;c<e;c++){var x=d[b[c][0]],h=a[b[c][0]];x!==h&&(B(x,f),d[b[c][0]]=h,g[c]=D(h,d[b[c][1]],f))}};a.bindTextures=function(a,d){for(var c=0;c<e;c++)void 0!==g[c]&&(d.setUniform1i(b[c][2],
c),a.bindTexture(g[c].getGLTexture(),c));a.setActiveTexture(0)};a.bindOneTexture=function(a,d,c){d.setUniform1i(b[c][2],c);a.bindTexture(g[c].getGLTexture(),c);a.setActiveTexture(0)};a.disposeTextures=function(){for(var a=0;a<e;a++)B(d[b[a][0]],f)}};c.externalColorMixModes={multiply:1,ignore:2,replace:3,tint:4};return c});