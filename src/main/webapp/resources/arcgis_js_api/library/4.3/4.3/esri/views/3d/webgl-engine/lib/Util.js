// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define(["./gl-matrix","../../../../core/now"],function(q,J){function A(a){this.message=a}var K=q.vec2d,f=q.vec3d,r=q.vec4d,n=q.mat4d,B=n.create(),L=[r.createFrom(-1,-1,-1,1),r.createFrom(1,-1,-1,1),r.createFrom(1,1,-1,1),r.createFrom(-1,1,-1,1),r.createFrom(-1,-1,1,1),r.createFrom(1,-1,1,1),r.createFrom(1,1,1,1),r.createFrom(-1,1,1,1)],h=r.create(),D=Array(8);for(q=0;8>q;++q)D[q]=f.create();var E=f.create(),F=f.create(),G=f.create(),p=f.create(),k=f.create(),l=f.create(),v=f.create(),w=f.create(),
C=f.create(),H=f.create(),x=f.create(),t=f.create(),y=f.create(),z=f.create();A.prototype.toString=function(){return"AssertException: "+this.message};var g={EARTH_RADIUS:6378137,METER2FEET:3.28084,ECCENTRICITY_SQUARED:.0066943799901414,AssertException:A,VertexAttrConstants:{POSITION:"position",NORMAL:"normal",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",COLOR:"color",SIZE:"size",REGION:"region"},assert:function(a,c){if(!a)throw a=Error("dummy"),a.stack&&console.log(a.stack),new A(c);},verify:function(a,
c){a||(console.log("Verify failed: "+c),console.log(Error("dummy").stack))},createQuadVertexUvBuffer:function(a){a=a||Float32Array;a=new a(20);a[0]=-1;a[1]=-1;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=-1;a[7]=0;a[8]=1;a[9]=0;a[10]=-1;a[11]=1;a[12]=0;a[13]=0;a[14]=1;a[15]=1;a[16]=1;a[17]=0;a[18]=1;a[19]=1;return a},isPowerOfTwo:function(a){return 0===(a&a-1)},lerp:function(a,c,b){return a+(c-a)*b},clamp:function(a,c,b){return a<c?c:a>b?b:a},fallbackIfUndefined:function(a,c){return void 0===a?c:a},hex2rgb:function(a){a=
Math.floor(a);return[(a>>16&255)/255,(a>>8&255)/255,(a&255)/255]},rgb2hex:function(a){var c=g.clamp(Math.round(255*a[0]),0,255),b=g.clamp(Math.round(255*a[1]),0,255);a=g.clamp(Math.round(255*a[2]),0,255);return"0x"+((c<<16)+(b<<8)+a).toString(16)},dec2hex:function(a){a=a.toString(16);return"00000000".substr(0,8-a.length)+a},deg2rad:function(a){return a/180*Math.PI},rad2deg:function(a){return 180*a/Math.PI},azimuthElevationAngle2Direction:function(a,c){a=1.5*Math.PI-a;c=.5*Math.PI-c;return[Math.cos(a)*
Math.sin(c),Math.cos(c),Math.sin(a)*Math.sin(c)]},rayPlane:function(a,c,b,d){var e=f.dot(b,c);if(0===e)return!1;b=-(f.dot(b,a)+b[3])/e;f.add(a,f.scale(c,b,d),d);return!0},raySphereClosestPositive:function(a,c,b,d){var e=f.dot(c,c),m=2*f.dot(c,a);b=f.dot(a,a)-b*b;b=m*m-4*e*b;if(0>b)return!1;var u=Math.sqrt(b);b=(-m-u)/(2*e);e=(-m+u)/(2*e);if(0>b||e<b&&0<e)b=e;return 0<b?(f.add(a,f.scale(c,b,d),d),!0):!1},rayTriangle3D:function(a,c,b,d,e,m,u,g,h){h||(h=f.create());var k=d[u]-b[m],l=d[u+1]-b[m+1],n=
d[u+2]-b[m+2];d=e[g]-b[m];u=e[g+1]-b[m+1];e=e[g+2]-b[m+2];var r=c[1]*e-u*c[2],p=c[2]*d-e*c[0],I=c[0]*u-d*c[1];g=k*r+l*p+n*I;if(-1E-5<g&&1E-5>g)return!1;g=1/g;var q=a[0]-b[m],t=a[1]-b[m+1];a=a[2]-b[m+2];h[1]=g*(q*r+t*p+a*I);if(0>h[1]||1<h[1])return!1;b=t*n-l*a;a=a*k-n*q;k=q*l-k*t;h[2]=g*(c[0]*b+c[1]*a+c[2]*k);if(0>h[2]||1<h[1]+h[2])return!1;h[0]=g*(d*b+u*a+e*k);return!0},rayBoxTest:function(a,c,b,d){var e,m=(b[0]-a[0])/c[0],g=(d[0]-a[0])/c[0];m>g&&(e=m,m=g,g=e);var f=(b[1]-a[1])/c[1],h=(d[1]-a[1])/
c[1];f>h&&(e=f,f=h,h=e);if(m>h||f>g)return!1;f>m&&(m=f);h<g&&(g=h);b=(b[2]-a[2])/c[2];a=(d[2]-a[2])/c[2];b>a&&(e=b,b=a,a=e);if(m>a||b>g)return!1;a<g&&(g=a);return 0>g?!1:!0},rayRay2D:function(a,c,b,d,e,g){g||(g=K.create());var f=(d[e]-b[e])*(c[0]-a[0])-(d[0]-b[0])*(c[e]-a[e]);if(0===f)return!1;b=((d[0]-b[0])*(a[e]-b[e])-(d[e]-b[e])*(a[0]-b[0]))/f;g[0]=a[0]+b*(c[0]-a[0]);g[1]=a[e]+b*(c[e]-a[e]);return!0},matrix2frustum:function(a,c,b){n.multiply(c,a,B);n.inverse(B);for(a=0;8>a;++a)n.multiplyVec4(B,
L[a],h),f.set3(h[0]/h[3],h[1]/h[3],h[2]/h[3],b[a])},matrix2frustumPlanes:function(a,c,b,d){void 0===d&&(d=b,b=D);g.matrix2frustum(a,c,b);g.point2plane(b[4],b[0],b[3],d[0]);g.point2plane(b[1],b[5],b[6],d[1]);g.point2plane(b[4],b[5],b[1],d[2]);g.point2plane(b[3],b[2],b[6],d[3]);g.point2plane(b[0],b[1],b[2],d[4]);g.point2plane(b[5],b[4],b[7],d[5])},point2plane:function(a,c,b,d){f.subtract(a,c,E);f.subtract(b,c,F);f.cross(F,E,d);f.normalize(d);d[3]=-f.dot(d,a)},project:function(a,c,b,d,e){e||(e=a);h[0]=
a[0];h[1]=a[1];h[2]=a[2];h[3]=1;n.multiplyVec4(c,h);2<e.length&&(e[2]=-h[2]);n.multiplyVec4(b,h);g.assert(0!==h[3]);e[0]=h[0]/h[3];e[1]=h[1]/h[3];e[2]=h[2]/h[3];e[0]=(.5*e[0]+.5)*d[2]+d[0];e[1]=(.5*e[1]+.5)*d[3]+d[1]},geodeticToGeocentricLatidude:function(a){return Math.atan((1-g.ECCENTRICITY_SQUARED)*Math.tan(a))},latLon2positionWGS84Ellipsoid:function(a,c,b,d){var e=6378137/Math.sqrt(1-g.ECCENTRICITY_SQUARED*Math.pow(Math.sin(a),2)),f=Math.cos(a);d[0]=(e+b)*Math.cos(c)*f;d[1]=(e*(1-g.ECCENTRICITY_SQUARED)+
b)*Math.sin(a);d[2]=-(e+b)*Math.sin(c)*f},pos2latLon:function(a,c){var b=f.length(a);c[0]=Math.asin(g.clamp(a[1]/b,-1,1));c[1]=(0>a[2]?1:-1)*Math.acos(g.clamp(a[0]/(Math.cos(c[0])*b),-1,1));c[0]=g.rad2deg(c[0]);c[1]=g.rad2deg(c[1]);c[2]=b},pos2latLonWGS84Ellipsoid:function(a,c){var b=a[0],d=-a[2],e=a[1],f=Math.sqrt(Math.pow(6378137,2)*(1-g.ECCENTRICITY_SQUARED));a=Math.sqrt(Math.pow(b,2)+Math.pow(d,2));var h=Math.atan2(6378137*e,f*a),b=Math.atan2(d,b),d=Math.atan2(e+Math.pow(Math.sqrt((Math.pow(6378137,
2)-Math.pow(f,2))/Math.pow(f,2)),2)*f*Math.pow(Math.sin(h),3),a-6378137*g.ECCENTRICITY_SQUARED*Math.pow(Math.cos(h),3));a=a/Math.cos(d)-6378137/Math.sqrt(1-g.ECCENTRICITY_SQUARED*Math.pow(Math.sin(d),2))+g.EARTH_RADIUS;c[0]=d;c[1]=b;c[2]=a},computeGlobeTransformation:function(a,c,b){var d=g.deg2rad(a[0]);a=g.deg2rad(a[1]);g.latLon2position(d,a,G,c);n.translate(b,G);n.rotateY(b,.5*Math.PI+a);n.rotateX(b,.5*Math.PI-d);return b},readUInt16:function(a,c){return a[c]+(a[c+1]<<8)},readUInt32:function(a,
c){return a[c]+(a[c+1]<<8)+(a[c+2]<<16)+(a[c+3]<<24)},setIfDefined:function(a,c,b){void 0!==c[a]&&(b[a]=c[a])},array2object:function(a,c){var b={},d,e;if(void 0!==c)for(d=0,e=a.length;d<e;++d)b[c(a[d])]=a[d];else for(d=0,e=a.length;d<e;++d)b[a[d]]=a[d];return b},object2array:function(a){var c=[],b;for(b in a)c.push(a[b]);return c},mergeObjects:function(a,c,b){void 0===b&&(b={});var d;if(b!==a)for(d in a)b[d]=a[d];if(b!==c)for(d in c)b[d]=c[d];return b},subtractObjects:function(a,c){var b={},d;for(d in a)void 0===
c[d]&&(b[d]=a[d]);return b},intersectObjects:function(a,c){var b={},d;for(d in a)void 0!==c[d]&&(b[d]=a[d]);return b},getFirstObjectKey:function(a){for(var c in a)return c},getFirstObjectValue:function(a){return a[g.getFirstObjectKey(a)]},objectEmpty:function(a){for(var c in a)return!1;return!0},arraysEqual:function(a,c){if(a.length!==c.length)return!1;for(var b=0,d=a.length;b<d;++b)if(a[b]!==c[b])return!1;return!0},arrayRemove:function(a,c){var b=a.indexOf(c);return-1!==b?(a[b]=a[a.length-1],a.pop(),
c):null},byteBuffer2base64image:function(a,c,b,d,e){var f=4*c;g.assert(a.length===f*b,"buffer length must match image resolution");var h=document.createElement("canvas");h.width=c;h.height=b;var k=h.getContext("2d");c=k.getImageData(0,0,c,b);for(var l=c.data,n=0;n<b;++n)for(var q=n*f,r=(b-1-n)*f,p=0;p<f;++p)l[q++]=a[r++];k.putImageData(c,0,0);return h.toDataURL(d,e)},cround:function(a){return Math.round(100*a)/100},logWithBase:function(a,c){return Math.log(a)/Math.log(c)},setMatrixTranslation:function(a,
c){a[12]=c[0];a[13]=c[1];a[14]=c[2]},setMatrixTranslation3:function(a,c,b,d){a[12]=c;a[13]=b;a[14]=d},getMatrixTranslation:function(a,c){c=c||f.create();c[0]=a[12];c[1]=a[13];c[2]=a[14];return c},createTranslationMatrix:function(a,c){a=n.identity(a);g.setMatrixTranslation(a,c);return a},fovx2fovy:function(a,c,b){return 2*Math.atan(b*Math.tan(.5*a)/c)},fovy2fovx:function(a,c,b){return 2*Math.atan(c*Math.tan(.5*a)/b)},fovx2fovd:function(a,c,b){return 2*Math.atan(Math.sqrt(c*c+b*b)*Math.tan(.5*a)/c)},
fovy2fovd:function(a,c,b){return 2*Math.atan(Math.sqrt(c*c+b*b)*Math.tan(.5*a)/b)},fovd2fovx:function(a,c,b){return 2*Math.atan(c*Math.tan(.5*a)/Math.sqrt(c*c+b*b))},fovd2fovy:function(a,c,b){return 2*Math.atan(b*Math.tan(.5*a)/Math.sqrt(c*c+b*b))},nextHighestPowerOfTwo:function(a){--a;for(var c=1;32>c;c<<=1)a|=a>>c;return a+1},linelineDistance3D:function(a,c,b,d){var e,g,h;p[0]=a[0]-b[0];p[1]=a[1]-b[1];p[2]=a[2]-b[2];k[0]=d[0]-b[0];k[1]=d[1]-b[1];k[2]=d[2]-b[2];if(1E-4>Math.abs(k.x)&&1E-4>Math.abs(k.y)&&
1E-4>Math.abs(k.z))return[!1];l[0]=c[0]-a[0];l[1]=c[1]-a[1];l[2]=c[2]-a[2];if(1E-4>Math.abs(l.x)&&1E-4>Math.abs(l.y)&&1E-4>Math.abs(l.z))return[!1];c=p[0]*k[0]+p[1]*k[1]+p[2]*k[2];d=k[0]*l[0]+k[1]*l[1]+k[2]*l[2];e=p[0]*l[0]+p[1]*l[1]+p[2]*l[2];g=k[0]*k[0]+k[1]*k[1]+k[2]*k[2];h=(l[0]*l[0]+l[1]*l[1]+l[2]*l[2])*g-d*d;if(1E-4>Math.abs(h))return[!1];e=(c*d-e*g)/h;c=(c+d*e)/g;v[0]=a[0]+e*l[0];v[1]=a[1]+e*l[1];v[2]=a[2]+e*l[2];w[0]=b[0]+c*k[0];w[1]=b[1]+c*k[1];w[2]=b[2]+c*k[2];return[!0,f.dist(v,w),v,w]},
projectVectorVector2D:function(a,c,b){t[0]=c[0]-a[0];t[1]=c[1]-a[1];t[2]=0;y[0]=b[0]-a[0];y[1]=b[1]-a[1];y[2]=0;z[0]=b[0];z[1]=b[1];z[2]=0;c=f.dot(y,t);b=f.length(t);c/=b*b;x[0]=t[0]*c;x[1]=t[1]*c;C[0]=a[0]+x[0];C[1]=a[1]+x[1];f.subtract(z,C,H);a=f.length(H);c=f.length(y);b=f.length(t);var d=f.length(x);if(d>c||d>b)a=Number.MAX_VALUE;return a}};g.performance={now:J};return g});