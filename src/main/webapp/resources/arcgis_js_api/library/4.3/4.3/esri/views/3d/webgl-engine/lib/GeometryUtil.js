// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.3/esri/copyright.txt for details.
//>>built
define(["./GeometryData","./BufferVectorMath","./Util","./gl-matrix"],function(B,U,J,V){function R(a,c,b,d,e){if(Math.abs(f.dot(c,a))>e)return!1;f.cross(a,c,b);f.normalize(b);f.cross(b,a,d);f.normalize(d);return!0}function S(a,c,b,d,e,g,h){return R(a,c,e,g,h)||R(a,b,e,g,h)||R(a,d,e,g,h)}var f=V.vec3,N=V.vec3d,l=J.VertexAttrConstants,E=U.Vec3Compact,H=N.create(),W=N.create(),T={createSphereGeometry:function(a,c,b,d,e,g,h){a=a||50;d=void 0!==d?d:-Math.PI;e=void 0!==e?e:2*Math.PI;g=void 0!==g?g:.5*-Math.PI;
h=void 0!==h?h:Math.PI;var m=Math.max(3,Math.floor(c)||8),k=Math.max(2,Math.floor(b)||6),p=(m+1)*(k+1);b=new Float32Array(3*p);c=new Float32Array(3*p);var p=new Float32Array(2*p),q,t,v=[],x=f.create(),u=0;for(t=0;t<=k;t++){var n=[],r=t/k,w=g+r*h,y=Math.cos(w);for(q=0;q<=m;q++){var K=q/m,z=d+K*e,C=Math.cos(z)*y*a,O=Math.sin(w)*a,z=-Math.sin(z)*y*a;b[3*u]=C;b[3*u+1]=O;b[3*u+2]=z;f.set3(C,O,z,x);f.normalize(x);c[3*u]=x[0];c[3*u+1]=x[1];c[3*u+2]=x[2];p[2*u]=K;p[2*u+1]=r;n.push(u);++u}v.push(n)}a=new Uint32Array(2*
m*(k-1)*3);for(t=u=0;t<k;t++)for(q=0;q<m;q++)d=v[t][q],e=v[t][q+1],g=v[t+1][q+1],h=v[t+1][q],0===t?(a[u++]=d,a[u++]=g,a[u++]=h):t===k-1?(a[u++]=d,a[u++]=e,a[u++]=g):(a[u++]=d,a[u++]=e,a[u++]=g,a[u++]=g,a[u++]=h,a[u++]=d);J.assert(u===a.length);m={};m[l.POSITION]=a;m[l.NORMAL]=a;m[l.UV0]=a;k={};k[l.POSITION]={size:3,data:b};k[l.NORMAL]={size:3,data:c};k[l.UV0]={size:2,data:p};return new B(k,m)},createPolySphereGeometry:function(a,c,b){function d(b,d){b>d&&(b=d+(d=b,0));var c=b.toString()+"."+d.toString();
if(h[c])return h[c];var e=g.length;g.length+=3;E.add(g,3*b,g,3*d,g,e);E.scale(g,e,a/E.length(g,e));e/=3;return h[c]=e}var e,g;b?(g=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],b=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]):(b=a*(1+Math.sqrt(5))/2,g=[-a,b,0,a,b,0,-a,-b,0,a,-b,0,0,-a,b,0,a,b,0,-a,-b,0,a,-b,b,0,-a,b,0,a,-b,0,-a,-b,0,a],b=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]);for(e=0;e<g.length;e+=3)E.scale(g,
e,a/E.length(g,e));var h={};for(e=0;e<c;e++){for(var f=b.length,k=new Uint32Array(4*f),p=0;p<f;p+=3){var q=b[p],t=b[p+1],v=b[p+2],x=d(q,t),u=d(t,v),n=d(v,q),r=4*p;k[r]=q;k[r+1]=x;k[r+2]=n;k[r+3]=t;k[r+4]=u;k[r+5]=x;k[r+6]=v;k[r+7]=n;k[r+8]=u;k[r+9]=x;k[r+10]=u;k[r+11]=n}b=k;h={}}c=new Float32Array(g);for(e=0;e<c;e+=3)E.normalize(c,e);g=new Float32Array(g);e={};e[l.POSITION]=b;e[l.NORMAL]=b;b={};b[l.POSITION]={size:3,data:g};b[l.NORMAL]={size:3,data:c};return new B(b,e)},createPointGeometry:function(a,
c,b,d,e,g,h){var f=new Float32Array(3);f[0]=c?c[0]:0;f[1]=c?c[1]:0;f[2]=c?c[2]:0;c=new Float32Array(3);c[0]=a?a[0]:0;c[1]=a?a[1]:0;c[2]=a?a[2]:1;if(null==g)a=new Float32Array(2),a[0]=0,a[1]=0;else{a=new Float32Array(g.length);for(var k=0;k<g.length;k++)a[k]=g[k]}g=new Uint8Array(4);g[0]=b?255*b[0]:255;g[1]=b?255*b[1]:255;g[2]=b?255*b[2]:255;g[3]=b&&3<b.length?255*b[3]:255;b=new Float32Array(2);b[0]=null!=d&&2==d.length?d[0]:1;b[1]=null!=d&&2==d.length?d[1]:1;if(null!=e){var p=new Float32Array(4);
p[0]=e[0];p[1]=e[1];p[2]=e[2];p[3]=e[3]}if(null!=h){var q=new Float32Array(4);q[0]=h[0];q[1]=h[1];q[2]=h[2];q[3]=h[3]}k=new Uint32Array(1);k[0]=0;d={};d[l.POSITION]=k;d[l.NORMAL]=k;d[l.UV0]=k;d[l.COLOR]=k;d[l.SIZE]=k;null!=e&&(d[l.AUXPOS1]=k);null!=h&&(d[l.AUXPOS2]=k);k={};k[l.POSITION]={size:3,data:f};k[l.NORMAL]={size:3,data:c};k[l.UV0]={size:a.length,data:a};k[l.COLOR]={size:4,data:g};k[l.SIZE]={size:2,data:b};null!=e&&(k[l.AUXPOS1]={size:4,data:p});null!=h&&(k[l.AUXPOS2]={size:4,data:q});return new B(k,
d,B.DefaultOffsets,"point")},createPointArrayGeometry:function(a,c){for(var b=new Float32Array(3*a.length),d=new Float32Array(c?3*a.length:3),e=new Uint32Array(a.length),g=new Uint32Array(a.length),h=0;h<a.length;h++)b[3*h]=a[h][0],b[3*h+1]=a[h][1],b[3*h+2]=a[h][2],c&&(d[3*h]=c[h][0],d[3*h+1]=c[h][1],d[3*h+2]=c[h][2]),e[h]=h,g[h]=0;c||(d[0]=0,d[1]=1,d[2]=0);a=new Float32Array(2);a[0]=0;a[1]=0;h={};h[l.POSITION]=e;h[l.NORMAL]=c?e:g;h[l.UV0]=g;c={};c[l.POSITION]={size:3,data:b};c[l.NORMAL]={size:3,
data:d};c[l.UV0]={size:2,data:a};return new B(c,h,B.DefaultOffsets,"point")},createTriangleGeometry:function(){var a=new Float32Array(9);a[0]=0;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=100;a[6]=100;a[7]=0;a[8]=0;var c=new Uint32Array(3);c[0]=0;c[1]=1;c[2]=2;var b=new Float32Array(3);b[0]=0;b[1]=1;b[2]=0;var d=new Uint32Array(3);d[0]=0;d[1]=0;d[2]=0;var e=new Float32Array(2);e[0]=0;e[1]=0;var g=new Uint32Array(3);g[0]=0;g[1]=0;g[2]=0;var h={};h[l.POSITION]=c;h[l.NORMAL]=d;h[l.UV0]=g;c={};c[l.POSITION]={size:3,
data:a};c[l.NORMAL]={size:3,data:b};c[l.UV0]={size:2,data:e};return new B(c,h)},createSquareGeometry:function(a){var c,b,d=new Float32Array(12);if(a)for(c=0;4>c;c++)for(b=0;3>b;b++)d[3*c+b]=a[c][b];else d[0]=-1,d[1]=-1,d[2]=0,d[3]=1,d[4]=-1,d[5]=0,d[6]=1,d[7]=1,d[8]=0,d[9]=-1,d[10]=1,d[11]=0;b=new Uint32Array(6);b[0]=0;b[1]=1;b[2]=2;b[3]=2;b[4]=3;b[5]=0;a=new Float32Array(3);a[0]=0;a[1]=0;a[2]=1;var e=new Uint32Array(6);for(c=0;6>c;c++)e[c]=0;c=new Float32Array(8);c[0]=0;c[1]=0;c[2]=1;c[3]=0;c[4]=
1;c[5]=1;c[6]=0;c[7]=1;var g=new Uint8Array(4);g[0]=255;g[1]=255;g[2]=255;g[3]=255;var h={};h[l.POSITION]=b;h[l.NORMAL]=e;h[l.UV0]=b;h[l.COLOR]=e;b={};b[l.POSITION]={size:3,data:d};b[l.NORMAL]={size:3,data:a};b[l.UV0]={size:2,data:c};b[l.COLOR]={size:4,data:g};return new B(b,h)},createBoxGeometry:function(){var a,c,b=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],d=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],e=[0,0,1,0,1,1,0,1],g=[0,1,2,2,3,0,4,
0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],h=Array(36);for(a=0;6>a;a++)for(c=0;6>c;c++)h[6*a+c]=a;var f=Array(36);for(a=0;6>a;a++)f[6*a+0]=0,f[6*a+1]=1,f[6*a+2]=2,f[6*a+3]=2,f[6*a+4]=3,f[6*a+5]=0;return function(a){var c;Array.isArray(a)||(a=[a,a,a]);var k=new Float32Array(24);for(c=0;8>c;c++)k[3*c]=b[c][0]*a[0],k[3*c+1]=b[c][1]*a[1],k[3*c+2]=b[c][2]*a[2];a={};a[l.POSITION]=new Uint32Array(g);a[l.NORMAL]=new Uint32Array(h);a[l.UV0]=new Uint32Array(f);c={};c[l.POSITION]={size:3,data:k};
c[l.NORMAL]={size:3,data:new Float32Array(d)};c[l.UV0]={size:2,data:new Float32Array(e)};return new B(c,a)}}(),createDiamondGeometry:function(){var a=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],c=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],b=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],d=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];return function(e){var g;Array.isArray(e)||(e=[e,e,e]);var h=new Float32Array(18);for(g=0;6>g;g++)h[3*g]=a[g][0]*e[0],h[3*
g+1]=a[g][1]*e[1],h[3*g+2]=a[g][2]*e[2];e={};e[l.POSITION]=new Uint32Array(b);e[l.NORMAL]=new Uint32Array(d);g={};g[l.POSITION]={size:3,data:h};g[l.NORMAL]={size:3,data:new Float32Array(c)};return new B(g,e)}}(),createTetrahedronGeometry:function(){var a=f.createFrom(-.5,0,-.5),c=f.createFrom(.5,0,-.5),b=f.createFrom(0,0,.5),d=f.createFrom(0,.5,0),e=f.create(),g=f.create(),h=f.create(),m=f.create(),k=f.create();f.subtract(a,d,e);f.subtract(a,c,g);f.cross(e,g,h);f.normalize(h,h);f.subtract(c,d,e);
f.subtract(c,b,g);f.cross(e,g,m);f.normalize(m,m);f.subtract(b,d,e);f.subtract(b,a,g);f.cross(e,g,k);f.normalize(k,k);var p=[a,c,b,d],q=[0,-1,0,h[0],h[1],h[2],m[0],m[1],m[2],k[0],k[1],k[2]],t=[0,1,2,3,1,0,3,2,1,3,0,2],v=[0,0,0,1,1,1,2,2,2,3,3,3];return function(a){var b;Array.isArray(a)||(a=[a,a,a]);var c=new Float32Array(12);for(b=0;4>b;b++)c[3*b]=p[b][0]*a[0],c[3*b+1]=p[b][1]*a[1],c[3*b+2]=p[b][2]*a[2];a={};a[l.POSITION]=new Uint32Array(t);a[l.NORMAL]=new Uint32Array(v);b={};b[l.POSITION]={size:3,
data:c};b[l.NORMAL]={size:3,data:new Float32Array(q)};return new B(b,a)}}(),createConeGeometry:function(a,c,b,d){var e=0,g=f.createFrom(0,e,0),h=f.createFrom(0,e+a,0),m=f.createFrom(0,-1,0),k=f.createFrom(0,1,0);d&&(e=a,h=f.createFrom(0,0,0),g=f.createFrom(0,e,0),m=f.createFrom(0,1,0),k=f.createFrom(0,-1,0));var g=[h,g],m=[m,k],k=b+2,p=0,h=Math.sqrt(a*a+c*c);if(d)for(d=b-1;0<=d;d--)p=2*Math.PI/b*d,q=f.createFrom(Math.cos(p)*c,e,Math.sin(p)*c),g.push(q),p=f.createFrom(a*Math.cos(p)/h,-c/h,a*Math.sin(p)/
h),m.push(p);else for(d=0;d<b;d++){var p=2*Math.PI/b*d,q=f.createFrom(Math.cos(p)*c,e,Math.sin(p)*c);g.push(q);p=f.createFrom(a*Math.cos(p)/h,c/h,a*Math.sin(p)/h);m.push(p)}a=new Uint32Array(6*(b+2));b=new Uint32Array(6*(b+2));e=c=0;for(d=3;d<g.length;d++)a[c++]=1,a[c++]=d-1,a[c++]=d,b[e++]=0,b[e++]=0,b[e++]=0;a[c++]=g.length-1;a[c++]=2;a[c++]=1;b[e++]=0;b[e++]=0;b[e++]=0;for(d=3;d<g.length;d++)a[c++]=d,a[c++]=d-1,a[c++]=0,b[e++]=d,b[e++]=d-1,b[e++]=1;a[c++]=0;a[c++]=2;a[c++]=g.length-1;b[e++]=1;
b[e++]=2;b[e++]=m.length-1;e=1;Array.isArray(e)||(e=[e,e,e]);c=new Float32Array(3*k);for(d=0;d<k;d++)c[3*d]=g[d][0]*e[0],c[3*d+1]=g[d][1]*e[1],c[3*d+2]=g[d][2]*e[2];g=new Float32Array(3*k);for(d=0;d<k;d++)g[3*d]=m[d][0],g[3*d+1]=m[d][1],g[3*d+2]=m[d][2];m={};m[l.POSITION]=a;m[l.NORMAL]=b;k={};k[l.POSITION]={size:3,data:c};k[l.NORMAL]={size:3,data:g};return new B(k,m)},createCylinderGeometry:function(a,c,b,d,e,g){d||(d=f.createFrom(1,0,0));e||(e=f.createFrom(0,0,0));g=void 0===g?!0:g;var h=f.create();
f.normalize(d,h);d=f.create();f.scale(h,Math.abs(a),d);var m=f.create();f.scale(d,-.5,m);f.add(m,e);var k=f.createFrom(0,1,0);Math.abs(.2>1-f.dot(h,k))&&f.set3(0,0,1,k);var p=f.create();f.cross(h,k,p);f.normalize(p);f.cross(p,h,k);var q=2*b+(g?2:0),t=b+(g?2:0);e=new Float32Array(3*q);a=new Float32Array(3*t);var v=new Float32Array(2*q),x=new Uint32Array(3*b*(g?4:2)),u=new Uint32Array(3*b*(g?4:2));g&&(e[3*(q-2)+0]=m[0],e[3*(q-2)+1]=m[1],e[3*(q-2)+2]=m[2],v[2*(q-2)]=0,v[2*(q-2)+1]=0,e[3*(q-1)+0]=e[3*
(q-2)+0]+d[0],e[3*(q-1)+1]=e[3*(q-2)+1]+d[1],e[3*(q-1)+2]=e[3*(q-2)+2]+d[2],v[2*(q-1)]=1,v[2*(q-1)+1]=1,a[3*(t-2)+0]=-h[0],a[3*(t-2)+1]=-h[1],a[3*(t-2)+2]=-h[2],a[3*(t-1)+0]=h[0],a[3*(t-1)+1]=h[1],a[3*(t-1)+2]=h[2]);var h=function(a,b,c){x[a]=b;u[a]=c},n,r,w=0,y=f.create(),K=f.create();for(n=0;n<b;n++)r=2*Math.PI/b*n,f.scale(k,Math.sin(r),y),f.scale(p,Math.cos(r),K),f.add(y,K),a[3*n+0]=y[0],a[3*n+1]=y[1],a[3*n+2]=y[2],f.scale(y,c),f.add(y,m),e[3*n+0]=y[0],e[3*n+1]=y[1],e[3*n+2]=y[2],v[2*n+0]=n/b,
v[2*n+1]=0,e[3*(n+b)+0]=e[3*n+0]+d[0],e[3*(n+b)+1]=e[3*n+1]+d[1],e[3*(n+b)+2]=e[3*n+2]+d[2],v[2*(n+b)+0]=n/b,v[2*n+1]=1,r=(n+1)%b,h(w++,n,n),h(w++,n+b,n),h(w++,r,r),h(w++,r,r),h(w++,n+b,n),h(w++,r+b,r);if(g){for(n=0;n<b;n++)r=(n+1)%b,h(w++,q-2,t-2),h(w++,n,t-2),h(w++,r,t-2);for(n=0;n<b;n++)r=(n+1)%b,h(w++,n+b,t-1),h(w++,q-1,t-1),h(w++,r+b,t-1)}c={};c[l.POSITION]=x;c[l.NORMAL]=u;c[l.UV0]=x;b={};b[l.POSITION]={size:3,data:e};b[l.NORMAL]={size:3,data:a};b[l.UV0]={size:2,data:v};return new B(b,c)},createTubeGeometry:function(a,
c,b,d,e){b=b||10;d=null!=d?d:!0;J.assert(1<a.length);for(var g=[],h=[],f=0;f<b;f++){g.push([0,-f-1,-((f+1)%b)-1]);var k=f/b*2*Math.PI;h.push([Math.cos(k)*c,Math.sin(k)*c])}return T.createPathExtrusionGeometry(h,a,[[0,0,0]],g,d,e)},createSquareTubeGeometry:function(a,c,b){b=b||!0;J.assert(1<a.length);c*=Math.SQRT2;return T.createPathExtrusionGeometry([[c,c],[-c,c],[-c,-c],[c,-c]],a,[],[[-1,-2,-3],[-3,-4,-1]],b,[[0,1],[-1,0],[0,-1],[1,0]])},createPathExtrusionGeometry:function(a,c,b,d,e,g,h){var m,
k=a.length,p=new Float32Array(c.length*k*3+(6*b.length||0)),q=new Float32Array(c.length*k+(2*b.length||0)),t=new Float32Array(c.length*k*3+(b?6:0)),v=0,x=0,u=0,n=(c.length-1)*k*6+6*d.length,r=new Uint32Array(n),n=new Uint32Array(n),w=0,y=0,K=f.create(),z=f.create(),C=f.create(),O=f.create(),J=f.create(),E=f.create(),H=f.create(),N=f.create(),A=f.create(),L=f.create(),D=f.create(),P=f.create();f.set3(0,1,0,P);f.subtract(c[1],c[0],z);f.normalize(z);e?(f.add(c[0],g,D),f.normalize(D,C)):f.set3(0,0,1,
C);S(z,C,P,P,E,C,.99619469809);f.set(C,O);for(m=0;m<b.length;m++)f.scale(E,b[m][0],A),f.scale(C,b[m][2],D),f.add(A,D),f.add(A,c[0]),p[v++]=A[0],p[v++]=A[1],p[v++]=A[2],q[u++]=0;t[x++]=-z[0];t[x++]=-z[1];t[x++]=-z[2];for(m=0;m<d.length;m++)r[w++]=0<d[m][0]?d[m][0]:-d[m][0]-1+b.length,r[w++]=0<d[m][1]?d[m][1]:-d[m][1]-1+b.length,r[w++]=0<d[m][2]?d[m][2]:-d[m][2]-1+b.length,n[y++]=0,n[y++]=0,n[y++]=0;var F=b.length;m=b.length-1;for(var Q,M=0;M<c.length;M++){Q=!1;0<M&&(e?(f.add(c[M],g,D),f.normalize(D,
C)):f.set3(0,0,1,C),f.set(z,K),f.set(K,D),M<c.length-1?(f.subtract(c[M+1],c[M],z),f.normalize(z),f.add(D,z)):Q=!0,S(D,C,O,P,E,C,.99619469809),f.set(C,O));h&&(S(z,C,O,P,N,H,.99619469809),f.set(H,J));for(var G=0;G<k;G++)if(f.scale(E,a[G][0],A),f.scale(C,a[G][1],D),f.add(A,D),h?(f.scale(N,h[G][0],L),f.scale(H,h[G][1],D),f.add(L,D),f.normalize(L),f.scale(L,-1)):f.normalize(A,L),t[x++]=L[0],t[x++]=L[1],t[x++]=L[2],f.add(A,c[M]),p[v++]=A[0],p[v++]=A[1],p[v++]=A[2],q[u++]=a[G][1],!Q){var I=(G+1)%k;r[w++]=
F+G;r[w++]=F+k+G;r[w++]=F+I;r[w++]=F+I;r[w++]=F+k+G;r[w++]=F+k+I;if(h)for(I=0;6>I;I++)n[y++]=F-m+G;else for(I=0;6>I;I++)n[y++]=r[w-6+I]-m}F+=k}Q=c[c.length-1];for(m=0;m<b.length;m++)f.scale(E,b[m][0],A),f.scale(C,b[m][1],D),f.add(A,D),f.add(A,Q),p[v++]=A[0],p[v++]=A[1],p[v++]=A[2],q[u++]=0;a=x/3;t[x++]=z[0];t[x++]=z[1];t[x++]=z[2];k=F-k;for(m=0;m<d.length;m++)r[w++]=0<=d[m][0]?F+d[m][0]:-d[m][0]-1+k,r[w++]=0<=d[m][2]?F+d[m][2]:-d[m][2]-1+k,r[w++]=0<=d[m][1]?F+d[m][1]:-d[m][1]-1+k,n[y++]=a,n[y++]=
a,n[y++]=a;d={};d[l.POSITION]=r;d[l.NORMAL]=n;r={};r[l.POSITION]={size:3,data:p};r.zOffset={size:1,data:q};r[l.NORMAL]={size:3,data:t};return new B(r,d)},createPolylineGeometry:function(a){J.assert(1<a.length,"createPolylineGeometry(): polyline needs at least 2 points");J.assert(3===a[0].length,"createPolylineGeometry(): malformed vertex");for(var c=new Float32Array(3*a.length),b=new Uint32Array(2*(a.length-1)),d=0,e=0,g=0;g<a.length;g++){for(var f=0;3>f;f++)c[d++]=a[g][f];0<g&&(b[e++]=g-1,b[e++]=
g)}a={};d={};a[l.POSITION]=b;d[l.POSITION]={size:3,data:c};return new B(d,a,B.DefaultOffsets,"line")},addVertexColors:function(a,c,b){var d,e,g;if(b){var f={};b=a.getVertexAttr();for(g in b)f[g]=b[g];a=a.getFaces();b=Array(a.length);for(e=0;e<a.length;e++){d={};for(g in a[e].indices)d[g]=a[e].indices[g];b[e]={type:a[e].type,indices:d,positionKey:a[e].positionKey}}a=new B(b,f)}c=c||[1,1,1,1];g=new Uint8Array(4);g[0]=255*c[0];g[1]=255*c[1];g[2]=255*c[2];g[3]=255*(3<c.length?c[3]:1);a.getVertexAttr()[l.COLOR]=
{size:4,data:g};b=a.getFaces();for(e=0;e<b.length;e++)c=b[e],d=new Uint32Array(c.indices[c.positionKey].length),c.indices[l.COLOR]=d;return a},addNormals:function(a){var c=a.getVertexAttr();a=a.getFaces();for(var b=U.Vec3Compact.subtract,d=a.map(function(a){return a.indices.position.length/3}).reduce(function(a,b){return a+b}),d=new Float32Array(3*d),e=c.position.data,f=0,h=0;h<a.length;h++){for(var m=a[h].indices.position,k=new Uint32Array(m.length),l=0;l<m.length;l+=3){b(e,3*m[l],e,3*m[l+2],W,0);
b(e,3*m[l],e,3*m[l+1],H,0);N.cross(H,W);N.normalize(H);var q=f/3;d[f++]=H[0];d[f++]=H[1];d[f++]=H[2];k[l]=q;k[l+1]=q;k[l+2]=q}a[h].indices.normal=k}c.normal={size:3,data:d}},cgToGIS:function(a){var c=a.getVertexAttr();a=c.position.data;var c=c.normal.data,b,d;if(c)for(b=0;b<c.length;b+=3)d=c[b+1],c[b+1]=-c[b+2],c[b+2]=d;if(a)for(b=0;b<a.length;b+=3)d=a[b+1],a[b+1]=-a[b+2],a[b+2]=d}};return T});